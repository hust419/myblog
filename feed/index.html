<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>三两带走</title>
	<atom:link href="http://rentb.vicp.net/feed" rel="self" type="application/rss+xml" />
	<link>http://huster.top/</link>
	<description>(任天兵)龙安的博客</description>
	<lastBuildDate>Mon, 09 May 2022 13:11:26 +0000</lastBuildDate>
	<language>zh-CN</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=4.9.18</generator>

<image>
	<url>https://huster.top/wp-content/uploads/2018/09/cropped-fish_112.18181818182px_1208536_easyicon.net_-32x32.png</url>
	<title>三两带走</title>
	<link>http://huster.top/</link>
	<width>32</width>
	<height>32</height>
</image> 
	<item>
		<title>Java的Jar包冲突的总结和实践</title>
		<link>https://huster.top/htmls/790.html</link>
		<comments>https://huster.top/htmls/790.html#respond</comments>
		<pubDate>Mon, 09 May 2022 13:11:26 +0000</pubDate>
		<dc:creator><![CDATA[龙安_任天兵]]></dc:creator>
				<category><![CDATA[Java学习]]></category>

		<guid isPermaLink="false">https://huster.top/?p=790</guid>
		<description><![CDATA[“我这边现在有个问题，兵哥，你忙吗，想找你看看，有关冲突的，等等我联系下你”，这天接到线上求助。一般情况下ja &#8230; <a href="https://huster.top/htmls/790.html" class="more-link">继续阅读<span class="screen-reader-text">“Java的Jar包冲突的总结和实践”</span></a>]]></description>
				<content:encoded><![CDATA[<p>“我这边现在有个问题，兵哥，你忙吗，想找你看看，有关冲突的，等等我联系下你”，这天接到线上求助。一般情况下jar包冲突开发都可以自己搞定，然后听说找了好几个人，按照常规手法没有搞定。感觉是遇到了疑难杂症，我听完挺有兴趣的，有什么jar包冲突是我们没遇到过的吗？我们今天来总结下jar包冲突相关的处理手法。</p>
<p><span id="more-790"></span></p>
<p><a name="O3nk5"></a></p>
<h2>Jar包冲突的表现</h2>
<p>Jar包冲突是Java里比较常见的问题，因为Java的生态非常丰富，所以有很多第三方jar包的依赖，一般情况下使用maven来进行jar包依赖的管理。这个时候，如果一个新版，一个旧版而且新旧版接口不兼容，就会出现jar包冲突的情况。表现一般是ClassNotFoundException、NoSuchMethodException、NoClassDefFoundError等相关的报错，通常你打开源码会发现，这个方法明明就在为什么会报这个错误呢？ 有的在启动的时候就报错了还好，还有种表现就是，时好时坏。运气好，应用就起来了，运气不好，就报了上面的异常，让人非常头疼。要是测试环境都起来了，到了生产部分机器起来了，部分机器挂了，影响就比较大了。<br />由于大家都依赖了日志jar包，所以通常日志的jar包冲突比较多，感兴趣的可以自行了解日志框架相关，也有一段比较有趣的历史。<br />
<a name="FeJZ7"></a></p>
<h2>常用的排查办法</h2>
<p>常用的解决办法当时是mvn dependency:tree把依赖树打出来，然后看看相同的jar包到底是从哪被引入进来的，然后根据权衡，保留一个兼容的版本，也就是新旧版都能使用的，通常的第三方jar包都是向下兼容的，保留最新的就好了。<br />另外安利一个工具，Intellij IDEA安装一个 Dependency Analyzer的插件，图形话的界面，操作起来更加的方便。<br /><img src="/wp-content/uploads/2022/05/1.png" alt="image.png" /><br />同时我们还要知道的是，maven的依赖顺序到底是怎样的，有时候怎么感觉把依赖换一个顺序就能够解决问题呢？<br />1.间接依赖路径最短优先一个项目test依赖了a和b两个jar包。其中a-b-c1.0 ， d-e-f-c1.1 。由于c1.0路径最短，所以项目test最后使用的是c1.0。<br />2.pom文件中申明顺序优先<br />有人就问了如果 a-b-c1.0 ， d-e-c1.1 这样路径都一样怎么办？其实maven的作者也没那么傻，会以在pom文件中申明的顺序那选，如果pom文件中先申明了d再申明了a，test项目最后依赖的会是c1.1<br />所以maven依赖原则总结起来就两条：路径最短，申明顺序其次。<br />
<a name="K6q5z"></a></p>
<h2>非常规排查办法</h2>
<p>一般情况下，常规的手法能够解决80%的问题，但是不一定会能解决所有的问题。我抛两个案例来看看常规手段失效的时候，怎么排查。<br />
<a name="AHhL7"></a></p>
<h3>中间件升级带来的问题</h3>
<p>一次是在阿里的时候，升级forest的jar包导致应用起不来，通过dependency:tree分析，始终找不出问题在哪里，因为明明是forest升级，报错的却是tair的相关的类没找到，你不知道是哪个jar包冲突了，所以也无从排查。这个时候我就把新版和旧版的真正部署的jar包文件夹里的所有jar包文件列出来，通常这些文件都带了版本号了，通过这个来对比新旧版本到底是哪个jar包的版本号发生了改变带来了冲突，定位到底是哪个jar包冲突了，定位到了是哪个jar包，你才好去解决他。我记得当时分享出来之后，帮好多踩坑的同学解决了问题，下面留言说，找了好久，终于通过这个帖子解决了问题。这个问题的诡异之处是，明明升级的是中间件A,报错是中间件B的相关的类。通常你对于加载的jar包到底是哪个版本有疑惑的时候，都可以采用这种办法。<br /><img src="/wp-content/uploads/2022/05/2.png" alt="image.png" /><br />
<a name="sUgmi"></a></p>
<h3>flink的jar包冲突</h3>
<p>另外一个特殊的地方是flink的集群的jar包冲突，当flink部署集群的时候，他的jar包加载顺序是由Hadoop集群来配置的，详细了解<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.13/zh/docs/ops/debugging/debugging_classloading/">https://ci.apache.org/projects/flink/flink-docs-release-1.13/zh/docs/ops/debugging/debugging_classloading/</a><br />那么这个时候，需要求助于集群的管理员帮你排查jar包冲突问题，如果他没有时间你又没有权限怎么办呢？ 我们其实可以在抛异常的地方，打印一些日志，来寻找到当前的jar包到底是从哪里加载的。</p>
<pre><code class="language-java"> File f2 = new File(this.getClass().getResource(&quot;&quot;).getPath());
 System.out.println(f2);</code></pre>
<p><a name="Rc4nf"></a></p>
<h2>解决办法</h2>
<p>常规的解决办法就是排除，使用exclusions把旧版本排掉，引入新版本就可以了。但是也有例外的，例如新版本身既不是向下兼容的，你用的别人的jar包他需要旧版，而你需要新版，怎么办呢？</p>
<p><a name="IJ9Sj"></a></p>
<h3>终极手段</h3>
<p>这个时候可以使用maven的shade插件来支持类的重命名，让你的jar包里依赖的，始终是你需要的版本，不再会有冲突的问题，这个也是解决冲突的终极方案。<br /><img src="/wp-content/uploads/2022/05/3.png" alt="image.png" /><br />
<a name="b03Sb"></a></p>
<h2>具体案例分析</h2>
<p>说了这么多理论知识，我们回到最初的这个案例，看看如何实践。<br />具体的报错信息<br />Caused by: java.lang.NoSuchMethodError: io.netty.buffer.PooledByteBufAllocator.defaultPreferDirect()Z<br />其中PooledByteBufAllocator这个类是来自于<br />grpc-netty :1.33.1 <br />   at io.grpc.netty.Utils.getByteBufAllocator(Utils.java:128) ~[grpc-netty-1.33.1.jar:1.33.1]</p>
<p>报找不到这个方法，我们打开类看一看, 这个类来自于netty-buffer-4.1.14<br /><img src="/wp-content/uploads/2022/05/4.png" alt="image.png" /></p>
<p>一搜发现真的找不到<br /><img src="/wp-content/uploads/2022/05/5.png" alt="image.png" /></p>
<p>这个类既存在于netty-buffer也存在于netty-all， 我们保留最新版nett-all，解决了这个PooledByteBufAllocator这个类的兼容问题。</p>
<p>接着报了第二个错误，遇到错误不要慌，我们先分析一下看看。</p>
<p>Caused by: java.lang.NoSuchMethodError: io.netty.util.ResourceLeakDetector.addExclusions(Ljava/lang/Class;[Ljava/lang/String;)V</p>
<p>这个地方有个问题在于，我们无法确定ResourceLeakDetector到底从哪里加载的，打开了源代码明明看到了这个方法，为何找不到呢？ 我们可以利用IDEA的断点调试功能，打印出这个class到底从哪里加载的<br /><img src="/wp-content/uploads/2022/05/6.png" alt="image.png" /></p>
<p>打开之后我们发现是，netty-common和netty-all冲突了，里面都有这个类，而netty-common里没有这个方法。<br /><img src="/wp-content/uploads/2022/05/7.png" alt="image.png" /></p>
<p>应用总算是起来了，但是一请求就报错了，报了第三个错误，这个果然还是有点棘手的。<br /><img src="/wp-content/uploads/2022/05/8.png" alt="image.png" /></p>
<p>这个在运行的时候，报了一个AbstractMethodError，这个错误很明显，你调用了一个抽象方法。<br />我们继续打开类OwlThreadLocalScopeManager来分析下，发现在这里发生调用的，也就是soa的soa - 3.4.2的这个版本，调用了OwlThreadLocalScopeManager.activate(Span span)的方法<br /><img src="/wp-content/uploads/2022/05/9.png" alt="image.png" /><br />然后我们打开这个类发现，这个类根本没实现activate(Span span)的方法<br /><img src="/wp-content/uploads/2022/05/10.png" alt="image.png" /></p>
<p>这个就比较麻烦了，这个类都没有实现这个接口的方法，怎么会被调用到。可能是编译的时候，用的版本和运行时用的版本不一致导致的。问了相关的开发，发现可能依赖了冲突的import导入所致。<br />我去检查了发现了这个东西，果然是通过scope为import的方式导入了另外一个包，而这个包里包含了太多的内容，甚至指定了soa的版本，因此导致了非常多的冲突。 找到问题就比较好解决了。</p>
<p>解决的办法其实很简单，定位到代码所在行，打开源代码进行分析，看看这个代码属于哪个jar的，然后就知道要怎么排除了。<br />有时候IEDA会有些缓存，导致你明明修改了pom.xml里的版本，结果加载的还是老的。这个时候一些常规手段，是reimport，再不行，删除target目录，重启IDEA，删除.m2的下载到本地的仓库，强行让他重新加载。</p>
]]></content:encoded>
			<wfw:commentRss>https://huster.top/htmls/790.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>如何用java.io.*写一个服务器</title>
		<link>https://huster.top/htmls/780.html</link>
		<comments>https://huster.top/htmls/780.html#respond</comments>
		<pubDate>Fri, 08 Apr 2022 13:10:54 +0000</pubDate>
		<dc:creator><![CDATA[龙安_任天兵]]></dc:creator>
				<category><![CDATA[Java学习]]></category>
		<category><![CDATA[netty]]></category>

		<guid isPermaLink="false">https://huster.top/?p=780</guid>
		<description><![CDATA[写一个服务器 最近在看java nio相关的东西，照着书上的代码写了一个示例，然后就遇到了问题。为什么我们的服 &#8230; <a href="https://huster.top/htmls/780.html" class="more-link">继续阅读<span class="screen-reader-text">“如何用java.io.*写一个服务器”</span></a>]]></description>
				<content:encoded><![CDATA[<h1>写一个服务器</h1>
<p>最近在看java nio相关的东西，照着书上的代码写了一个示例，然后就遇到了问题。为什么我们的服务器，只能接受一个请求，就卡在那里了，他到底在干啥呢？</p>
<p><span id="more-780"></span></p>
<p>我们先写一个简单的server</p>
<pre><code class="language-java">package top.huster.server.bio;

import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.Date;

/***
 * @Author : rentianbing
 * @Date : 2021/3/11 10:26 上午
 *
 ***/
public class TimeServerV0 {
    private final static int SERVER_PORT = 9898;

    public static void main(String[] args) throws IOException {
        ServerSocket serverSocket = new ServerSocket(SERVER_PORT);
        final Socket socket = serverSocket.accept();
        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(socket.getInputStream()));
        String content = bufferedReader.readLine();
        System.out.println(&quot;server : &quot; + content);
        BufferedWriter bufferedWriter = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream()));
        bufferedWriter.write(&quot;time is &quot; + new Date());
        bufferedWriter.flush();
    }
}
</code></pre>
<p>然后写一个client去连接,</p>
<pre><code class="language-java">package top.huster.server.bio;

import java.io.*;
import java.net.Socket;

/***
 * @Author : rentianbing
 * @Date : 2021/3/11 10:33 上午
 *
 ***/
public class TimeServerClient {
    public static void main(String[] args) throws IOException {
        Socket s = new Socket(&quot;127.0.0.1&quot;, 9898);
        //构建IO
        InputStream is = s.getInputStream();
        OutputStream os = s.getOutputStream();

        BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(os));
        //向服务器端发送一条消息
        bw.write(&quot;测试客户端和服务器通信，服务器接收到消息返回到客户端\n&quot;);
        bw.flush();

        //读取服务器返回的消息
        BufferedReader br = new BufferedReader(new InputStreamReader(is));
        String mess = br.readLine();
        System.out.println(&quot;服务器：&quot;+mess);
    }
}
</code></pre>
<p>先把server起起来，接着我们用client连上去，发现正常执行一次之后，server和client都结束了，这显然不符合我们的要求，我们要求的是server需要一直在，源源不断的接受用户请求，很简单，稍加改造，我们改成如下</p>
<pre><code class="language-java">package top.huster.server.bio;

import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.Date;

/***
 * @Author : rentianbing
 * @Date : 2021/3/11 10:26 上午
 *
 ***/
public class TimeServer {
    private final static int SERVER_PORT = 9898;

    public static void main(String[] args) throws IOException {
        ServerSocket serverSocket = new ServerSocket(SERVER_PORT);
        while (true) {
            final Socket socket = serverSocket.accept();
            new Thread(new Runnable() {
                public void run() {
                    try {
                        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(socket.getInputStream()));
                        String content = bufferedReader.readLine();
                        System.out.println(&quot;server : &quot; + content);
                        BufferedWriter bufferedWriter = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream()));
                        bufferedWriter.write(&quot;time is &quot; + new Date());

                        bufferedWriter.flush();
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                }
            }).start();
        }

    }
}
</code></pre>
<p>我们加了一个死循环进去，每当有连接进来的时候，我们交给另外一个线程去处理，但是就这么个简单的程序，发现client无法收到服务端的信息，除非断开服务端，这个是为什么呢 ？我们不得不去探究一下这个java.io包的一些类和他的功能了。</p>
<h1>几个关键的类</h1>
<h2>ServerSocket</h2>
<p>首先看看这个类，这个类是启动一个server所必须的类，这个类有4个构造方法，通过这个类的accept可以拿到一个和client端的Socket，而通过这个Socket就可以实现和client端的通信，读或者写都可以。记住这个类的核心关键，一个是构造方法，一个是accept</p>
<h2>BufferedReader</h2>
<p>接着就是读写数据，最重要的就是BufferedReader这个缓冲区，为什么要有这么个缓冲区呢？ 因为网卡/磁盘的数据要到用户空间，是一个非常漫长的过程，他们的速率相差了至少10倍，因此需要开辟一个用户空间和硬件之间的一个缓冲区。<br />这个方法的构造函数里需要一个字节流，数据以字节流的形式进行传输。<br />他有个非常重要的函数 readLine，逐行读入</p>
<h2>InputStreamReader</h2>
<p>An InputStreamReader is a bridge from byte streams to character streams: It reads bytes and decodes them into characters using a specified<br />他是streams字节流和字节的一个桥梁，能够将byte解码成字符，传递给用户使用。</p>
<p>这些可能在最初接触的时候，觉得挺复杂的，暂时不用理解太多，知道怎么写，其实就是一个固定的模式。</p>
<h1>为什么第二个版本的服务器没有数据输出</h1>
<p>我们排查看到，我们的client端阻塞在了BufferedReader.readLine这个方法里，我们研究下这个方法。<br />里面最关键的有两段，其中一个bufferLoop是不断的从外设读取数据填充到缓冲区</p>
<pre><code class="language-java"> bufferLoop:
            for (;;) {

                if (nextChar &gt;= nChars)
                    fill();
                if (nextChar &gt;= nChars) { /* EOF */
                    if (s != null &amp;&amp; s.length() &gt; 0)
                        return s.toString();
                    else
                        return null;
                }
                boolean eol = false;
                char c = 0;
                int i;

                /* Skip a leftover &#039;\n&#039;, if necessary */
                if (omitLF &amp;&amp; (cb[nextChar] == &#039;\n&#039;))
                    nextChar++;
                skipLF = false;
                omitLF = false;</code></pre>
<p>第二段，不断的从缓冲区里拿数据，知道遇到了反斜杠r反斜杠n</p>
<pre><code class="language-java"> charLoop:
                for (i = nextChar; i &lt; nChars; i++) {
                    c = cb[i];
                    if ((c == &#039;\n&#039;) || (c == &#039;\r&#039;)) {
                        eol = true;
                        break charLoop;
                    }
                }

                startChar = nextChar;
                nextChar = i;

                if (eol) {
                    String str;
                    if (s == null) {
                        str = new String(cb, startChar, i - startChar);
                    } else {
                        s.append(cb, startChar, i - startChar);
                        str = s.toString();
                    }
                    nextChar++;
                    if (c == &#039;\r&#039;) {
                        skipLF = true;
                    }
                    return str;
                }

                if (s == null)
                    s = new StringBuffer(defaultExpectedLineLength);
                s.append(cb, startChar, i - startChar);
            }</code></pre>
<p>关键的地方就在于fill()这个方法里，</p>
<pre><code class="language-java">
        int n;
        do {
            n = in.read(cb, dst, cb.length - dst);
        } while (n == 0);</code></pre>
<p>里面的in.read方法是阻塞的，当这个方法在遇到了<br />Reads characters into a portion of an array.  This method will block until some input is available, an I/O error occurs, or the end of the stream is reached.</p>
<p>所以我们的程序是在等着服务端给数据，知道遇到了IO错误或者服务端的断口，才会返回，也就才会终止charLoop的运行，这样我们就知道了，为什么我们的客户端被卡住了。</p>
]]></content:encoded>
			<wfw:commentRss>https://huster.top/htmls/780.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>CPU异常问题排查</title>
		<link>https://huster.top/htmls/748.html</link>
		<comments>https://huster.top/htmls/748.html#respond</comments>
		<pubDate>Fri, 19 Feb 2021 08:59:57 +0000</pubDate>
		<dc:creator><![CDATA[龙安_任天兵]]></dc:creator>
				<category><![CDATA[Java学习]]></category>

		<guid isPermaLink="false">https://huster.top/?p=748</guid>
		<description><![CDATA[背景 距离上次排查cpu异常问题已经过去了至少5年了，那个时候刚接触Java就遇到了hashmap导致的cpu &#8230; <a href="https://huster.top/htmls/748.html" class="more-link">继续阅读<span class="screen-reader-text">“CPU异常问题排查”</span></a>]]></description>
				<content:encoded><![CDATA[<h1 id="yInPE" data-lake-id="efdcc678a7cc822e93207d6003a42bea">背景</h1>
<p data-lake-id="4a6eeda11eeeee9313ae155a9a8b4601">距离上次排查cpu异常问题已经过去了至少5年了，那个时候刚接触Java就遇到了hashmap导致的cpu100%问题，茫然无措的时候那叫一个难，现在我们有了基本的常识之后，就不慌了，按照排查思路排查，一定能发现问题。</p>
<p data-lake-id="4a6eeda11eeeee9313ae155a9a8b4601"><span id="more-748"></span></p>
<p data-lake-id="4efa9429cbf20a923f983369310cb540">新代码发布到生产之后，出现了性能问题，cpu异常的飙高，但是又未到100%，通过压测发现性能下降的很厉害，qps不到10的时候，cpu就被打满了。那么cpu到底用在了什么地方呢？ 因为本次发布的改动点，就是算法排序模块，这个模块也是整个系统里最耗费cpu的地方，所以从这里开始入手排查。</p>
<p data-lake-id="f471f65e08065103b829829ffe127595">我们回想一下，Java里常见的cpu异常最可能是什么原因？</p>
<p data-lake-id="4c7a15502eb7206423af0a4a57507d1f">第一个最常见的就是hashmap的不正确的使用，这个是多线程里经典的面试问题，但是这个表现一般是cpu直接到100%，我们这应用cpu未到100%，只是表现异常，在同样流量的情况下，比正常代码cpu要高出很多，基本可以排除是这个问题。</p>
<p data-lake-id="c5674b6c05e3c34fb94c204cb598e952">第二个常见的就是写了一个死循环。这个时候的cpu占用也会直接是100%，像我们这种情况下，cpu一定是在大量的进行计算，应该都不满足以上两种情况</p>
<h1 id="Y5yA1" data-lake-id="be635819b2ab8094d7881b0e3aea739a">问题排查</h1>
<h2 id="cwgja" data-lake-id="823196bad940da871a5e1377df15b7af">压测环境</h2>
<p data-lake-id="49a852e19f3c4bdfdaa057b9d746b45e">幸运的是，我们的异常问题非常容易复现，不是偶发的(偶发的查起来更加困难)，拥有一个压测环境就显得非常有帮助了。首先我们把压测环境搭建好，然后进行我们的实验和猜测。</p>
<h2 id="YRNmW" data-lake-id="5c1b50d9d32a886155767074601c166f">常用cpu异常排查办法</h2>
<p data-lake-id="fe5c943105c9cadd3fe4262e65f2ecf8">要定位到问题，我们首先要知道是哪行代码导致了cpu的使用异常，常用的排查手段无非是要快速找到线程名称。</p>
<h3 id="bKka4" data-lake-id="3d7cd150bb431843cf12ab74ac7518ed">使用java自带Jstack进行排查</h3>
<p data-lake-id="99f4328cf74b7534c2957178395b60ba">这种常规的排查手段，搜索引擎上非常多，通过pid定位到占用cpu最多的线程号，然后转成16进制，再到jstack里打印出来的线程详情里取搜索，定位到线程名称。</p>
<p data-lake-id="4265cf9a10709ecb4df4061677d5dd31">线程名称就显得非常重要了，他能让你直接定位到代码，这也是我们在使用线程池的时候，强调的一定要给线程取名字的原因。你搞一个默认的名字，出现这种问题了，你无法准确定位到问题代码。</p>
<p data-lake-id="c3ee4c8a9bf10d9d29abc495dd24af72"><span class="lake-card-margin-top lake-card-margin-bottom lake-selected" data-card-type="inline" data-lake-card="image" data-card-value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F180554%2F1613720381517-24d40237-1be7-43e0-a0b0-789d9f525c0b.png%22%2C%22originWidth%22%3A633%2C%22originHeight%22%3A946%2C%22name%22%3A%22image.png%22%2C%22size%22%3A390215%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A118.82489%2C%22y%22%3A27.344824%2C%22width%22%3A238.50931000000003%2C%22height%22%3A15.091413%2C%22text%22%3A%22PRNIVIRTRESSHRSXCPUSMEM%22%7D%2C%7B%22x%22%3A382.09976%2C%22y%22%3A27.46406%2C%22width%22%3A98.84084000000001%2C%22height%22%3A13.062734000000003%2C%22text%22%3A%22TIME%2BCOMMAND%22%7D%2C%7B%22x%22%3A18.33537%2C%22y%22%3A27.898624%2C%22width%22%3A56.92681%2C%22height%22%3A11.989208999999999%2C%22text%22%3A%22PIDUSER%22%7D%2C%7B%22x%22%3A163.8598%2C%22y%22%3A44.19278%2C%22width%22%3A192.02652%2C%22height%22%3A15.085315000000001%2C%22text%22%3A%2218.0g7.9g15mS2.050.0%22%7D%2C%7B%22x%22%3A375.02774%2C%22y%22%3A44.8717%2C%22width%22%3A85.36076000000003%2C%22height%22%3A12.651608000000003%2C%22text%22%3A%221%3A00.64jqva%22%7D%2C%7B%22x%22%3A7.5115223%2C%22y%22%3A44.98157%2C%22width%22%3A80.9545377%2C%22height%22%3A13.912210000000002%2C%22text%22%3A%2211329deploy%22%7D%2C%7B%22x%22%3A116.14907%2C%22y%22%3A45.416393%2C%22width%22%3A15.473289999999992%2C%22height%22%3A11.557282%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A116.08461%2C%22y%22%3A61.33384%2C%22width%22%3A15.90279000000001%2C%22height%22%3A12.386469999999996%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A374.08533%2C%22y%22%3A61.378605%2C%22width%22%3A87.27733999999998%2C%22height%22%3A13.229125000000003%2C%22text%22%3A%220%3A11.14jqva%22%7D%2C%7B%22x%22%3A163.3114%2C%22y%22%3A61.219868%2C%22width%22%3A194.10899999999998%2C%22height%22%3A14.147672000000007%2C%22text%22%3A%2218.0g7.9g15mS2.050.0%22%7D%2C%7B%22x%22%3A4.263019%2C%22y%22%3A62.083603%2C%22width%22%3A87.669476%2C%22height%22%3A15.41847700000001%2C%22text%22%3A%2231413deploy%22%7D%2C%7B%22x%22%3A161.57594%2C%22y%22%3A77.93866%2C%22width%22%3A195.70906000000002%2C%22height%22%3A14.366554000000008%2C%22text%22%3A%2218.0g7.9g15ms1.650.0%22%7D%2C%7B%22x%22%3A117.173065%2C%22y%22%3A78.76963%2C%22width%22%3A14.917925000000011%2C%22height%22%3A11.61242999999999%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A4.1563554%2C%22y%22%3A78.78524%2C%22width%22%3A89.5151306%2C%22height%22%3A16.274085999999997%2C%22text%22%3A%2211501deploy%22%7D%2C%7B%22x%22%3A374.37427%2C%22y%22%3A78.98195%2C%22width%22%3A85.57102999999995%2C%22height%22%3A12.022419999999997%2C%22text%22%3A%220%3A44.15java%22%7D%2C%7B%22x%22%3A3.6119735%2C%22y%22%3A94.809395%2C%22width%22%3A88.9369005%2C%22height%22%3A17.451019000000002%2C%22text%22%3A%2222017deploy%22%7D%2C%7B%22x%22%3A115.476906%2C%22y%22%3A95.1519%2C%22width%22%3A17.08768400000001%2C%22height%22%3A13.20966%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A161.83388%2C%22y%22%3A95.27288%2C%22width%22%3A195.56212000000002%2C%22height%22%3A14.163894999999997%2C%22text%22%3A%2218.0g7.9g15ms1.650.0%22%7D%2C%7B%22x%22%3A373.859%2C%22y%22%3A96.16821%2C%22width%22%3A86.52750000000003%2C%22height%22%3A11.918239999999997%2C%22text%22%3A%220%3A16.16jqva%22%7D%2C%7B%22x%22%3A3.0360842%2C%22y%22%3A111.36907%2C%22width%22%3A47.559927800000004%2C%22height%22%3A15.070270000000008%2C%22text%22%3A%2222027%22%7D%2C%7B%22x%22%3A116.59106%2C%22y%22%3A111.998634%2C%22width%22%3A15.090239999999994%2C%22height%22%3A12.780090999999999%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A41.58159%2C%22y%22%3A112.393745%2C%22width%22%3A50.63438%2C%22height%22%3A16.350475000000017%2C%22text%22%3A%22deploy%22%7D%2C%7B%22x%22%3A155.14426%2C%22y%22%3A112.67292%2C%22width%22%3A201.88658999999998%2C%22height%22%3A13.454444999999993%2C%22text%22%3A%22018.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A374.07855%2C%22y%22%3A113.41086%2C%22width%22%3A86.65634999999997%2C%22height%22%3A12.164259999999999%2C%22text%22%3A%220%3A15.73java%22%7D%2C%7B%22x%22%3A2.9770093%2C%22y%22%3A128.32213%2C%22width%22%3A89.8462867%2C%22height%22%3A18.148480000000006%2C%22text%22%3A%2222042deploy%22%7D%2C%7B%22x%22%3A115.767654%2C%22y%22%3A129.40685%2C%22width%22%3A16.04977600000001%2C%22height%22%3A12.571680000000015%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A374.51086%2C%22y%22%3A129.732%2C%22width%22%3A85.61768000000001%2C%22height%22%3A13.361809999999991%2C%22text%22%3A%220%3A15.88java%22%7D%2C%7B%22x%22%3A153.82895%2C%22y%22%3A129.91365%2C%22width%22%3A203.97882%2C%22height%22%3A13.711950000000002%2C%22text%22%3A%22018.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A154.0865%2C%22y%22%3A145.89775%2C%22width%22%3A204.6689%2C%22height%22%3A14.985410000000002%2C%22text%22%3A%22018.0g7.9g15mR1.650.0%22%7D%2C%7B%22x%22%3A3.3347235%2C%22y%22%3A146.40059%2C%22width%22%3A47.570683499999994%2C%22height%22%3A14.705060000000003%2C%22text%22%3A%2222665%22%7D%2C%7B%22x%22%3A114.96114%2C%22y%22%3A146.48773%2C%22width%22%3A17.059179999999998%2C%22height%22%3A13.224819999999994%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A373.36703%2C%22y%22%3A146.88857%2C%22width%22%3A87.29511000000002%2C%22height%22%3A12.687390000000022%2C%22text%22%3A%220%3A14.38jqva%22%7D%2C%7B%22x%22%3A40.71341%2C%22y%22%3A147.8694%2C%22width%22%3A51.678329999999995%2C%22height%22%3A14.960069999999973%2C%22text%22%3A%22deploy%22%7D%2C%7B%22x%22%3A3.3452024%2C%22y%22%3A162.7998%2C%22width%22%3A87.5420776%2C%22height%22%3A17.531599999999997%2C%22text%22%3A%2222739deploy%22%7D%2C%7B%22x%22%3A115.69442%2C%22y%22%3A163.47385%2C%22width%22%3A16.325220000000016%2C%22height%22%3A12.597250000000003%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A162.08629%2C%22y%22%3A163.54762%2C%22width%22%3A195.18301%2C%22height%22%3A12.93568000000002%2C%22text%22%3A%2218.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A375.3793%2C%22y%22%3A164.06934%2C%22width%22%3A85.27170000000001%2C%22height%22%3A12.70295999999999%2C%22text%22%3A%22D%3A14.26java%22%7D%2C%7B%22x%22%3A3.406898%2C%22y%22%3A180.15181%2C%22width%22%3A89.840812%2C%22height%22%3A16.45408999999998%2C%22text%22%3A%2222762deploy%22%7D%2C%7B%22x%22%3A374.48758%2C%22y%22%3A180.4819%2C%22width%22%3A85.89484000000004%2C%22height%22%3A12.34763000000001%2C%22text%22%3A%220%3A14.54iava%22%7D%2C%7B%22x%22%3A153.63963%2C%22y%22%3A180.56099%2C%22width%22%3A204.60634%2C%22height%22%3A13.673869999999994%2C%22text%22%3A%22018.0g7.9g15ms1.650.0%22%7D%2C%7B%22x%22%3A115.622925%2C%22y%22%3A180.60434%2C%22width%22%3A16.581395%2C%22height%22%3A12.861769999999979%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A153.88817%2C%22y%22%3A196.80159%2C%22width%22%3A203.42685999999998%2C%22height%22%3A14.674239999999998%2C%22text%22%3A%22018.0g7.9g15ms1.650.0%22%7D%2C%7B%22x%22%3A3.009803%2C%22y%22%3A197.15501%2C%22width%22%3A90.978307%2C%22height%22%3A16.63076000000001%2C%22text%22%3A%2222831deploy%22%7D%2C%7B%22x%22%3A116.392975%2C%22y%22%3A197.49693%2C%22width%22%3A15.918444999999991%2C%22height%22%3A12.13327000000001%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A374.58295%2C%22y%22%3A197.72983%2C%22width%22%3A85.45672000000002%2C%22height%22%3A12.532759999999996%2C%22text%22%3A%220%3A13.62java%22%7D%2C%7B%22x%22%3A115.339226%2C%22y%22%3A214.48514%2C%22width%22%3A17.02809400000001%2C%22height%22%3A12.758600000000001%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A3.2298632%2C%22y%22%3A214.66476%2C%22width%22%3A91.20810180000001%2C%22height%22%3A17.121219999999994%2C%22text%22%3A%2223157deploy%22%7D%2C%7B%22x%22%3A156.64354%2C%22y%22%3A213.6932%2C%22width%22%3A201.45845999999997%2C%22height%22%3A14.713000000000022%2C%22text%22%3A%2218.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A373.88602%2C%22y%22%3A215.06844%2C%22width%22%3A86.75271000000004%2C%22height%22%3A12.41574%2C%22text%22%3A%220%3A13.05java%22%7D%2C%7B%22x%22%3A2.7624629%2C%22y%22%3A229.9685%2C%22width%22%3A90.70017709999999%2C%22height%22%3A18.985129999999998%2C%22text%22%3A%2223162deploy%22%7D%2C%7B%22x%22%3A162.70908%2C%22y%22%3A231.65947%2C%22width%22%3A194.32502000000002%2C%22height%22%3A13.002399999999994%2C%22text%22%3A%2218.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A116.36464%2C%22y%22%3A231.99121%2C%22width%22%3A15.353120000000004%2C%22height%22%3A11.976429999999993%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A374.14133%2C%22y%22%3A232.51846%2C%22width%22%3A86.05902000000003%2C%22height%22%3A11.341800000000006%2C%22text%22%3A%220%3A13.38java%22%7D%2C%7B%22x%22%3A162.18625%2C%22y%22%3A248.47664%2C%22width%22%3A194.99215%2C%22height%22%3A13.208560000000006%2C%22text%22%3A%2218.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A3.9947445%2C%22y%22%3A249.06427%2C%22width%22%3A88.38251550000001%2C%22height%22%3A16.666169999999994%2C%22text%22%3A%2223199deploy%22%7D%2C%7B%22x%22%3A374.39496%2C%22y%22%3A249.07312%2C%22width%22%3A85.41263999999995%2C%22height%22%3A12.523280000000028%2C%22text%22%3A%220%3A12.83java%22%7D%2C%7B%22x%22%3A153.67274%2C%22y%22%3A265.06342%2C%22width%22%3A204.66806%2C%22height%22%3A14.065780000000018%2C%22text%22%3A%22018.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A3.9221208%2C%22y%22%3A265.40494%2C%22width%22%3A88.1454792%2C%22height%22%3A17.178679999999986%2C%22text%22%3A%2223248deploy%22%7D%2C%7B%22x%22%3A374.3118%2C%22y%22%3A265.4086%2C%22width%22%3A85.91771999999997%2C%22height%22%3A12.846100000000035%2C%22text%22%3A%220%3A13.21java%22%7D%2C%7B%22x%22%3A116.105804%2C%22y%22%3A265.60855%2C%22width%22%3A15.710126000000002%2C%22height%22%3A12.381200000000035%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A161.66159%2C%22y%22%3A281.8295%2C%22width%22%3A196.07504%2C%22height%22%3A13.597230000000025%2C%22text%22%3A%2218.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A115.06015%2C%22y%22%3A282.33777%2C%22width%22%3A17.22559000000001%2C%22height%22%3A12.582150000000013%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A4.225523%2C%22y%22%3A282.39587%2C%22width%22%3A87.91189700000001%2C%22height%22%3A16.74970000000002%2C%22text%22%3A%2230796deploy%22%7D%2C%7B%22x%22%3A375.6132%2C%22y%22%3A283.13385%2C%22width%22%3A84.49759999999998%2C%22height%22%3A12.367279999999994%2C%22text%22%3A%220%3A11.22java%22%7D%2C%7B%22x%22%3A3.8653696%2C%22y%22%3A297.66824%2C%22width%22%3A87.6844604%2C%22height%22%3A17.86695999999995%2C%22text%22%3A%2230821deploy%22%7D%2C%7B%22x%22%3A115.43402%2C%22y%22%3A299.43768%2C%22width%22%3A16.99557999999999%2C%22height%22%3A12.80707000000001%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A151.54428%2C%22y%22%3A299.3689%2C%22width%22%3A207.01236000000003%2C%22height%22%3A13.33883000000003%2C%22text%22%3A%22018.0g7.9g15ms1.650.0%22%7D%2C%7B%22x%22%3A374.4502%2C%22y%22%3A299.96774%2C%22width%22%3A85.85989999999998%2C%22height%22%3A11.910529999999994%2C%22text%22%3A%220%3A11.00java%22%7D%2C%7B%22x%22%3A4.6286664%2C%22y%22%3A316.45746%2C%22width%22%3A86.0231586%2C%22height%22%3A15.494259999999997%2C%22text%22%3A%2231354deploy%22%7D%2C%7B%22x%22%3A152.34102%2C%22y%22%3A316.54117%2C%22width%22%3A205.47850000000003%2C%22height%22%3A13.150789999999972%2C%22text%22%3A%22018.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A116.22801%2C%22y%22%3A316.9857%2C%22width%22%3A16.22807999999999%2C%22height%22%3A12.016039999999975%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A374.73718%2C%22y%22%3A317.1406%2C%22width%22%3A85.90517999999997%2C%22height%22%3A12.30455999999998%2C%22text%22%3A%220%3A10.68java%22%7D%2C%7B%22x%22%3A115.67625%2C%22y%22%3A333.7243%2C%22width%22%3A16.701800000000006%2C%22height%22%3A12.617529999999988%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A373.9443%2C%22y%22%3A333.8947%2C%22width%22%3A87.11725000000001%2C%22height%22%3A13.131799999999998%2C%22text%22%3A%220%3A10.95jqva%22%7D%2C%7B%22x%22%3A4.3956285%2C%22y%22%3A334.0777%2C%22width%22%3A86.7911215%2C%22height%22%3A15.902980000000014%2C%22text%22%3A%2231378deploy%22%7D%2C%7B%22x%22%3A154.70294%2C%22y%22%3A332.89804%2C%22width%22%3A203.9588%2C%22height%22%3A14.531890000000033%2C%22text%22%3A%22018.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A46.614494%2C%22y%22%3A349.82834%2C%22width%22%3A46.085956%2C%22height%22%3A15.883299999999963%2C%22text%22%3A%22deploy%22%7D%2C%7B%22x%22%3A373.93448%2C%22y%22%3A351.055%2C%22width%22%3A86.30115%2C%22height%22%3A11.546780000000012%2C%22text%22%3A%220%3A10.67java%22%7D%2C%7B%22x%22%3A117.052475%2C%22y%22%3A351.08582%2C%22width%22%3A14.753934999999998%2C%22height%22%3A11.457240000000013%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A5.3443875%2C%22y%22%3A350.84152%2C%22width%22%3A35.1538005%2C%22height%22%3A12.566809999999975%2C%22text%22%3A%2231382%22%7D%2C%7B%22x%22%3A163.44627%2C%22y%22%3A351.02405%2C%22width%22%3A193.33559%2C%22height%22%3A12.387630000000001%2C%22text%22%3A%2218.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A374.339%2C%22y%22%3A367.45395%2C%22width%22%3A85.1592%2C%22height%22%3A12.690650000000005%2C%22text%22%3A%220%3A10.73java%22%7D%2C%7B%22x%22%3A5.60193%2C%22y%22%3A367.73105%2C%22width%22%3A85.37989%2C%22height%22%3A14.961250000000007%2C%22text%22%3A%2231402deploy%22%7D%2C%7B%22x%22%3A115.76553%2C%22y%22%3A367.81055%2C%22width%22%3A16.02506000000001%2C%22height%22%3A11.99929000000003%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A156.6705%2C%22y%22%3A367.93124%2C%22width%22%3A200.39229999999998%2C%22height%22%3A12.843560000000025%2C%22text%22%3A%2218.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A116.04494%2C%22y%22%3A384.2068%2C%22width%22%3A16.377219999999994%2C%22height%22%3A13.039480000000026%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A151.7834%2C%22y%22%3A384.7497%2C%22width%22%3A205.2884%2C%22height%22%3A12.985299999999995%2C%22text%22%3A%22018.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A5.3661513%2C%22y%22%3A384.7795%2C%22width%22%3A85.0050687%2C%22height%22%3A15.074839999999995%2C%22text%22%3A%2231691deploy%22%7D%2C%7B%22x%22%3A374.1657%2C%22y%22%3A384.99588%2C%22width%22%3A86.25961999999998%2C%22height%22%3A12.168639999999982%2C%22text%22%3A%220%3A10.89jqva%22%7D%2C%7B%22x%22%3A114.78116%2C%22y%22%3A401.18887%2C%22width%22%3A18.110500000000002%2C%22height%22%3A12.557129999999972%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A19.015404%2C%22y%22%3A401.5303%2C%22width%22%3A72.101146%2C%22height%22%3A15.153230000000008%2C%22text%22%3A%22568deploy%22%7D%2C%7B%22x%22%3A154.15038%2C%22y%22%3A401.19397%2C%22width%22%3A203.31033999999997%2C%22height%22%3A13.673680000000047%2C%22text%22%3A%22018.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A374.92053%2C%22y%22%3A402.5273%2C%22width%22%3A84.78742%2C%22height%22%3A12.091779999999972%2C%22text%22%3A%220%3A10.10java%22%7D%2C%7B%22x%22%3A19.234623%2C%22y%22%3A417.65332%2C%22width%22%3A71.971287%2C%22height%22%3A15.933879999999988%2C%22text%22%3A%22594deploy%22%7D%2C%7B%22x%22%3A154.02518%2C%22y%22%3A418.31052%2C%22width%22%3A204.29128999999998%2C%22height%22%3A13.607880000000023%2C%22text%22%3A%22018.0g7.9g15ms1.650.0%22%7D%2C%7B%22x%22%3A374.43796%2C%22y%22%3A418.39554%2C%22width%22%3A86.17978000000005%2C%22height%22%3A12.903110000000027%2C%22text%22%3A%220%3A09.98jqva%22%7D%2C%7B%22x%22%3A115.40548%2C%22y%22%3A418.45187%2C%22width%22%3A17.205910000000003%2C%22height%22%3A12.731359999999995%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A152.066%2C%22y%22%3A435.53568%2C%22width%22%3A205.66886000000002%2C%22height%22%3A13.29001999999997%2C%22text%22%3A%22018.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A18.811874%2C%22y%22%3A435.8394%2C%22width%22%3A71.89329599999999%2C%22height%22%3A16.00837999999999%2C%22text%22%3A%22783deploy%22%7D%2C%7B%22x%22%3A373.46704%2C%22y%22%3A435.8687%2C%22width%22%3A87.21506%2C%22height%22%3A12.780129999999986%2C%22text%22%3A%220%3A10.07java%22%7D%2C%7B%22x%22%3A115.83219%2C%22y%22%3A435.93204%2C%22width%22%3A16.27333999999999%2C%22height%22%3A11.906740000000013%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A148.92152%2C%22y%22%3A452.15735%2C%22width%22%3A210.32573000000002%2C%22height%22%3A13.730849999999975%2C%22text%22%3A%22018.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A373.38098%2C%22y%22%3A452.8305%2C%22width%22%3A87.60064999999997%2C%22height%22%3A12.867930000000001%2C%22text%22%3A%220%3A10.27jqva%22%7D%2C%7B%22x%22%3A17.98314%2C%22y%22%3A453.06427%2C%22width%22%3A73.92817%2C%22height%22%3A15.700559999999996%2C%22text%22%3A%22820deploy%22%7D%2C%7B%22x%22%3A115.974556%2C%22y%22%3A453.2157%2C%22width%22%3A16.03582399999999%2C%22height%22%3A12.080139999999972%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A17.211113%2C%22y%22%3A468.8212%2C%22width%22%3A73.994567%2C%22height%22%3A15.592200000000048%2C%22text%22%3A%22885deploy%22%7D%2C%7B%22x%22%3A160.97105%2C%22y%22%3A469.4327%2C%22width%22%3A195.37243%2C%22height%22%3A12.631939999999986%2C%22text%22%3A%2218.0g7.9g15mS1.650.0%22%7D%2C%7B%22x%22%3A374.49188%2C%22y%22%3A469.4583%2C%22width%22%3A86.23465000000004%2C%22height%22%3A12.885049999999978%2C%22text%22%3A%220%3A10.02java%22%7D%2C%7B%22x%22%3A117.05829%2C%22y%22%3A469.8088%2C%22width%22%3A14.50976%2C%22height%22%3A11.508429999999976%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A4.3583965%2C%22y%22%3A485.53647%2C%22width%22%3A86.20322350000001%2C%22height%22%3A15.638149999999996%2C%22text%22%3A%2211204deploy%22%7D%2C%7B%22x%22%3A374.35095%2C%22y%22%3A486.3114%2C%22width%22%3A86.07022%2C%22height%22%3A12.71859999999998%2C%22text%22%3A%220%3A39.82java%22%7D%2C%7B%22x%22%3A162.83742%2C%22y%22%3A486.51227%2C%22width%22%3A194.00707999999997%2C%22height%22%3A12.994050000000016%2C%22text%22%3A%2218.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A115.75557%2C%22y%22%3A486.76678%2C%22width%22%3A16.031479999999988%2C%22height%22%3A12.174050000000022%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A4.08774%2C%22y%22%3A502.55322%2C%22width%22%3A86.94024%2C%22height%22%3A16.55120999999997%2C%22text%22%3A%2211205deploy%22%7D%2C%7B%22x%22%3A116.363625%2C%22y%22%3A503.4998%2C%22width%22%3A15.779105000000001%2C%22height%22%3A12.488099999999974%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A374.21237%2C%22y%22%3A503.84412%2C%22width%22%3A85.96202999999997%2C%22height%22%3A12.65967999999998%2C%22text%22%3A%220%3A39.99jqva%22%7D%2C%7B%22x%22%3A155.13202%2C%22y%22%3A503.8899%2C%22width%22%3A201.85305999999997%2C%22height%22%3A12.935399999999959%2C%22text%22%3A%22018.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A115.83197%2C%22y%22%3A520.0205%2C%22width%22%3A16.96077000000001%2C%22height%22%3A13.380800000000022%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A4.828784%2C%22y%22%3A520.5182%2C%22width%22%3A86.261876%2C%22height%22%3A15.575240000000008%2C%22text%22%3A%2211206deploy%22%7D%2C%7B%22x%22%3A155.79314%2C%22y%22%3A520.12396%2C%22width%22%3A201.69740000000002%2C%22height%22%3A14.097239999999942%2C%22text%22%3A%22018.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A374.09888%2C%22y%22%3A521.4387%2C%22width%22%3A85.99703999999997%2C%22height%22%3A12.077049999999986%2C%22text%22%3A%220%3A40.26java%22%7D%2C%7B%22x%22%3A4.030502%2C%22y%22%3A535.7628%2C%22width%22%3A89.405298%2C%22height%22%3A17.46180000000004%2C%22text%22%3A%2211207deploy%22%7D%2C%7B%22x%22%3A374.14975%2C%22y%22%3A537.29877%2C%22width%22%3A86.50815%2C%22height%22%3A13.095630000000028%2C%22text%22%3A%220%3A39.78java%22%7D%2C%7B%22x%22%3A116.17991%2C%22y%22%3A537.4004%2C%22width%22%3A15.948419999999999%2C%22height%22%3A12.421600000000012%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A153.52486%2C%22y%22%3A537.366%2C%22width%22%3A204.9087%2C%22height%22%3A14.184399999999982%2C%22text%22%3A%22018.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A4.3836875%2C%22y%22%3A553.6097%2C%22width%22%3A88.57241250000001%2C%22height%22%3A17.43500000000006%2C%22text%22%3A%2211208deploy%22%7D%2C%7B%22x%22%3A150.45964%2C%22y%22%3A554.2735%2C%22width%22%3A208.08723999999998%2C%22height%22%3A14.111099999999965%2C%22text%22%3A%22018.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A114.96446%2C%22y%22%3A554.35974%2C%22width%22%3A17.46338%2C%22height%22%3A12.536010000000033%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A374.35736%2C%22y%22%3A555.3183%2C%22width%22%3A86.04683999999997%2C%22height%22%3A12.917900000000031%2C%22text%22%3A%220%3A39.81jqva%22%7D%2C%7B%22x%22%3A149.04883%2C%22y%22%3A570.5858%2C%22width%22%3A210.08029%2C%22height%22%3A15.564350000000104%2C%22text%22%3A%22018.0g7.9g15ms1.350.0%22%7D%2C%7B%22x%22%3A4.177743%2C%22y%22%3A571.0356%2C%22width%22%3A89.17307199999999%2C%22height%22%3A17.937799999999925%2C%22text%22%3A%2211209deploy%22%7D%2C%7B%22x%22%3A115.14835%2C%22y%22%3A571.6684%2C%22width%22%3A17.376599999999996%2C%22height%22%3A12.53923999999995%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A373.46924%2C%22y%22%3A572.09674%2C%22width%22%3A87.01180999999997%2C%22height%22%3A12.297860000000014%2C%22text%22%3A%220%3A39.35java%22%7D%2C%7B%22x%22%3A47.069542%2C%22y%22%3A587.2968%2C%22width%22%3A46.002718%2C%22height%22%3A17.74007000000006%2C%22text%22%3A%22deploy%22%7D%2C%7B%22x%22%3A162.80254%2C%22y%22%3A588.0102%2C%22width%22%3A194.14073%2C%22height%22%3A13.579099999999926%2C%22text%22%3A%2218.0g7.9g15ms1.350.0%22%7D%2C%7B%22x%22%3A375.42102%2C%22y%22%3A589.4588%2C%22width%22%3A85.19150000000002%2C%22height%22%3A11.976139999999987%2C%22text%22%3A%22Q%3A39.98java%22%7D%2C%7B%22x%22%3A4.9141283%2C%22y%22%3A589.4376%2C%22width%22%3A36.3291847%2C%22height%22%3A12.892299999999977%2C%22text%22%3A%2211210%22%7D%2C%7B%22x%22%3A5.3939586%2C%22y%22%3A603.2689%2C%22width%22%3A86.5926514%2C%22height%22%3A16.531939999999963%2C%22text%22%3A%2211211deploy%22%7D%2C%7B%22x%22%3A163.18929%2C%22y%22%3A605.25305%2C%22width%22%3A194.37125999999998%2C%22height%22%3A13.58001999999999%2C%22text%22%3A%2218.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A115.42176%2C%22y%22%3A605.5272%2C%22width%22%3A16.623680000000007%2C%22height%22%3A12.50843999999995%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A374.4741%2C%22y%22%3A606.02264%2C%22width%22%3A85.93642%2C%22height%22%3A12.20031999999992%2C%22text%22%3A%220%3A40.19jqva%22%7D%2C%7B%22x%22%3A162.27655%2C%22y%22%3A621.242%2C%22width%22%3A195.16375%2C%22height%22%3A15.219550000000027%2C%22text%22%3A%2218.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A5.9388833%2C%22y%22%3A621.7116%2C%22width%22%3A86.4829167%2C%22height%22%3A15.674800000000005%2C%22text%22%3A%2211848deploy%22%7D%2C%7B%22x%22%3A116.47166%2C%22y%22%3A623.00745%2C%22width%22%3A15.699529999999996%2C%22height%22%3A11.535750000000007%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A374.55466%2C%22y%22%3A623.03394%2C%22width%22%3A85.39736999999997%2C%22height%22%3A11.680659999999989%2C%22text%22%3A%22D%3A20.76java%22%7D%2C%7B%22x%22%3A3.845518%2C%22y%22%3A636.8297%2C%22width%22%3A88.529372%2C%22height%22%3A20.234000000000037%2C%22text%22%3A%2211955deploy%22%7D%2C%7B%22x%22%3A115.452156%2C%22y%22%3A639.1688%2C%22width%22%3A17.447134000000005%2C%22height%22%3A13.003559999999993%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A156.6568%2C%22y%22%3A639.1838%2C%22width%22%3A200.72414999999998%2C%22height%22%3A14.001999999999953%2C%22text%22%3A%22018.0g7.9g15ms1.350.0%22%7D%2C%7B%22x%22%3A374.06345%2C%22y%22%3A640.0164%2C%22width%22%3A86.21010999999999%2C%22height%22%3A12.16755999999998%2C%22text%22%3A%220%3A20.22jqva%22%7D%2C%7B%22x%22%3A2.6973422%2C%22y%22%3A654.5102%2C%22width%22%3A89.47713780000001%2C%22height%22%3A17.633049999999912%2C%22text%22%3A%2212645deploy%22%7D%2C%7B%22x%22%3A116.49486%2C%22y%22%3A655.9856%2C%22width%22%3A15.301509999999993%2C%22height%22%3A12.968870000000038%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A155.36295%2C%22y%22%3A656.54016%2C%22width%22%3A201.64198999999996%2C%22height%22%3A13.242489999999975%2C%22text%22%3A%22018.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A374.06732%2C%22y%22%3A657.5051%2C%22width%22%3A86.61826000000002%2C%22height%22%3A11.606800000000021%2C%22text%22%3A%220%3A19.65java%22%7D%2C%7B%22x%22%3A3.451945%2C%22y%22%3A671.5016%2C%22width%22%3A89.30313500000001%2C%22height%22%3A19.950199999999995%2C%22text%22%3A%2212811deploy%22%7D%2C%7B%22x%22%3A115.61715%2C%22y%22%3A673.3658%2C%22width%22%3A16.159779999999998%2C%22height%22%3A12.541849999999954%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A154.28043%2C%22y%22%3A673.48157%2C%22width%22%3A203.64004000000003%2C%22height%22%3A13.940979999999968%2C%22text%22%3A%22018.0g7.9g15ms1.350.0%22%7D%2C%7B%22x%22%3A374.73184%2C%22y%22%3A674.0945%2C%22width%22%3A85.10480000000001%2C%22height%22%3A13.288900000000012%2C%22text%22%3A%220%3A20.2zjava%22%7D%2C%7B%22x%22%3A2.574845%2C%22y%22%3A689.18427%2C%22width%22%3A90.04891500000001%2C%22height%22%3A18.611830000000054%2C%22text%22%3A%2213081deploy%22%7D%2C%7B%22x%22%3A155.05%2C%22y%22%3A689.9772%2C%22width%22%3A203.56043999999997%2C%22height%22%3A14.83346999999992%2C%22text%22%3A%22018.0g7.9g15ms1.350.0%22%7D%2C%7B%22x%22%3A115.053696%2C%22y%22%3A690.5051%2C%22width%22%3A16.901133999999985%2C%22height%22%3A13.208340000000021%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A374.2082%2C%22y%22%3A691.0187%2C%22width%22%3A86.22430000000003%2C%22height%22%3A12.417700000000082%2C%22text%22%3A%220%3A19.62jqva%22%7D%2C%7B%22x%22%3A3.5892873%2C%22y%22%3A706.4362%2C%22width%22%3A88.3813777%2C%22height%22%3A18.45150000000001%2C%22text%22%3A%2213091deploy%22%7D%2C%7B%22x%22%3A162.12283%2C%22y%22%3A707.1887%2C%22width%22%3A195.13541%2C%22height%22%3A13.207969999999932%2C%22text%22%3A%2218.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A115.79179%2C%22y%22%3A707.52356%2C%22width%22%3A16.219379999999987%2C%22height%22%3A12.54934000000003%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A376.0407%2C%22y%22%3A708.57794%2C%22width%22%3A84.45497%2C%22height%22%3A11.898559999999975%2C%22text%22%3A%220%3A20.45java%22%7D%2C%7B%22x%22%3A3.438675%2C%22y%22%3A723.50665%2C%22width%22%3A88.81736%2C%22height%22%3A17.003049999999917%2C%22text%22%3A%2213117deploy%22%7D%2C%7B%22x%22%3A153.42752%2C%22y%22%3A724.5751%2C%22width%22%3A205.31345000000002%2C%22height%22%3A13.740940000000023%2C%22text%22%3A%22018.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A115.8082%2C%22y%22%3A724.59814%2C%22width%22%3A16.441100000000006%2C%22height%22%3A12.860960000000091%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A374.5327%2C%22y%22%3A725.0157%2C%22width%22%3A85.94078000000002%2C%22height%22%3A12.42109999999991%2C%22text%22%3A%220%3A21.44java%22%7D%2C%7B%22x%22%3A153.53053%2C%22y%22%3A740.58813%2C%22width%22%3A204.11809%2C%22height%22%3A15.23237000000006%2C%22text%22%3A%22018.0g7.9g15ms1.350.0%22%7D%2C%7B%22x%22%3A5.9729166%2C%22y%22%3A741.17%2C%22width%22%3A79.7917774%2C%22height%22%3A15.788560000000075%2C%22text%22%3A%2213697deploy%22%7D%2C%7B%22x%22%3A116.53055%2C%22y%22%3A741.4776%2C%22width%22%3A15.796509999999984%2C%22height%22%3A12.177549999999997%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A374.82632%2C%22y%22%3A741.72107%2C%22width%22%3A85.54395%2C%22height%22%3A12.51132999999993%2C%22text%22%3A%220%3A20.51java%22%7D%2C%7B%22x%22%3A3.3971193%2C%22y%22%3A757.7521%2C%22width%22%3A89.7613657%2C%22height%22%3A17.516099999999938%2C%22text%22%3A%2213732deploy%22%7D%2C%7B%22x%22%3A115.48014%2C%22y%22%3A758.5583%2C%22width%22%3A16.865530000000007%2C%22height%22%3A12.673760000000016%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A373.97516%2C%22y%22%3A758.99945%2C%22width%22%3A86.64849999999996%2C%22height%22%3A12.352949999999964%2C%22text%22%3A%220%3A20.50jqva%22%7D%2C%7B%22x%22%3A156.64323%2C%22y%22%3A757.91833%2C%22width%22%3A201.25907000000004%2C%22height%22%3A14.55433000000005%2C%22text%22%3A%22018.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A3.0779536%2C%22y%22%3A773.94037%2C%22width%22%3A89.8009364%2C%22height%22%3A18.04747999999995%2C%22text%22%3A%2213813deploy%22%7D%2C%7B%22x%22%3A116.36575%2C%22y%22%3A775.9995%2C%22width%22%3A15.360100000000003%2C%22height%22%3A11.906749999999988%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A162.87878%2C%22y%22%3A775.8533%2C%22width%22%3A193.65845000000002%2C%22height%22%3A12.730559999999969%2C%22text%22%3A%2218.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A374.0777%2C%22y%22%3A776.5601%2C%22width%22%3A86.15652%2C%22height%22%3A11.58319999999992%2C%22text%22%3A%220%3A21.00java%22%7D%2C%7B%22x%22%3A4.184921%2C%22y%22%3A791.7067%2C%22width%22%3A87.642949%2C%22height%22%3A16.988900000000058%2C%22text%22%3A%2218348deploy%22%7D%2C%7B%22x%22%3A374.59174%2C%22y%22%3A792.98944%2C%22width%22%3A85.24849999999998%2C%22height%22%3A12.486510000000067%2C%22text%22%3A%220%3A19.99jqva%22%7D%2C%7B%22x%22%3A161.90523%2C%22y%22%3A792.6788%2C%22width%22%3A195.11817%2C%22height%22%3A13.488399999999956%2C%22text%22%3A%2218.0g7.9g15ms1.350.0%22%7D%2C%7B%22x%22%3A3.285454%2C%22y%22%3A808.6179%2C%22width%22%3A88.620126%2C%22height%22%3A17.20704999999998%2C%22text%22%3A%2218358deploy%22%7D%2C%7B%22x%22%3A153.25278%2C%22y%22%3A809.11926%2C%22width%22%3A205.00181999999998%2C%22height%22%3A14.012089999999944%2C%22text%22%3A%22018.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A116.0609%2C%22y%22%3A809.59344%2C%22width%22%3A15.75224%2C%22height%22%3A12.369210000000066%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A374.60638%2C%22y%22%3A809.89606%2C%22width%22%3A85.61331999999999%2C%22height%22%3A12.440979999999968%2C%22text%22%3A%220%3A19.90jqva%22%7D%2C%7B%22x%22%3A4.0473204%2C%22y%22%3A826.248%2C%22width%22%3A88.2072646%2C%22height%22%3A16.70975999999996%2C%22text%22%3A%2221981deploy%22%7D%2C%7B%22x%22%3A115.051636%2C%22y%22%3A826.2725%2C%22width%22%3A17.25636399999999%2C%22height%22%3A12.688099999999963%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A161.76877%2C%22y%22%3A825.8608%2C%22width%22%3A195.82666000000003%2C%22height%22%3A13.458099999999945%2C%22text%22%3A%2218.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A375.72354%2C%22y%22%3A828.03015%2C%22width%22%3A84.58774%2C%22height%22%3A11.744509999999991%2C%22text%22%3A%22D%3A16.48java%22%7D%2C%7B%22x%22%3A3.876315%2C%22y%22%3A841.6698%2C%22width%22%3A87.976305%2C%22height%22%3A17.74580000000003%2C%22text%22%3A%2222162deploy%22%7D%2C%7B%22x%22%3A115.520706%2C%22y%22%3A843.4107%2C%22width%22%3A16.906794000000005%2C%22height%22%3A12.869939999999929%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A152.06335%2C%22y%22%3A843.3125%2C%22width%22%3A207.01144999999997%2C%22height%22%3A13.378000000000043%2C%22text%22%3A%22018.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A374.91605%2C%22y%22%3A843.8531%2C%22width%22%3A85.56970000000001%2C%22height%22%3A12.29079999999999%2C%22text%22%3A%220%3A15.75java%22%7D%2C%7B%22x%22%3A3.6238356%2C%22y%22%3A860.1849%2C%22width%22%3A86.8837344%2C%22height%22%3A15.632540000000063%2C%22text%22%3A%2222179deploy%22%7D%2C%7B%22x%22%3A152.73369%2C%22y%22%3A860.1866%2C%22width%22%3A205.26018000000002%2C%22height%22%3A13.793750000000045%2C%22text%22%3A%22018.0g7.9g15ms1.350.0%22%7D%2C%7B%22x%22%3A116.291794%2C%22y%22%3A861.0227%2C%22width%22%3A16.011796000000018%2C%22height%22%3A12.008550000000014%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A373.9574%2C%22y%22%3A861.0924%2C%22width%22%3A86.49149999999997%2C%22height%22%3A12.162059999999997%2C%22text%22%3A%22Q%3A15.39jqva%22%7D%2C%7B%22x%22%3A156.66603%2C%22y%22%3A876.74286%2C%22width%22%3A201.94843999999998%2C%22height%22%3A14.287779999999998%2C%22text%22%3A%22018.0g7.9g15ms1.350.0%22%7D%2C%7B%22x%22%3A4.039361%2C%22y%22%3A877.57117%2C%22width%22%3A86.601869%2C%22height%22%3A15.830529999999953%2C%22text%22%3A%2222203deploy%22%7D%2C%7B%22x%22%3A115.735794%2C%22y%22%3A877.93536%2C%22width%22%3A16.607665999999995%2C%22height%22%3A12.366700000000037%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A373.0441%2C%22y%22%3A877.98785%2C%22width%22%3A87.74721999999997%2C%22height%22%3A13.047649999999976%2C%22text%22%3A%22Q%3A16.02java%22%7D%2C%7B%22x%22%3A3.7552488%2C%22y%22%3A893.1664%2C%22width%22%3A87.59914119999999%2C%22height%22%3A16.72557000000006%2C%22text%22%3A%2222215deploy%22%7D%2C%7B%22x%22%3A373.91486%2C%22y%22%3A895.01373%2C%22width%22%3A86.38531%2C%22height%22%3A12.178099999999972%2C%22text%22%3A%220%3A15.36jqva%22%7D%2C%7B%22x%22%3A164.04028%2C%22y%22%3A895.14294%2C%22width%22%3A192.51202%2C%22height%22%3A12.180420000000026%2C%22text%22%3A%2218.0g7.9g15mS1.350.0%22%7D%2C%7B%22x%22%3A117.55115%2C%22y%22%3A895.3518%2C%22width%22%3A14.210949999999997%2C%22height%22%3A10.935999999999922%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A374.37344%2C%22y%22%3A911.4171%2C%22width%22%3A85.78735999999998%2C%22height%22%3A12.74630000000002%2C%22text%22%3A%220%3A14.81java%22%7D%2C%7B%22x%22%3A6.199082%2C%22y%22%3A911.99927%2C%22width%22%3A76.769638%2C%22height%22%3A15.076289999999972%2C%22text%22%3A%2222216deploy%22%7D%2C%7B%22x%22%3A117.19413%2C%22y%22%3A912.00305%2C%22width%22%3A14.358990000000006%2C%22height%22%3A11.682500000000005%2C%22text%22%3A%2220%22%7D%2C%7B%22x%22%3A163.82446%2C%22y%22%3A911.88336%2C%22width%22%3A192.90692%2C%22height%22%3A13.181139999999914%2C%22text%22%3A%2218.0g7.9g15ms1.350.0%22%7D%2C%7B%22x%22%3A4.3661027%2C%22y%22%3A928.47943%2C%22width%22%3A85.6098073%2C%22height%22%3A15.409170000000017%2C%22text%22%3A%2222236deploy%22%7D%2C%7B%22x%22%3A374.28397%2C%22y%22%3A928.755%2C%22width%22%3A86.32562999999999%2C%22height%22%3A13.298649999999952%2C%22text%22%3A%220%3A14.54java%22%7D%2C%7B%22x%22%3A161.38852%2C%22y%22%3A928.76953%2C%22width%22%3A195.35821%2C%22height%22%3A14.302919999999972%2C%22text%22%3A%2218.0g7.9g15ms1.350.0%22%7D%2C%7B%22x%22%3A117.25927%2C%22y%22%3A928.96136%2C%22width%22%3A14.722300000000004%2C%22height%22%3A12.70318999999995%2C%22text%22%3A%2220%22%7D%5D%2C%22style%22%3A%22none%22%2C%22search%22%3A%22PRNIVIRTRESSHRSXCPUSMEM%20TIME%2BCOMMAND%20PIDUSER%2018.0g7.9g15mS2.050.0%201%3A00.64jqva%2011329deploy%2020%2020%200%3A11.14jqva%2018.0g7.9g15mS2.050.0%2031413deploy%2018.0g7.9g15ms1.650.0%2020%2011501deploy%200%3A44.15java%2022017deploy%2020%2018.0g7.9g15ms1.650.0%200%3A16.16jqva%2022027%2020%20deploy%20018.0g7.9g15mS1.650.0%200%3A15.73java%2022042deploy%2020%200%3A15.88java%20018.0g7.9g15mS1.650.0%20018.0g7.9g15mR1.650.0%2022665%2020%200%3A14.38jqva%20deploy%2022739deploy%2020%2018.0g7.9g15mS1.650.0%20D%3A14.26java%2022762deploy%200%3A14.54iava%20018.0g7.9g15ms1.650.0%2020%20018.0g7.9g15ms1.650.0%2022831deploy%2020%200%3A13.62java%2020%2023157deploy%2018.0g7.9g15mS1.650.0%200%3A13.05java%2023162deploy%2018.0g7.9g15mS1.650.0%2020%200%3A13.38java%2018.0g7.9g15mS1.650.0%2023199deploy%200%3A12.83java%20018.0g7.9g15mS1.650.0%2023248deploy%200%3A13.21java%2020%2018.0g7.9g15mS1.650.0%2020%2030796deploy%200%3A11.22java%2030821deploy%2020%20018.0g7.9g15ms1.650.0%200%3A11.00java%2031354deploy%20018.0g7.9g15mS1.650.0%2020%200%3A10.68java%2020%200%3A10.95jqva%2031378deploy%20018.0g7.9g15mS1.650.0%20deploy%200%3A10.67java%2020%2031382%2018.0g7.9g15mS1.650.0%200%3A10.73java%2031402deploy%2020%2018.0g7.9g15mS1.650.0%2020%20018.0g7.9g15mS1.650.0%2031691deploy%200%3A10.89jqva%2020%20568deploy%20018.0g7.9g15mS1.650.0%200%3A10.10java%20594deploy%20018.0g7.9g15ms1.650.0%200%3A09.98jqva%2020%20018.0g7.9g15mS1.650.0%20783deploy%200%3A10.07java%2020%20018.0g7.9g15mS1.650.0%200%3A10.27jqva%20820deploy%2020%20885deploy%2018.0g7.9g15mS1.650.0%200%3A10.02java%2020%2011204deploy%200%3A39.82java%2018.0g7.9g15mS1.350.0%2020%2011205deploy%2020%200%3A39.99jqva%20018.0g7.9g15mS1.350.0%2020%2011206deploy%20018.0g7.9g15mS1.350.0%200%3A40.26java%2011207deploy%200%3A39.78java%2020%20018.0g7.9g15mS1.350.0%2011208deploy%20018.0g7.9g15mS1.350.0%2020%200%3A39.81jqva%20018.0g7.9g15ms1.350.0%2011209deploy%2020%200%3A39.35java%20deploy%2018.0g7.9g15ms1.350.0%20Q%3A39.98java%2011210%2011211deploy%2018.0g7.9g15mS1.350.0%2020%200%3A40.19jqva%2018.0g7.9g15mS1.350.0%2011848deploy%2020%20D%3A20.76java%2011955deploy%2020%20018.0g7.9g15ms1.350.0%200%3A20.22jqva%2012645deploy%2020%20018.0g7.9g15mS1.350.0%200%3A19.65java%2012811deploy%2020%20018.0g7.9g15ms1.350.0%200%3A20.2zjava%2013081deploy%20018.0g7.9g15ms1.350.0%2020%200%3A19.62jqva%2013091deploy%2018.0g7.9g15mS1.350.0%2020%200%3A20.45java%2013117deploy%20018.0g7.9g15mS1.350.0%2020%200%3A21.44java%20018.0g7.9g15ms1.350.0%2013697deploy%2020%200%3A20.51java%2013732deploy%2020%200%3A20.50jqva%20018.0g7.9g15mS1.350.0%2013813deploy%2020%2018.0g7.9g15mS1.350.0%200%3A21.00java%2018348deploy%200%3A19.99jqva%2018.0g7.9g15ms1.350.0%2018358deploy%20018.0g7.9g15mS1.350.0%2020%200%3A19.90jqva%2021981deploy%2020%2018.0g7.9g15mS1.350.0%20D%3A16.48java%2022162deploy%2020%20018.0g7.9g15mS1.350.0%200%3A15.75java%2022179deploy%20018.0g7.9g15ms1.350.0%2020%20Q%3A15.39jqva%20018.0g7.9g15ms1.350.0%2022203deploy%2020%20Q%3A16.02java%2022215deploy%200%3A15.36jqva%2018.0g7.9g15mS1.350.0%2020%200%3A14.81java%2022216deploy%2020%2018.0g7.9g15ms1.350.0%2022236deploy%200%3A14.54java%2018.0g7.9g15ms1.350.0%2020%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22width%22%3A633%2C%22height%22%3A946%7D"><a href="https://huster.top/wp-content/uploads/2021/02/1.png"><img class="alignnone size-full wp-image-751" src="https://huster.top/wp-content/uploads/2021/02/1.png" alt="" width="633" height="946" /></a></span></p>
<p data-lake-id="0a4c80a6b27757a7088b477998eb14ca">所有的线程打印出来如上图所示，可以看到每个线程占用的cpu几乎是差不多的，没有特别高的出现。这可就难了，这个就说明了是业务逻辑写的有问题，而不是代码有什么问题。也就是这些线程确实是都在认认真真的工作，并没有出现某个线程抢占了cpu的情况。</p>
<h3 id="C8uan" data-lake-id="ed6fbe9710f316c437a1db27b01c5c2d">使用阿尔沙斯排查</h3>
<p data-lake-id="f1a814420ee52c210c72f2a1ea261774">Java界有一个非常好用的问题排查工具，也是我经常使用的工具arthas，用来排查gc问题和cpu问题以及各种java问题非常的得心应手。他的原理使用javaagent注入到原java线程里，拿到一些有用的监控信息。具体如何使用，可以参考官方文档。</p>
<p data-lake-id="721686d03d309f911d469cad6a816e69">排查cpu问题可以使用, thread -n 3 ，就是查看最耗cpu的前3的线程，顺带会给你把代码调用栈给你打出来，如下图所示:</p>
<p data-lake-id="786f340784f7c7bdbce0e028f52ef2b3"><span class="lake-card-margin-top lake-card-margin-bottom lake-selected" data-card-type="inline" data-lake-card="image" data-card-value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F180554%2F1613720739370-c522cca3-ca7a-4092-be4d-8b8fcc8d9011.png%22%2C%22originWidth%22%3A1571%2C%22originHeight%22%3A792%2C%22name%22%3A%22image.png%22%2C%22size%22%3A748531%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A1.7737167%2C%22y%22%3A23.33362%2C%22width%22%3A206.79920330000002%2C%22height%22%3A13.140234000000003%2C%22text%22%3A%22%5Barthasq15446%5Dthrcad-n1%22%7D%2C%7B%22x%22%3A1001.187%2C%22y%22%3A40.042694%2C%22width%22%3A168.38199999999995%2C%22height%22%3A13.183476000000006%2C%22text%22%3A%22iuingFiLeWangqerQ38f3994d%22%7D%2C%7B%22x%22%3A24.372875%2C%22y%22%3A39.812798%2C%22width%22%3A607.305285%2C%22height%22%3A15.386057999999998%2C%22text%22%3A%22ealtty-thrd-81%22%7D%2C%7B%22x%22%3A616.26697%2C%22y%22%3A41.35841%2C%22width%22%3A166.71102999999994%2C%22height%22%3A13.697215999999997%2C%22text%22%3A%22EDonorg.apache.1oqqing.1%22%7D%2C%7B%22x%22%3A1229.8706%2C%22y%22%3A39.36936%2C%22width%22%3A286.25760000000014%2C%22height%22%3A16.711145000000002%2C%22text%22%3A%22byinyeality-thrend-363Id1429%22%7D%2C%7B%22x%22%3A30.500849%2C%22y%22%3A57.934395%2C%22width%22%3A705.905851%2C%22height%22%3A13.172690999999993%2C%22text%22%3A%22Ct0g%3Acpeaiommoo%22%7D%2C%7B%22x%22%3A40.509617%2C%22y%22%3A72.554596%2C%22width%22%3A614.5850529999999%2C%22height%22%3A16.814374%2C%22text%22%3A%22biockedonorg.pache.%22%7D%2C%7B%22x%22%3A28.181498%2C%22y%22%3A92.03654%2C%22width%22%3A708.146902%2C%22height%22%3A14.499290000000002%2C%22text%22%3A%22ttprg.cpadhuoado.o%22%7D%2C%7B%22x%22%3A27.481968%2C%22y%22%3A108.6758%2C%22width%22%3A673.284272%2C%22height%22%3A16.598675%2C%22text%22%3A%22ttg.cpadho%22%7D%2C%7B%22x%22%3A27.740635%2C%22y%22%3A125.08491%2C%22width%22%3A680.773365%2C%22height%22%3A14.96387%2C%22text%22%3A%22tog.cpateoc.oo%22%7D%2C%7B%22x%22%3A27.151804%2C%22y%22%3A141.75545%2C%22width%22%3A682.117196%2C%22height%22%3A15.497010000000017%2C%22text%22%3A%22tong.cpate.omo.%22%7D%2C%7B%22x%22%3A28.2391%2C%22y%22%3A158.73587%2C%22width%22%3A594.11063%2C%22height%22%3A15.546390000000002%2C%22text%22%3A%22atog.pacheo%22%7D%2C%7B%22x%22%3A28.094591%2C%22y%22%3A174.52977%2C%22width%22%3A599.967409%2C%22height%22%3A16.83408%2C%22text%22%3A%22tog.cpachon%22%7D%2C%7B%22x%22%3A28.79729%2C%22y%22%3A193.97089%2C%22width%22%3A891.75435%2C%22height%22%3A13.788170000000008%2C%22text%22%3A%22%E8%B5%A0%E5%BF%83%40%E5%BF%83%E5%BF%83%E4%B8%AD%E4%B8%AD%E5%BF%83m.%22%7D%2C%7B%22x%22%3A28.41169%2C%22y%22%3A210.72505%2C%22width%22%3A840.63854%2C%22height%22%3A14.12115%2C%22text%22%3A%22%40%E4%B8%AD%E5%9C%B0%22%7D%2C%7B%22x%22%3A27.912445%2C%22y%22%3A227.91231%2C%22width%22%3A815.3716149999999%2C%22height%22%3A14.899470000000008%2C%22text%22%3A%22%E5%8F%B6%E5%8F%AB%E4%B8%AD%E5%BF%83%E5%BF%83%E5%BF%83%E5%BF%83%E5%BF%83%22%7D%2C%7B%22x%22%3A27.98842%2C%22y%22%3A244.95108%2C%22width%22%3A691.5117799999999%2C%22height%22%3A15.029390000000035%2C%22text%22%3A%22ttogcpadhomo.oo%22%7D%2C%7B%22x%22%3A28.13272%2C%22y%22%3A260.9166%2C%22width%22%3A679.6150200000001%2C%22height%22%3A14.739280000000008%2C%22text%22%3A%22topg.cpateoo%22%7D%2C%7B%22x%22%3A29.020006%2C%22y%22%3A277.82336%2C%22width%22%3A675.437394%2C%22height%22%3A14.739640000000009%2C%22text%22%3A%22ttog.cpatheogio.cot%22%7D%2C%7B%22x%22%3A28.96236%2C%22y%22%3A295.3268%2C%22width%22%3A773.31608%2C%22height%22%3A15.273540000000025%2C%22text%22%3A%22%E5%8F%B6g%E4%B8%AD%E5%BF%83cjo%22%7D%2C%7B%22x%22%3A28.773249%2C%22y%22%3A312.02817%2C%22width%22%3A692.506351%2C%22height%22%3A14.491570000000024%2C%22text%22%3A%22tog.padh.omo.ct%22%7D%2C%7B%22x%22%3A28.106768%2C%22y%22%3A329.69305%2C%22width%22%3A627.723982%2C%22height%22%3A15.183949999999982%2C%22text%22%3A%22torg.cpadhoooc%22%7D%2C%7B%22x%22%3A28.253439%2C%22y%22%3A346.2639%2C%22width%22%3A640.2143910000001%2C%22height%22%3A14.991780000000006%2C%22text%22%3A%22torg.padh.om.c%22%7D%2C%7B%22x%22%3A27.929394%2C%22y%22%3A363.57587%2C%22width%22%3A574.935656%2C%22height%22%3A15.31295%2C%22text%22%3A%22torg.cpachemoco%22%7D%2C%7B%22x%22%3A28.227633%2C%22y%22%3A380.19397%2C%22width%22%3A602.810567%2C%22height%22%3A14.854710000000011%2C%22text%22%3A%22tog.pache%22%7D%2C%7B%22x%22%3A29.20485%2C%22y%22%3A395.5238%2C%22width%22%3A856.44525%2C%22height%22%3A16.369050000000016%2C%22text%22%3A%22t%E7%9A%84gcah.etw.omjcom%22%7D%2C%7B%22x%22%3A27.575457%2C%22y%22%3A414.4768%2C%22width%22%3A519.221603%2C%22height%22%3A13.993779999999958%2C%22text%22%3A%22dtog.apache.o%22%7D%2C%7B%22x%22%3A27.725353%2C%22y%22%3A429.98303%2C%22width%22%3A601.870447%2C%22height%22%3A15.584510000000023%2C%22text%22%3A%22ctorg.cpacheogtm%22%7D%2C%7B%22x%22%3A28.055338%2C%22y%22%3A448.863%2C%22width%22%3A681.260162%2C%22height%22%3A13.956849999999974%2C%22text%22%3A%22dtorgcpateogm%22%7D%2C%7B%22x%22%3A27.736814%2C%22y%22%3A465.6497%2C%22width%22%3A633.182136%2C%22height%22%3A13.52915999999999%2C%22text%22%3A%22tog.pach.oamo%22%7D%2C%7B%22x%22%3A27.534292%2C%22y%22%3A483.2396%2C%22width%22%3A585.758558%2C%22height%22%3A14.550900000000013%2C%22text%22%3A%22torg.cpacieogo%22%7D%2C%7B%22x%22%3A27.206633%2C%22y%22%3A498.35547%2C%22width%22%3A597.846967%2C%22height%22%3A15.609229999999968%2C%22text%22%3A%22torg.pcheoo%22%7D%2C%7B%22x%22%3A53.99292%2C%22y%22%3A515.3215%2C%22width%22%3A477.69872999999995%2C%22height%22%3A15.648199999999974%2C%22text%22%3A%22-**zi*gtng.otoggo%22%7D%2C%7B%22x%22%3A27.552393%2C%22y%22%3A516.9939%2C%22width%22%3A36.111429%2C%22height%22%3A13.463799999999992%2C%22text%22%3A%22ot-m%22%7D%2C%7B%22x%22%3A147.32721%2C%22y%22%3A534.03436%2C%22width%22%3A53.28667999999999%2C%22height%22%3A12.17034000000001%2C%22text%22%3A%22nin1nt%22%7D%2C%7B%22x%22%3A190.80896%2C%22y%22%3A532.6377%2C%22width%22%3A177.88284%2C%22height%22%3A17.915899999999965%2C%22text%22%3A%22%E4%B8%ADr.chonnt.mtii%22%7D%2C%7B%22x%22%3A294.99686%2C%22y%22%3A532.65173%2C%22width%22%3A451.38754%2C%22height%22%3A19.61406999999997%2C%22text%22%3A%22m.jtts.au%22%7D%2C%7B%22x%22%3A296.39508%2C%22y%22%3A548.8624%2C%22width%22%3A495.47748%2C%22height%22%3A17.58000000000004%2C%22text%22%3A%22ronk.podel.oltycenes%2F%22%7D%2C%7B%22x%22%3A28.385868%2C%22y%22%3A550.4917%2C%22width%22%3A42.117211999999995%2C%22height%22%3A14.454830000000015%2C%22text%22%3A%22atcor%22%7D%2C%7B%22x%22%3A29.639782%2C%22y%22%3A568.2593%2C%22width%22%3A43.00004800000001%2C%22height%22%3A12.987949999999955%2C%22text%22%3A%22atcom%22%7D%2C%7B%22x%22%3A235.24237%2C%22y%22%3A564.4331%2C%22width%22%3A603.43103%2C%22height%22%3A23.663760000000025%2C%22text%22%3A%22.gmcamo..kabbaa.uitts.t%22%7D%2C%7B%22x%22%3A26.840925%2C%22y%22%3A584.30316%2C%22width%22%3A152.982315%2C%22height%22%3A13.71569999999997%2C%22text%22%3A%22atComLIbte9%22%7D%2C%7B%22x%22%3A270.36716%2C%22y%22%3A581.9156%2C%22width%22%3A542.59018%2C%22height%22%3A20.485950000000003%2C%22text%22%3A%22utitnbbaetutilssjba16%2F146un%22%7D%2C%7B%22x%22%3A26.832506%2C%22y%22%3A599.9096%2C%22width%22%3A461.02052399999997%2C%22height%22%3A16.201200000000085%2C%22text%22%3A%22tjava.utiit.%22%7D%2C%7B%22x%22%3A27.11378%2C%22y%22%3A617.82684%2C%22width%22%3A745.59356%2C%22height%22%3A16.573560000000043%2C%22text%22%3A%22ttAoitkpatm%22%7D%2C%7B%22x%22%3A28.738476%2C%22y%22%3A634.78485%2C%22width%22%3A680.851364%2C%22height%22%3A15.922789999999964%2C%22text%22%3A%22teomhettokepo%22%7D%2C%7B%22x%22%3A27.986607%2C%22y%22%3A651.9384%2C%22width%22%3A729.5883429999999%2C%22height%22%3A14.801600000000008%2C%22text%22%3A%22tbatbtk%22%7D%2C%7B%22x%22%3A27.585402%2C%22y%22%3A669.00665%2C%22width%22%3A607.3681479999999%2C%22height%22%3A15.311849999999936%2C%22text%22%3A%22tjoveti.c%22%7D%2C%7B%22x%22%3A36.328053%2C%22y%22%3A684.85364%2C%22width%22%3A302.019697%2C%22height%22%3A19.070859999999925%2C%22text%22%3A%22ot.u1b1.se.mamo...current..%22%7D%2C%7B%22x%22%3A259.5373%2C%22y%22%3A685.96356%2C%22width%22%3A498.27489999999995%2C%22height%22%3A14.687689999999975%2C%22text%22%3A%22curTent.baexcteodxectosemce%22%7D%2C%7B%22x%22%3A278.12085%2C%22y%22%3A702.9534%2C%22width%22%3A460.59034999999994%2C%22height%22%3A15.764599999999973%2C%22text%22%3A%22tertessLcbdas940%2F1499665219.nnkou%22%7D%2C%7B%22x%22%3A28.32336%2C%22y%22%3A701.8023%2C%22width%22%3A149.44526%2C%22height%22%3A17.455700000000093%2C%22text%22%3A%22OTW%2BLLOLKENOSE%22%7D%2C%7B%22x%22%3A25.627317%2C%22y%22%3A712.7072%2C%22width%22%3A454.248353%2C%22height%22%3A23.03320000000008%2C%22text%22%3A%22atcocptontext.contexts1.un(context.jv638%22%7D%2C%7B%22x%22%3A27.93687%2C%22y%22%3A737.1864%2C%22width%22%3A576.43648%2C%22height%22%3A16.312599999999975%2C%22text%22%3A%22tjova.uttc%22%7D%2C%7B%22x%22%3A36.559135%2C%22y%22%3A754.29407%2C%22width%22%3A567.659305%2C%22height%22%3A14.461000000000013%2C%22text%22%3A%22ptjava.utto.%22%7D%2C%7B%22x%22%3A24.985676%2C%22y%22%3A771.12274%2C%22width%22%3A305.772384%2C%22height%22%3A15.657460000000015%2C%22text%22%3A%22dtjava.long.Thread.rungihreod.Jjava%3A745)%22%7D%5D%2C%22style%22%3A%22none%22%2C%22search%22%3A%22%5Barthasq15446%5Dthrcad-n1%20iuingFiLeWangqerQ38f3994d%20ealtty-thrd-81%20EDonorg.apache.1oqqing.1%20byinyeality-thrend-363Id1429%20Ct0g%3Acpeaiommoo%20biockedonorg.pache.%20ttprg.cpadhuoado.o%20ttg.cpadho%20tog.cpateoc.oo%20tong.cpate.omo.%20atog.pacheo%20tog.cpachon%20%E8%B5%A0%E5%BF%83%40%E5%BF%83%E5%BF%83%E4%B8%AD%E4%B8%AD%E5%BF%83m.%20%40%E4%B8%AD%E5%9C%B0%20%E5%8F%B6%E5%8F%AB%E4%B8%AD%E5%BF%83%E5%BF%83%E5%BF%83%E5%BF%83%E5%BF%83%20ttogcpadhomo.oo%20topg.cpateoo%20ttog.cpatheogio.cot%20%E5%8F%B6g%E4%B8%AD%E5%BF%83cjo%20tog.padh.omo.ct%20torg.cpadhoooc%20torg.padh.om.c%20torg.cpachemoco%20tog.pache%20t%E7%9A%84gcah.etw.omjcom%20dtog.apache.o%20ctorg.cpacheogtm%20dtorgcpateogm%20tog.pach.oamo%20torg.cpacieogo%20torg.pcheoo%20-**zi*gtng.otoggo%20ot-m%20nin1nt%20%E4%B8%ADr.chonnt.mtii%20m.jtts.au%20ronk.podel.oltycenes%2F%20atcor%20atcom%20.gmcamo..kabbaa.uitts.t%20atComLIbte9%20utitnbbaetutilssjba16%2F146un%20tjava.utiit.%20ttAoitkpatm%20teomhettokepo%20tbatbtk%20tjoveti.c%20ot.u1b1.se.mamo...current..%20curTent.baexcteodxectosemce%20tertessLcbdas940%2F1499665219.nnkou%20OTW%2BLLOLKENOSE%20atcocptontext.contexts1.un(context.jv638%20tjova.uttc%20ptjava.utto.%20dtjava.long.Thread.rungihreod.Jjava%3A745)%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22width%22%3A1571%2C%22height%22%3A792%7D"><a href="https://huster.top/wp-content/uploads/2021/02/2.png"><img class="alignnone size-full wp-image-753" src="https://huster.top/wp-content/uploads/2021/02/2.png" alt="" width="746" height="376" /></a></span></p>
<p data-lake-id="449624e1656fbae38eebb2136c776f56">其实这个时候基本可以定位到是什么问题了，因为问题代码都给你打出来了。这个时候我严重的怀疑是计算规模扩大了，可以从上面的打印栈中看到代码都是正常的代码，那是不是这个ArrayList特别大，而每个循环都是cpu密集型，导致了cpu占用了。是不是代码有问题，导致了这个ArrayList变大了？最后发现确实是的，可惜的是当时被忽略了，看来有时候还是要相信直觉</p>
<p data-lake-id="8a590c4e4e184f9759183b65bfa167d5"><span class="lake-card-margin-top lake-card-margin-bottom lake-selected" data-card-type="inline" data-lake-card="image" data-card-value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F180554%2F1613721023094-86a2bc70-82d8-47d3-914d-5d2c75364073.png%22%2C%22originWidth%22%3A1492%2C%22originHeight%22%3A480%2C%22name%22%3A%22image.png%22%2C%22size%22%3A205248%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A1128.2607%2C%22y%22%3A4.8710256%2C%22width%22%3A42.79449999999997%2C%22height%22%3A14.6074764%2C%22text%22%3A%221%E6%9D%A1%E5%9B%9E%E5%A4%8D%22%7D%2C%7B%22x%22%3A1422.4076%2C%22y%22%3A5.375099%2C%22width%22%3A45.79520000000002%2C%22height%22%3A15.734057%2C%22text%22%3A%221%E8%AE%A4%E4%BA%BA%E6%9C%AA%E8%AF%BB%22%7D%2C%7B%22x%22%3A911.5964%2C%22y%22%3A68.29685%2C%22width%22%3A541.09%2C%22height%22%3A17.628709999999998%2C%22text%22%3A%22atjavautlrayLsttortachyLisva%3A14)%E4%B8%AAS%E9%95%BF%E5%BA%A6%E5%8F%AF%E4%BB%A5%E7%90%86%E7%82%B9%E7%9C%8B%E4%B8%8B%2C%E6%98%AF%E4%B8%8D%E6%98%AF%E5%BE%88%E5%A4%A7%22%7D%2C%7B%22x%22%3A446.0247%2C%22y%22%3A52.035378%2C%22width%22%3A76.55829999999997%2C%22height%22%3A30.082952%2C%22text%22%3A%22%E4%B8%AD%E6%9C%B1%E7%BA%BF3123%22%7D%2C%7B%22x%22%3A923.66974%2C%22y%22%3A101.82365%2C%22width%22%3A38.52055999999993%2C%22height%22%3A12.642659999999992%2C%22text%22%3A%221%E6%9D%A1%E5%9B%9E%E5%A4%8D%22%7D%2C%7B%22x%22%3A1420.962%2C%22y%22%3A101.80061%2C%22width%22%3A46.86640000000011%2C%22height%22%3A14.57128999999999%2C%22text%22%3A%221%E4%BA%BA%E6%9C%AA%E8%AF%BB%22%7D%2C%7B%22x%22%3A71.5738%2C%22y%22%3A164.9514%2C%22width%22%3A101.08073999999999%2C%22height%22%3A18.489810000000006%2C%22text%22%3A%22%E8%BF%99%E4%B8%AA%E5%BA%94%E8%AF%A5%E6%98%AF%E6%8E%92%E5%BA%8F%22%7D%2C%7B%22x%22%3A320.19232%2C%22y%22%3A170.21194%2C%22width%22%3A79.62%2C%22height%22%3A35.96594999999999%2C%22text%22%3A%22%E4%BB%BB%E5%A4%A9%E6%B0%913123%22%7D%2C%7B%22x%22%3A621.21387%2C%22y%22%3A170.23601%2C%22width%22%3A77.88572999999997%2C%22height%22%3A36.250670000000014%2C%22text%22%3A%22%E4%BB%BB%E5%A4%A9%E6%B0%913123%22%7D%2C%7B%22x%22%3A920.54315%2C%22y%22%3A171.84854%2C%22width%22%3A78.67185000000006%2C%22height%22%3A34.65635999999998%2C%22text%22%3A%22%E6%80%A7%E5%A4%A9%E5%B9%B43123%22%7D%2C%7B%22x%22%3A1221.336%2C%22y%22%3A173.83192%2C%22width%22%3A77.28909999999996%2C%22height%22%3A31.621530000000007%2C%22text%22%3A%22%E6%80%A7%E5%A4%AB%E6%B0%913128%22%7D%2C%7B%22x%22%3A167.1765%2C%22y%22%3A214.65234%2C%22width%22%3A70.38197%2C%22height%22%3A14.851259999999996%2C%22text%22%3A%22%E6%9C%8825%E6%97%A516%3A58%22%7D%2C%7B%22x%22%3A1344.8744%2C%22y%22%3A220.07031%2C%22width%22%3A78.7460000000001%2C%22height%22%3A35.542100000000005%2C%22text%22%3A%22%E4%BB%BB%E5%A4%A9%E5%B9%B43123%22%7D%2C%7B%22x%22%3A746.418%2C%22y%22%3A221.72389%2C%22width%22%3A75.66763000000003%2C%22height%22%3A32.083999999999975%2C%22text%22%3A%22%E6%97%A5%E5%A4%A9%E5%B9%B49123%22%7D%2C%7B%22x%22%3A82.09219%2C%22y%22%3A247.52167%2C%22width%22%3A44.316874999999996%2C%22height%22%3A14.357229999999987%2C%22text%22%3A%22%E4%BB%BB%E5%A4%A9%E5%85%B5%3A%22%7D%2C%7B%22x%22%3A79.82386%2C%22y%22%3A265.96582%2C%22width%22%3A289.52999%2C%22height%22%3A14.910480000000007%2C%22text%22%3A%22atjava.utilArrayList.toreach(ArrayListjava%3A1249)%E8%BF%99%E4%B8%AA%22%7D%2C%7B%22x%22%3A620.65485%2C%22y%22%3A264.23706%2C%22width%22%3A34.715850000000046%2C%22height%22%3A23.62912%2C%22text%22%3A%22%E9%95%87%E4%BB%98%22%7D%2C%7B%22x%22%3A921.26526%2C%22y%22%3A264.51297%2C%22width%22%3A34.23828000000003%2C%22height%22%3A23.78667999999999%2C%22text%22%3A%22%E6%89%93%E7%BF%94%22%7D%2C%7B%22x%22%3A79.813286%2C%22y%22%3A285.11978%2C%22width%22%3A188.60254400000002%2C%22height%22%3A13.91912000000002%2C%22text%22%3A%22list%E9%95%BF%E5%BA%A6%E5%8F%AF%E4%BB%A5%E7%90%86%E7%82%B9%E7%9C%8B%E4%B8%8B%2C%E6%98%AF%E4%B8%8D%E6%98%AF%E5%BE%88%E5%A4%A7%22%7D%2C%7B%22x%22%3A79.26033%2C%22y%22%3A327.4571%2C%22width%22%3A227.26484999999997%2C%22height%22%3A17.67027999999999%2C%22text%22%3A%22%40%E4%BB%BB%E5%A4%A9%E5%85%B5%E6%88%91%E8%BF%99%E4%B8%AA%E8%AF%B7%E6%B1%82%E6%98%AF%E7%9F%A5%E9%81%93%E7%9A%84%2C150%22%7D%2C%7B%22x%22%3A1220.5187%2C%22y%22%3A341.20456%2C%22width%22%3A80.06719999999996%2C%22height%22%3A35.34765999999996%2C%22text%22%3A%22%E4%BB%BB%E5%A4%A9%E6%B0%913123%22%7D%2C%7B%22x%22%3A619.6624%2C%22y%22%3A341.52808%2C%22width%22%3A80.29895999999997%2C%22height%22%3A34.78698000000003%2C%22text%22%3A%22%E4%BB%BB%E5%A4%A9%E6%B0%913123%22%7D%2C%7B%22x%22%3A920.3475%2C%22y%22%3A341.68695%2C%22width%22%3A79.79135000000008%2C%22height%22%3A35.42244999999997%2C%22text%22%3A%22%E4%BB%BB%E5%A4%A9%E5%AE%BE3123%22%7D%2C%7B%22x%22%3A143.40579%2C%22y%22%3A367.18173%2C%22width%22%3A31.961460000000017%2C%22height%22%3A15.627869999999973%2C%22text%22%3A%22%E6%94%B6%E5%88%B0%22%7D%2C%7B%22x%22%3A313.17538%2C%22y%22%3A367.72897%2C%22width%22%3A28.88621999999998%2C%22height%22%3A14.595979999999997%2C%22text%22%3A%22%E5%9B%9E%E5%A4%8D%22%7D%2C%7B%22x%22%3A1044.3167%2C%22y%22%3A390.64252%2C%22width%22%3A77.72629999999981%2C%22height%22%3A33.14548000000002%2C%22text%22%3A%22%E5%A4%A9%E5%A4%A9%E5%B9%B43123%22%7D%2C%7B%22x%22%3A743.6393%2C%22y%22%3A391.12827%2C%22width%22%3A78.94119999999998%2C%22height%22%3A33.29266000000001%2C%22text%22%3A%22%E4%BB%BB%E5%A4%A9%E5%8E%BF3123%22%7D%2C%7B%22x%22%3A71.10312%2C%22y%22%3A449.16324%2C%22width%22%3A30.141549999999995%2C%22height%22%3A17.086760000000027%2C%22text%22%3A%22%E9%95%BF%E5%BA%A6%22%7D%5D%2C%22style%22%3A%22none%22%2C%22search%22%3A%221%E6%9D%A1%E5%9B%9E%E5%A4%8D%201%E8%AE%A4%E4%BA%BA%E6%9C%AA%E8%AF%BB%20atjavautlrayLsttortachyLisva%3A14)%E4%B8%AAS%E9%95%BF%E5%BA%A6%E5%8F%AF%E4%BB%A5%E7%90%86%E7%82%B9%E7%9C%8B%E4%B8%8B%2C%E6%98%AF%E4%B8%8D%E6%98%AF%E5%BE%88%E5%A4%A7%20%E4%B8%AD%E6%9C%B1%E7%BA%BF3123%201%E6%9D%A1%E5%9B%9E%E5%A4%8D%201%E4%BA%BA%E6%9C%AA%E8%AF%BB%20%E8%BF%99%E4%B8%AA%E5%BA%94%E8%AF%A5%E6%98%AF%E6%8E%92%E5%BA%8F%20%E4%BB%BB%E5%A4%A9%E6%B0%913123%20%E4%BB%BB%E5%A4%A9%E6%B0%913123%20%E6%80%A7%E5%A4%A9%E5%B9%B43123%20%E6%80%A7%E5%A4%AB%E6%B0%913128%20%E6%9C%8825%E6%97%A516%3A58%20%E4%BB%BB%E5%A4%A9%E5%B9%B43123%20%E6%97%A5%E5%A4%A9%E5%B9%B49123%20%E4%BB%BB%E5%A4%A9%E5%85%B5%3A%20atjava.utilArrayList.toreach(ArrayListjava%3A1249)%E8%BF%99%E4%B8%AA%20%E9%95%87%E4%BB%98%20%E6%89%93%E7%BF%94%20list%E9%95%BF%E5%BA%A6%E5%8F%AF%E4%BB%A5%E7%90%86%E7%82%B9%E7%9C%8B%E4%B8%8B%2C%E6%98%AF%E4%B8%8D%E6%98%AF%E5%BE%88%E5%A4%A7%20%40%E4%BB%BB%E5%A4%A9%E5%85%B5%E6%88%91%E8%BF%99%E4%B8%AA%E8%AF%B7%E6%B1%82%E6%98%AF%E7%9F%A5%E9%81%93%E7%9A%84%2C150%20%E4%BB%BB%E5%A4%A9%E6%B0%913123%20%E4%BB%BB%E5%A4%A9%E6%B0%913123%20%E4%BB%BB%E5%A4%A9%E5%AE%BE3123%20%E6%94%B6%E5%88%B0%20%E5%9B%9E%E5%A4%8D%20%E5%A4%A9%E5%A4%A9%E5%B9%B43123%20%E4%BB%BB%E5%A4%A9%E5%8E%BF3123%20%E9%95%BF%E5%BA%A6%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22width%22%3A1492%2C%22height%22%3A480%7D"><a href="https://huster.top/wp-content/uploads/2021/02/3.png"><img class="alignnone size-full wp-image-754" src="https://huster.top/wp-content/uploads/2021/02/3.png" alt="" width="746" height="240" /></a></span></p>
<p data-lake-id="10123629110658eb35ec16138300fa34">实际上Arthas只是简化了使用Jstack的使用方法，本质还是要拿到线程名称，以及代码栈</p>
<h2 id="EhHPm" data-lake-id="23b1311bc9abd25763bd484d6be51563">猜测和验证</h2>
<h3 id="lire3" data-lake-id="3855a9fbc36acf8e264a1c76411143fa">gc问题导致?</h3>
<p data-lake-id="49673eb26db18d0d2d09eb92ad46c536">最开始开发怀疑是gc问题，因为他观察到相对于正常代码，新代码的gc更加频繁，而且gc的时间更长。但是我觉得这个应该只是结果而不是原因。首先如果是gc问题，那么通过jstack的排查手段，应该能定位到所有的cpu都耗费在了gc的线程上(gc的线程名称是固定的)，我们通过jstack的信息看到的并不是这样的。另外一个方面，你的cpu都被你业务用掉了，这个时候gc线程优先级很低，当然争取不到cpu资源了，gc的时间变成了，也就顺理成章了。</p>
<p data-lake-id="b22173e54652931613d228a8759fde77">后来经过调整内存大小，减少了gc次数，但是cpu的表现跟没调整一模一样，没有任何变化，可见就排除了gc的嫌疑了。</p>
<h3 id="QSh8a" data-lake-id="f6500dd8619dbc5c6cf528b0835a93f3">线程切换导致？</h3>
<p data-lake-id="507daa173ee9453e63289870bd6bf5de">通过fastthread.io上次你的jstack打印出来的日志，发现线程数很多，达到了3000多个，然后通过 vmstat命令看到线程切换特别频繁，所以怀疑是因为线程数太多，cpu都耗费在了线程切换上了</p>
<p data-lake-id="c5bf1054fb6549fd7d2d19fb8aaa03bb"><span class="lake-card-margin-top lake-card-margin-bottom lake-selected" data-card-type="inline" data-lake-card="image" data-card-value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F180554%2F1613721493861-3d4d848b-c40f-4a2e-ae3e-93d3e4b18d01.png%22%2C%22originWidth%22%3A631%2C%22originHeight%22%3A980%2C%22name%22%3A%22image.png%22%2C%22size%22%3A436229%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A-0.064434886%2C%22y%22%3A10.987642%2C%22width%22%3A183.468654886%2C%22height%22%3A13.04209%2C%22text%22%3A%2216%3A99%3A42deployeVEcSo18052%22%7D%2C%7B%22x%22%3A12.344073%2C%22y%22%3A28.495642%2C%22width%22%3A85.46132700000001%2C%22height%22%3A13.057047999999998%2C%22text%22%3A%22vmstat1100%22%7D%2C%7B%22x%22%3A118.80148%2C%22y%22%3A47.41914%2C%22width%22%3A42.310280000000006%2C%22height%22%3A10.670270000000002%2C%22text%22%3A%22memory%22%7D%2C%7B%22x%22%3A409.9122%2C%22y%22%3A47.139084%2C%22width%22%3A47.81360000000001%2C%22height%22%3A9.845749000000005%2C%22text%22%3A%22system--%22%7D%2C%7B%22x%22%3A0.74739444%2C%22y%22%3A47.756794%2C%22width%22%3A34.21138056%2C%22height%22%3A9.523304000000003%2C%22text%22%3A%22procs%22%7D%2C%7B%22x%22%3A152.72748%2C%22y%22%3A61.571712%2C%22width%22%3A33.17496%2C%22height%22%3A12.627338000000002%2C%22text%22%3A%22buff%22%7D%2C%7B%22x%22%3A105.45666%2C%22y%22%3A62.701675%2C%22width%22%3A29.715180000000004%2C%22height%22%3A11.733685000000001%2C%22text%22%3A%22free%22%7D%2C%7B%22x%22%3A370.56256%2C%22y%22%3A62.78125%2C%22width%22%3A17.28341999999998%2C%22height%22%3A12.25%2C%22text%22%3A%22bo%22%7D%2C%7B%22x%22%3A440.205%2C%22y%22%3A62.975216%2C%22width%22%3A123.10210000000001%2C%22height%22%3A12.205829999999992%2C%22text%22%3A%22csussyidwast%22%7D%2C%7B%22x%22%3A194.04057%2C%22y%22%3A62.979897%2C%22width%22%3A39.66198%2C%22height%22%3A11.346543000000004%2C%22text%22%3A%22cache%22%7D%2C%7B%22x%22%3A286.4548%2C%22y%22%3A63.818943%2C%22width%22%3A19.28815000000003%2C%22height%22%3A11.448427000000002%2C%22text%22%3A%22SO%22%7D%2C%7B%22x%22%3A56.23152%2C%22y%22%3A63.971313%2C%22width%22%3A29.505349999999993%2C%22height%22%3A10.641376999999999%2C%22text%22%3A%22swpd%22%7D%2C%7B%22x%22%3A299.28128%2C%22y%22%3A77.65982%2C%22width%22%3A11.329720000000009%2C%22height%22%3A11.329720000000009%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A446.17007%2C%22y%22%3A77.99874%2C%22width%22%3A123.89043000000004%2C%22height%22%3A13.34536%2C%22text%22%3A%220619200%22%7D%2C%7B%22x%22%3A88.000465%2C%22y%22%3A78.42218%2C%22width%22%3A153.74712499999998%2C%22height%22%3A14.499570000000006%2C%22text%22%3A%222725801665287516528%22%7D%2C%7B%22x%22%3A25.096674%2C%22y%22%3A78.868164%2C%22width%22%3A13.443406000000003%2C%22height%22%3A12.511246%2C%22text%22%3A%226%22%7D%2C%7B%22x%22%3A372.21915%2C%22y%22%3A78.843094%2C%22width%22%3A21.172750000000008%2C%22height%22%3A12.422920000000005%2C%22text%22%3A%22118%22%7D%2C%7B%22x%22%3A383.4982%2C%22y%22%3A96.273026%2C%22width%22%3A185.7898%2C%22height%22%3A13.366754%2C%22text%22%3A%2204524217174689230%22%7D%2C%7B%22x%22%3A86.51954%2C%22y%22%3A96.43371%2C%22width%22%3A155.02061999999998%2C%22height%22%3A12.425669999999997%2C%22text%22%3A%222697201665287519720%22%7D%2C%7B%22x%22%3A342.2344%2C%22y%22%3A112.56297%2C%22width%22%3A10.575199999999995%2C%22height%22%3A10.575199999999995%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A377.27716%2C%22y%22%3A113.06143%2C%22width%22%3A180.11073999999996%2C%22height%22%3A13.148859999999999%2C%22text%22%3A%22324489216060709210%22%7D%2C%7B%22x%22%3A300.28024%2C%22y%22%3A113.050674%2C%22width%22%3A9.975500000000011%2C%22height%22%3A9.975500000000011%2C%22text%22%3A%22O%22%7D%2C%7B%22x%22%3A89.05355%2C%22y%22%3A113.203384%2C%22width%22%3A150.81783%2C%22height%22%3A11.927306000000002%2C%22text%22%3A%222664961665287522952%22%7D%2C%7B%22x%22%3A342.57172%2C%22y%22%3A128.02075%2C%22width%22%3A10.794059999999945%2C%22height%22%3A10.794059999999945%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A6.315183%2C%22y%22%3A129.72058%2C%22width%22%3A32.196287000000005%2C%22height%22%3A13.16592%2C%22text%22%3A%2280%22%7D%2C%7B%22x%22%3A370.26547%2C%22y%22%3A130.42949%2C%22width%22%3A165.68009%2C%22height%22%3A11.831330000000008%2C%22text%22%3A%22132482601713069922%22%7D%2C%7B%22x%22%3A88.78205%2C%22y%22%3A130.83449%2C%22width%22%3A151.69165%2C%22height%22%3A11.97714000000002%2C%22text%22%3A%222628841665287525924%22%7D%2C%7B%22x%22%3A89.00313%2C%22y%22%3A146.72209%2C%22width%22%3A151.79701%2C%22height%22%3A13.64663999999999%2C%22text%22%3A%222623081665287524196%22%7D%2C%7B%22x%22%3A391.1967%2C%22y%22%3A147.39508%2C%22width%22%3A147.8132%2C%22height%22%3A12.140979999999985%2C%22text%22%3A%22384181639267826%22%7D%2C%7B%22x%22%3A300.5989%2C%22y%22%3A147.77808%2C%22width%22%3A8.983159999999998%2C%22height%22%3A8.983159999999998%2C%22text%22%3A%22%22%7D%2C%7B%22x%22%3A342.33057%2C%22y%22%3A162.93231%2C%22width%22%3A10.268550000000005%2C%22height%22%3A10.268550000000005%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A89.51639%2C%22y%22%3A163.77757%2C%22width%22%3A151.13833%2C%22height%22%3A12.912260000000003%2C%22text%22%3A%222564801665327527320%22%7D%2C%7B%22x%22%3A371.66965%2C%22y%22%3A164.07234%2C%22width%22%3A198.82054999999997%2C%22height%22%3A12.27100999999999%2C%22text%22%3A%221044884317501699220%22%7D%2C%7B%22x%22%3A300.2859%2C%22y%22%3A164.29701%2C%22width%22%3A9.818229999999971%2C%22height%22%3A9.818229999999971%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A5.8755355%2C%22y%22%3A164.40231%2C%22width%22%3A31.289412500000005%2C%22height%22%3A12.506169999999997%2C%22text%22%3A%2250%22%7D%2C%7B%22x%22%3A89.44765%2C%22y%22%3A180.55278%2C%22width%22%3A151.13249000000002%2C%22height%22%3A12.979829999999993%2C%22text%22%3A%222536281665327530296%22%7D%2C%7B%22x%22%3A6.213869%2C%22y%22%3A180.40198%2C%22width%22%3A30.659685%2C%22height%22%3A12.56001999999998%2C%22text%22%3A%2250%22%7D%2C%7B%22x%22%3A386.92163%2C%22y%22%3A181.52792%2C%22width%22%3A187.11116999999996%2C%22height%22%3A12.579589999999996%2C%22text%22%3A%22Q4445315903689220%22%7D%2C%7B%22x%22%3A88.22233%2C%22y%22%3A197.61705%2C%22width%22%3A152.34716%2C%22height%22%3A13.421750000000003%2C%22text%22%3A%22249752166532_7533436%22%7D%2C%7B%22x%22%3A342.23447%2C%22y%22%3A197.53125%2C%22width%22%3A10.605130000000031%2C%22height%22%3A10.605130000000031%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A5.5909033%2C%22y%22%3A197.53123%2C%22width%22%3A32.0431717%2C%22height%22%3A13.811910000000012%2C%22text%22%3A%2280%22%7D%2C%7B%22x%22%3A386.30905%2C%22y%22%3A198.41469%2C%22width%22%3A183.85390999999998%2C%22height%22%3A12.904399999999981%2C%22text%22%3A%224775716317699220%22%7D%2C%7B%22x%22%3A300.64206%2C%22y%22%3A198.8834%2C%22width%22%3A9.264279999999985%2C%22height%22%3A9.264279999999985%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A87.22302%2C%22y%22%3A214.03087%2C%22width%22%3A153.55113%2C%22height%22%3A14.320970000000017%2C%22text%22%3A%222387561665327536240%22%7D%2C%7B%22x%22%3A378.73843%2C%22y%22%3A216.147%2C%22width%22%3A200.32606999999996%2C%22height%22%3A12.37548000000001%2C%22text%22%3A%222844840181736992200%22%7D%2C%7B%22x%22%3A88.37332%2C%22y%22%3A230.96373%2C%22width%22%3A152.27009999999999%2C%22height%22%3A13.594240000000013%2C%22text%22%3A%22233672166532_7539560%22%7D%2C%7B%22x%22%3A383.71356%2C%22y%22%3A231.82872%2C%22width%22%3A185.66181%2C%22height%22%3A13.850459999999998%2C%22text%22%3A%224371216996698230%22%7D%2C%7B%22x%22%3A300.67914%2C%22y%22%3A233.20828%2C%22width%22%3A8.87719999999996%2C%22height%22%3A8.87719999999996%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A88.06469%2C%22y%22%3A249.59114%2C%22width%22%3A152.22721%2C%22height%22%3A12.299939999999992%2C%22text%22%3A%222321161665327542548%22%7D%2C%7B%22x%22%3A376.8812%2C%22y%22%3A249.78256%2C%22width%22%3A204.07846%2C%22height%22%3A12.024260000000027%2C%22text%22%3A%228847234174256992200%22%7D%2C%7B%22x%22%3A88.16892%2C%22y%22%3A265.81213%2C%22width%22%3A152.11013000000003%2C%22height%22%3A13.02389999999997%2C%22text%22%3A%222283961665327545700%22%7D%2C%7B%22x%22%3A374.782%2C%22y%22%3A266.1659%2C%22width%22%3A208.69639999999998%2C%22height%22%3A12.141099999999994%2C%22text%22%3A%222845711175096892300%22%7D%2C%7B%22x%22%3A342.7943%2C%22y%22%3A266.21558%2C%22width%22%3A20.274%2C%22height%22%3A11.014160000000004%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A300.72488%2C%22y%22%3A266.34732%2C%22width%22%3A9.039320000000032%2C%22height%22%3A9.039320000000032%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A347.41638%2C%22y%22%3A281.61896%2C%22width%22%3A231.44662000000005%2C%22height%22%3A14.921539999999993%2C%22text%22%3A%220196459091756167112200%22%7D%2C%7B%22x%22%3A24.104183%2C%22y%22%3A282.09772%2C%22width%22%3A15.596985000000004%2C%22height%22%3A15.596985000000004%2C%22text%22%3A%22ooooo%22%7D%2C%7B%22x%22%3A88.090034%2C%22y%22%3A283.1687%2C%22width%22%3A152.959376%2C%22height%22%3A12.455840000000023%2C%22text%22%3A%222350761665327543364%22%7D%2C%7B%22x%22%3A299.989%2C%22y%22%3A283.60324%2C%22width%22%3A10.86265000000003%2C%22height%22%3A10.86265000000003%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A88.65299%2C%22y%22%3A299.13025%2C%22width%22%3A152.36335000000003%2C%22height%22%3A15.016300000000001%2C%22text%22%3A%222142801665327546012%22%7D%2C%7B%22x%22%3A344.00104%2C%22y%22%3A299.35278%2C%22width%22%3A240.39826000000005%2C%22height%22%3A13.959780000000023%2C%22text%22%3A%220836684555815383661024%22%7D%2C%7B%22x%22%3A376.73773%2C%22y%22%3A316.77466%2C%22width%22%3A199.81657%2C%22height%22%3A13.76654000000002%2C%22text%22%3A%222847719167456710230%22%7D%2C%7B%22x%22%3A89.98312%2C%22y%22%3A316.99564%2C%22width%22%3A150.73133%2C%22height%22%3A12.851620000000025%2C%22text%22%3A%222110561665327549120%22%7D%2C%7B%22x%22%3A342.04706%2C%22y%22%3A317.32144%2C%22width%22%3A14.459240000000023%2C%22height%22%3A12.14951000000002%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A89.91449%2C%22y%22%3A334.57928%2C%22width%22%3A150.89330999999999%2C%22height%22%3A12.720280000000002%2C%22text%22%3A%222093201665327552168%22%7D%2C%7B%22x%22%3A385.063%2C%22y%22%3A334.9128%2C%22width%22%3A196.49504000000002%2C%22height%22%3A11.782849999999996%2C%22text%22%3A%2247309165626992200%22%7D%2C%7B%22x%22%3A342.23407%2C%22y%22%3A350.65634%2C%22width%22%3A12.184200000000033%2C%22height%22%3A12.184200000000033%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A88.19087%2C%22y%22%3A351.43353%2C%22width%22%3A152.16422999999998%2C%22height%22%3A12.78344999999996%2C%22text%22%3A%222053521665327555032%22%7D%2C%7B%22x%22%3A382.90997%2C%22y%22%3A351.8599%2C%22width%22%3A200.39038%2C%22height%22%3A11.159420000000011%2C%22text%22%3A%22471501608768102300%22%7D%2C%7B%22x%22%3A87.48455%2C%22y%22%3A367.73895%2C%22width%22%3A153.16444%2C%22height%22%3A13.87115%2C%22text%22%3A%221981601665327557892%22%7D%2C%7B%22x%22%3A368.87878%2C%22y%22%3A368.8435%2C%22width%22%3A202.55531999999994%2C%22height%22%3A12.313359999999989%2C%22text%22%3A%22160461631615968923%22%7D%2C%7B%22x%22%3A343.00058%2C%22y%22%3A384.73294%2C%22width%22%3A9.65494000000001%2C%22height%22%3A9.65494000000001%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A84.352776%2C%22y%22%3A384.97284%2C%22width%22%3A156.431094%2C%22height%22%3A13.613059999999962%2C%22text%22%3A%221948281665327561016%22%7D%2C%7B%22x%22%3A300.40323%2C%22y%22%3A385.37836%2C%22width%22%3A9.49203%2C%22height%22%3A9.49203%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A377.01556%2C%22y%22%3A385.33603%2C%22width%22%3A197.35714000000002%2C%22height%22%3A12.179270000000031%2C%22text%22%3A%22284522216919699220%22%7D%2C%7B%22x%22%3A86.424%2C%22y%22%3A401.96747%2C%22width%22%3A154.59441999999999%2C%22height%22%3A12.742279999999994%2C%22text%22%3A%221922561665327564560%22%7D%2C%7B%22x%22%3A384.25262%2C%22y%22%3A402.78427%2C%22width%22%3A191.08123999999998%2C%22height%22%3A11.868030000000033%2C%22text%22%3A%222736218667717230%22%7D%2C%7B%22x%22%3A378.5186%2C%22y%22%3A419.0419%2C%22width%22%3A196.41475000000003%2C%22height%22%3A13.110099999999989%2C%22text%22%3A%2228475541693769102100%22%7D%2C%7B%22x%22%3A300.55896%2C%22y%22%3A419.83374%2C%22width%22%3A8.957310000000007%2C%22height%22%3A8.957310000000007%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A89.40146%2C%22y%22%3A420.005%2C%22width%22%3A151.36464%2C%22height%22%3A11.553899999999999%2C%22text%22%3A%221877921665327567540%22%7D%2C%7B%22x%22%3A86.99314%2C%22y%22%3A436.29657%2C%22width%22%3A153.52253000000002%2C%22height%22%3A12.588350000000048%2C%22text%22%3A%221812201665327570396%22%7D%2C%7B%22x%22%3A383.58627%2C%22y%22%3A437.04263%2C%22width%22%3A187.34145999999998%2C%22height%22%3A11.121370000000013%2C%22text%22%3A%2204294716403709220%22%7D%2C%7B%22x%22%3A378.8177%2C%22y%22%3A452.58347%2C%22width%22%3A161.69054%2C%22height%22%3A13.476560000000006%2C%22text%22%3A%2256369641646169822%22%7D%2C%7B%22x%22%3A88.80596%2C%22y%22%3A453.24042%2C%22width%22%3A151.98498%2C%22height%22%3A12.898250000000019%2C%22text%22%3A%221776641665327573496%22%7D%2C%7B%22x%22%3A342.6345%2C%22y%22%3A469.79678%2C%22width%22%3A10.741449999999986%2C%22height%22%3A10.741449999999986%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A378.4882%2C%22y%22%3A470.32593%2C%22width%22%3A159.65769999999998%2C%22height%22%3A12.316339999999968%2C%22text%22%3A%22365062117322681022%22%7D%2C%7B%22x%22%3A89.276825%2C%22y%22%3A470.52853%2C%22width%22%3A151.661225%2C%22height%22%3A12.755989999999997%2C%22text%22%3A%221768041665327576248%22%7D%2C%7B%22x%22%3A300.6449%2C%22y%22%3A470.83633%2C%22width%22%3A9.000119999999981%2C%22height%22%3A9.000119999999981%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A91.10246%2C%22y%22%3A486.18286%2C%22width%22%3A149.40912000000003%2C%22height%22%3A13.719580000000008%2C%22text%22%3A%221737041665327579220%22%7D%2C%7B%22x%22%3A384.59448%2C%22y%22%3A487.20496%2C%22width%22%3A157.01522%2C%22height%22%3A12.230559999999969%2C%22text%22%3A%22415771716869823%22%7D%2C%7B%22x%22%3A300.6797%2C%22y%22%3A487.286%2C%22width%22%3A8.690699999999993%2C%22height%22%3A8.690699999999993%2C%22text%22%3A%22G%22%7D%2C%7B%22x%22%3A342.20633%2C%22y%22%3A502.5748%2C%22width%22%3A10.584350000000029%2C%22height%22%3A10.584350000000029%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A89.53792%2C%22y%22%3A504.10318%2C%22width%22%3A150.44569%2C%22height%22%3A12.845420000000047%2C%22text%22%3A%22164032166532_7582412%22%7D%2C%7B%22x%22%3A7.99593%2C%22y%22%3A504.211%2C%22width%22%3A27.365097%2C%22height%22%3A11.772899999999936%2C%22text%22%3A%2280%22%7D%2C%7B%22x%22%3A384.99182%2C%22y%22%3A504.42203%2C%22width%22%3A155.76867999999996%2C%22height%22%3A11.540770000000009%2C%22text%22%3A%220449171666668923%22%7D%2C%7B%22x%22%3A299.70428%2C%22y%22%3A504.57797%2C%22width%22%3A10.24305000000004%2C%22height%22%3A10.24305000000004%2C%22text%22%3A%22%3F%22%7D%2C%7B%22x%22%3A87.2144%2C%22y%22%3A521.4335%2C%22width%22%3A153.72168%2C%22height%22%3A13.509000000000015%2C%22text%22%3A%221614001665327585092%22%7D%2C%7B%22x%22%3A377.89603%2C%22y%22%3A521.57983%2C%22width%22%3A186.58511%2C%22height%22%3A11.737369999999942%2C%22text%22%3A%22284507216767699220%22%7D%2C%7B%22x%22%3A342.82996%2C%22y%22%3A535.39545%2C%22width%22%3A10.292239999999993%2C%22height%22%3A10.292239999999993%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A88.87181%2C%22y%22%3A536.9467%2C%22width%22%3A152.95039000000003%2C%22height%22%3A14.25795000000005%2C%22text%22%3A%221572921665327588196%22%7D%2C%7B%22x%22%3A24.024803%2C%22y%22%3A537.2976%2C%22width%22%3A13.499279000000001%2C%22height%22%3A13.422300000000064%2C%22text%22%3A%22%3F%22%7D%2C%7B%22x%22%3A376.66626%2C%22y%22%3A538.0103%2C%22width%22%3A200.87593999999996%2C%22height%22%3A13.105500000000006%2C%22text%22%3A%2276472841717569102100%22%7D%2C%7B%22x%22%3A300.33466%2C%22y%22%3A538.4547%2C%22width%22%3A9.51681000000002%2C%22height%22%3A9.51681000000002%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A342.64066%2C%22y%22%3A552.3413%2C%22width%22%3A11.035519999999963%2C%22height%22%3A11.035519999999963%2C%22text%22%3A%224%22%7D%2C%7B%22x%22%3A89.2238%2C%22y%22%3A554.61115%2C%22width%22%3A152.22140000000002%2C%22height%22%3A13.432950000000005%2C%22text%22%3A%221568121665367590944%22%7D%2C%7B%22x%22%3A364.5345%2C%22y%22%3A554.99384%2C%22width%22%3A216.90520000000004%2C%22height%22%3A12.58281999999997%2C%22text%22%3A%228076536931636067102300%22%7D%2C%7B%22x%22%3A24.634003%2C%22y%22%3A570.5576%2C%22width%22%3A13.999197000000002%2C%22height%22%3A13.999197000000002%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A342.2343%2C%22y%22%3A571.0904%2C%22width%22%3A11.235269999999957%2C%22height%22%3A11.235269999999957%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A89.70772%2C%22y%22%3A571.9683%2C%22width%22%3A150.98005%2C%22height%22%3A13.429399999999987%2C%22text%22%3A%221532161665367594192%22%7D%2C%7B%22x%22%3A300.005%2C%22y%22%3A572.58954%2C%22width%22%3A9.876260000000002%2C%22height%22%3A9.876260000000002%2C%22text%22%3A%22O%22%7D%2C%7B%22x%22%3A379.03024%2C%22y%22%3A572.837%2C%22width%22%3A204.13321000000002%2C%22height%22%3A11.293300000000045%2C%22text%22%3A%222841868174406992300%22%7D%2C%7B%22x%22%3A387.17996%2C%22y%22%3A590.15906%2C%22width%22%3A181.65024%2C%22height%22%3A11.718540000000075%2C%22text%22%3A%22482991688470921%22%7D%2C%7B%22x%22%3A89.48729%2C%22y%22%3A589.68774%2C%22width%22%3A151.30131%2C%22height%22%3A12.850900000000024%2C%22text%22%3A%221623921665367581596%22%7D%2C%7B%22x%22%3A89.28428%2C%22y%22%3A606.3594%2C%22width%22%3A151.43973%2C%22height%22%3A12.790750000000003%2C%22text%22%3A%221586721665367584732%22%7D%2C%7B%22x%22%3A384.09836%2C%22y%22%3A606.4503%2C%22width%22%3A190.59939000000003%2C%22height%22%3A13.769600000000082%2C%22text%22%3A%224903517023681022%22%7D%2C%7B%22x%22%3A371.48254%2C%22y%22%3A623.2668%2C%22width%22%3A195.27466000000004%2C%22height%22%3A13.12340000000006%2C%22text%22%3A%221362802318801706230%22%7D%2C%7B%22x%22%3A91.413345%2C%22y%22%3A623.8989%2C%22width%22%3A148.772495%2C%22height%22%3A11.024400000000014%2C%22text%22%3A%221560681665367588324%22%7D%2C%7B%22x%22%3A386.3131%2C%22y%22%3A640.56036%2C%22width%22%3A180.29979999999995%2C%22height%22%3A12.530740000000037%2C%22text%22%3A%228466061711568923%22%7D%2C%7B%22x%22%3A90.848206%2C%22y%22%3A640.88763%2C%22width%22%3A149.248394%2C%22height%22%3A11.439870000000042%2C%22text%22%3A%221527041665367591376%22%7D%2C%7B%22x%22%3A386.56326%2C%22y%22%3A657.4722%2C%22width%22%3A178.99203999999997%2C%22height%22%3A11.474699999999984%2C%22text%22%3A%2204393416374689230%22%7D%2C%7B%22x%22%3A90.102936%2C%22y%22%3A657.25665%2C%22width%22%3A149.506504%2C%22height%22%3A12.83254999999997%2C%22text%22%3A%221576641665367578852%22%7D%2C%7B%22x%22%3A380.10007%2C%22y%22%3A673.0004%2C%22width%22%3A164.75512999999995%2C%22height%22%3A15.202969999999937%2C%22text%22%3A%2228453221677668923%22%7D%2C%7B%22x%22%3A5.924758%2C%22y%22%3A674.2681%2C%22width%22%3A29.866992%2C%22height%22%3A13.766100000000051%2C%22text%22%3A%2250%22%7D%2C%7B%22x%22%3A89.11663%2C%22y%22%3A674.4219%2C%22width%22%3A151.68838%2C%22height%22%3A12.465099999999893%2C%22text%22%3A%221560521665367582060%22%7D%2C%7B%22x%22%3A7.010612%2C%22y%22%3A690.4156%2C%22width%22%3A30.937424%2C%22height%22%3A13.751329999999939%2C%22text%22%3A%2280%22%7D%2C%7B%22x%22%3A90.22019%2C%22y%22%3A691.33%2C%22width%22%3A150.54304%2C%22height%22%3A12.526139999999941%2C%22text%22%3A%221529521665367584836%22%7D%2C%7B%22x%22%3A385.13495%2C%22y%22%3A691.5079%2C%22width%22%3A155.62255000000005%2C%22height%22%3A12.307800000000043%2C%22text%22%3A%2204892316511681022%22%7D%2C%7B%22x%22%3A300.3457%2C%22y%22%3A691.5876%2C%22width%22%3A9.172820000000002%2C%22height%22%3A9.172820000000002%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A3.1506927%2C%22y%22%3A707.4938%2C%22width%22%3A33.3669873%2C%22height%22%3A12.81907000000001%2C%22text%22%3A%22180%22%7D%2C%7B%22x%22%3A89.76583%2C%22y%22%3A707.88885%2C%22width%22%3A151.13670000000002%2C%22height%22%3A12.950249999999983%2C%22text%22%3A%221665921665047571540%22%7D%2C%7B%22x%22%3A379.1278%2C%22y%22%3A708.1939%2C%22width%22%3A165.14999999999998%2C%22height%22%3A12.800100000000043%2C%22text%22%3A%2280387301716970822%22%7D%2C%7B%22x%22%3A342.2344%2C%22y%22%3A723.2266%2C%22width%22%3A11.137299999999982%2C%22height%22%3A11.137299999999982%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A379.39008%2C%22y%22%3A725.03467%2C%22width%22%3A166.52428999999995%2C%22height%22%3A12.25018%2C%22text%22%3A%22404646514964651025%22%7D%2C%7B%22x%22%3A90.01136%2C%22y%22%3A725.1135%2C%22width%22%3A150.84731%2C%22height%22%3A11.697199999999953%2C%22text%22%3A%221659161665047569896%22%7D%2C%7B%22x%22%3A6.4684453%2C%22y%22%3A725.19543%2C%22width%22%3A29.7093117%2C%22height%22%3A12.485070000000064%2C%22text%22%3A%2280%22%7D%2C%7B%22x%22%3A299.64386%2C%22y%22%3A725.32947%2C%22width%22%3A10.059910000000002%2C%22height%22%3A10.059910000000002%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A342.7067%2C%22y%22%3A739.62445%2C%22width%22%3A10.743560000000002%2C%22height%22%3A10.743560000000002%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A7.5029817%2C%22y%22%3A742.40674%2C%22width%22%3A30.363290300000003%2C%22height%22%3A12.150759999999991%2C%22text%22%3A%2280%22%7D%2C%7B%22x%22%3A388.9239%2C%22y%22%3A742.4665%2C%22width%22%3A175.08889999999997%2C%22height%22%3A12.11099999999999%2C%22text%22%3A%224364516640689220%22%7D%2C%7B%22x%22%3A88.208305%2C%22y%22%3A742.7549%2C%22width%22%3A152.029835%2C%22height%22%3A12.51019999999994%2C%22text%22%3A%221590041665047572472%22%7D%2C%7B%22x%22%3A342.6342%2C%22y%22%3A757.2031%2C%22width%22%3A10.826829999999973%2C%22height%22%3A10.826829999999973%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A387.85165%2C%22y%22%3A758.6231%2C%22width%22%3A171.34065000000004%2C%22height%22%3A13.034199999999942%2C%22text%22%3A%2204511716902689230%22%7D%2C%7B%22x%22%3A88.54454%2C%22y%22%3A759.0103%2C%22width%22%3A151.75905%2C%22height%22%3A13.366159999999923%2C%22text%22%3A%221539201665047575640%22%7D%2C%7B%22x%22%3A18.680317%2C%22y%22%3A758.9456%2C%22width%22%3A18.261623000000004%2C%22height%22%3A11.411899999999946%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A300.1463%2C%22y%22%3A759.4655%2C%22width%22%3A9.511720000000025%2C%22height%22%3A9.511720000000025%2C%22text%22%3A%22O%22%7D%2C%7B%22x%22%3A342.99997%2C%22y%22%3A774.8123%2C%22width%22%3A10.268529999999998%2C%22height%22%3A10.268529999999998%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A377.5166%2C%22y%22%3A776.17926%2C%22width%22%3A168.6076%2C%22height%22%3A12.421240000000012%2C%22text%22%3A%222854626191186711.22%22%7D%2C%7B%22x%22%3A89.19891%2C%22y%22%3A776.41077%2C%22width%22%3A151.06337000000002%2C%22height%22%3A12.285889999999995%2C%22text%22%3A%221670481665047562408%22%7D%2C%7B%22x%22%3A299.854%2C%22y%22%3A776.7735%2C%22width%22%3A10.456000000000017%2C%22height%22%3A10.456000000000017%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A24.921453%2C%22y%22%3A788.65704%2C%22width%22%3A13.048307000000001%2C%22height%22%3A13.048307000000001%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A342.99997%2C%22y%22%3A791.93805%2C%22width%22%3A13.905699999999968%2C%22height%22%3A13.121399999999994%2C%22text%22%3A%224%22%7D%2C%7B%22x%22%3A373.32755%2C%22y%22%3A792.9035%2C%22width%22%3A185.54515000000004%2C%22height%22%3A12.71169999999995%2C%22text%22%3A%22762564619764726220%22%7D%2C%7B%22x%22%3A89.67845%2C%22y%22%3A793.1431%2C%22width%22%3A150.81804%2C%22height%22%3A12.228200000000015%2C%22text%22%3A%221669401665047565920%22%7D%2C%7B%22x%22%3A300.47946%2C%22y%22%3A793.59283%2C%22width%22%3A9.147159999999985%2C%22height%22%3A9.147159999999985%2C%22text%22%3A%22%22%7D%2C%7B%22x%22%3A341.28305%2C%22y%22%3A808.6543%2C%22width%22%3A226.18494999999996%2C%22height%22%3A13.932860000000005%2C%22text%22%3A%220835724689215944709210%22%7D%2C%7B%22x%22%3A89.529106%2C%22y%22%3A810.49146%2C%22width%22%3A150.30965400000002%2C%22height%22%3A12.18554000000006%2C%22text%22%3A%221705361665047543932%22%7D%2C%7B%22x%22%3A300.18478%2C%22y%22%3A810.7484%2C%22width%22%3A9.863620000000026%2C%22height%22%3A9.863620000000026%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A88.80259%2C%22y%22%3A826.6851%2C%22width%22%3A151.98194%2C%22height%22%3A13.15039999999999%2C%22text%22%3A%221690241665047547160%22%7D%2C%7B%22x%22%3A376.4168%2C%22y%22%3A827.6167%2C%22width%22%3A206.08589999999998%2C%22height%22%3A12.231899999999996%2C%22text%22%3A%2232471731696267102300%22%7D%2C%7B%22x%22%3A385.1102%2C%22y%22%3A843.89%2C%22width%22%3A187.67419999999998%2C%22height%22%3A13.095800000000054%2C%22text%22%3A%224790016807699210%22%7D%2C%7B%22x%22%3A89.31895%2C%22y%22%3A844.3169%2C%22width%22%3A151.36065%2C%22height%22%3A11.625699999999938%2C%22text%22%3A%221651801665047550240%22%7D%2C%7B%22x%22%3A300.65018%2C%22y%22%3A845.2831%2C%22width%22%3A8.839920000000006%2C%22height%22%3A8.839920000000006%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A383.3177%2C%22y%22%3A861.9435%2C%22width%22%3A196.15490000000005%2C%22height%22%3A11.279700000000048%2C%22text%22%3A%22045214164236892300%22%7D%2C%7B%22x%22%3A88.006325%2C%22y%22%3A862.0248%2C%22width%22%3A152.071695%2C%22height%22%3A11.194259999999986%2C%22text%22%3A%221640641665047553004%22%7D%2C%7B%22x%22%3A6.862378%2C%22y%22%3A876.55615%2C%22width%22%3A30.165945999999998%2C%22height%22%3A14.047050000000013%2C%22text%22%3A%2230%22%7D%2C%7B%22x%22%3A87.51159%2C%22y%22%3A877.81915%2C%22width%22%3A152.47638999999998%2C%22height%22%3A12.23804999999993%2C%22text%22%3A%222018841664967506748%22%7D%2C%7B%22x%22%3A371.3458%2C%22y%22%3A878.2507%2C%22width%22%3A210.6008%2C%22height%22%3A11.70679999999993%2C%22text%22%3A%22144488471675668102200%22%7D%2C%7B%22x%22%3A301.1632%2C%22y%22%3A878.9867%2C%22width%22%3A8.038729999999987%2C%22height%22%3A8.038729999999987%2C%22text%22%3A%22%3F%22%7D%2C%7B%22x%22%3A86.14147%2C%22y%22%3A895.4633%2C%22width%22%3A154.8697%2C%22height%22%3A12.241049999999973%2C%22text%22%3A%221968001664967509836%22%7D%2C%7B%22x%22%3A372.06198%2C%22y%22%3A895.83435%2C%22width%22%3A196.00197999999995%2C%22height%22%3A11.910750000000007%2C%22text%22%3A%2214849001166096810220%22%7D%2C%7B%22x%22%3A86.138176%2C%22y%22%3A911.7286%2C%22width%22%3A155.520394%2C%22height%22%3A13.20939999999996%2C%22text%22%3A%221955281664967512916%22%7D%2C%7B%22x%22%3A301.04105%2C%22y%22%3A912.60443%2C%22width%22%3A8.112510000000043%2C%22height%22%3A8.112510000000043%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A386.05478%2C%22y%22%3A913.208%2C%22width%22%3A194.86521999999997%2C%22height%22%3A11.089240000000018%2C%22text%22%3A%22048111173446992200%22%7D%2C%7B%22x%22%3A88.21278%2C%22y%22%3A928.9482%2C%22width%22%3A152.81429000000003%2C%22height%22%3A12.975259999999935%2C%22text%22%3A%221541121664967515892%22%7D%2C%7B%22x%22%3A380.46356%2C%22y%22%3A930.1028%2C%22width%22%3A188.42304000000007%2C%22height%22%3A10.855760000000032%2C%22text%22%3A%22284242717374669250%22%7D%2C%7B%22x%22%3A342.39124%2C%22y%22%3A944.9522%2C%22width%22%3A10.579340000000002%2C%22height%22%3A10.579340000000002%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A89.84413%2C%22y%22%3A945.93945%2C%22width%22%3A151.12762999999998%2C%22height%22%3A12.807009999999991%2C%22text%22%3A%221599401664967502260%22%7D%2C%7B%22x%22%3A394.95605%2C%22y%22%3A946.51355%2C%22width%22%3A166.38815%2C%22height%22%3A11.400999999999954%2C%22text%22%3A%22294721623771623%22%7D%2C%7B%22x%22%3A382.61182%2C%22y%22%3A962.3091%2C%22width%22%3A165.81627999999995%2C%22height%22%3A14.038800000000037%2C%22text%22%3A%2280445631694869922%22%7D%2C%7B%22x%22%3A88.08954%2C%22y%22%3A963.3272%2C%22width%22%3A152.51352%2C%22height%22%3A12.872600000000034%2C%22text%22%3A%221562201664967504948%22%7D%2C%7B%22x%22%3A-0.15805528%2C%22y%22%3A963.32733%2C%22width%22%3A15.990707279999999%2C%22height%22%3A11.838570000000004%2C%22text%22%3A%2210%22%7D%5D%2C%22style%22%3A%22none%22%2C%22search%22%3A%2216%3A99%3A42deployeVEcSo18052%20vmstat1100%20memory%20system--%20procs%20buff%20free%20bo%20csussyidwast%20cache%20SO%20swpd%200%200619200%202725801665287516528%206%20118%2004524217174689230%202697201665287519720%200%20324489216060709210%20O%202664961665287522952%200%2080%20132482601713069922%202628841665287525924%202623081665287524196%20384181639267826%20%200%202564801665327527320%201044884317501699220%200%2050%202536281665327530296%2050%20Q4445315903689220%20249752166532_7533436%200%2080%204775716317699220%200%202387561665327536240%202844840181736992200%20233672166532_7539560%204371216996698230%200%202321161665327542548%208847234174256992200%202283961665327545700%202845711175096892300%200%200%200196459091756167112200%20ooooo%202350761665327543364%200%202142801665327546012%200836684555815383661024%202847719167456710230%202110561665327549120%200%202093201665327552168%2047309165626992200%200%202053521665327555032%20471501608768102300%201981601665327557892%20160461631615968923%200%201948281665327561016%200%20284522216919699220%201922561665327564560%202736218667717230%2028475541693769102100%200%201877921665327567540%201812201665327570396%2004294716403709220%2056369641646169822%201776641665327573496%200%20365062117322681022%201768041665327576248%200%201737041665327579220%20415771716869823%20G%200%20164032166532_7582412%2080%200449171666668923%20%3F%201614001665327585092%20284507216767699220%200%201572921665327588196%20%3F%2076472841717569102100%200%204%201568121665367590944%208076536931636067102300%200%200%201532161665367594192%20O%202841868174406992300%20482991688470921%201623921665367581596%201586721665367584732%204903517023681022%201362802318801706230%201560681665367588324%208466061711568923%201527041665367591376%2004393416374689230%201576641665367578852%2028453221677668923%2050%201560521665367582060%2080%201529521665367584836%2004892316511681022%200%20180%201665921665047571540%2080387301716970822%200%20404646514964651025%201659161665047569896%2080%200%200%2080%204364516640689220%201590041665047572472%200%2004511716902689230%201539201665047575640%200%20O%200%202854626191186711.22%201670481665047562408%200%200%204%20762564619764726220%201669401665047565920%20%200835724689215944709210%201705361665047543932%200%201690241665047547160%2032471731696267102300%204790016807699210%201651801665047550240%200%20045214164236892300%201640641665047553004%2030%202018841664967506748%20144488471675668102200%20%3F%201968001664967509836%2014849001166096810220%201955281664967512916%200%20048111173446992200%201541121664967515892%20284242717374669250%200%201599401664967502260%20294721623771623%2080445631694869922%201562201664967504948%2010%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22width%22%3A631%2C%22height%22%3A980%7D"><a href="https://huster.top/wp-content/uploads/2021/02/4.png"><img class="alignnone size-full wp-image-755" src="https://huster.top/wp-content/uploads/2021/02/4.png" alt="" width="631" height="980" /></a></span></p>
<p data-lake-id="18d615f5adbe34ce84b998e9417471be">vmstat每一列信息对照表</p>
<p data-lake-id="bd68cb48b0ba656aa46748573e6f7113"><span class="lake-card-margin-top lake-card-margin-bottom lake-selected" data-card-type="inline" data-lake-card="image" data-card-value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F180554%2F1613721508001-b7370d5f-661f-42e5-b8ec-ee3fa6d469ac.png%22%2C%22originWidth%22%3A752%2C%22originHeight%22%3A373%2C%22name%22%3A%22image.png%22%2C%22size%22%3A65598%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A561.9086%2C%22y%22%3A8.269524%2C%22width%22%3A145.49620000000004%2C%22height%22%3A14.161214000000001%2C%22text%22%3A%22%E7%94%A8%E6%88%B7%E8%BF%9B%E5%B7%B7%E7%9A%84%E5%8D%B0%E9%A3%8E%E4%BD%BF%E7%94%A8%E7%8E%87%22%7D%2C%7B%22x%22%3A337.5295%2C%22y%22%3A22.496096%2C%22width%22%3A173.65693%2C%22height%22%3A13.924323999999999%2C%22text%22%3A%22%E5%BD%93%E5%89%8D%E6%AD%A3%E8%95%8A%E5%A4%84%E7%90%86%E7%9A%84%E4%B8%AD%E6%8A%98%E7%9A%84%E6%95%B0%22%7D%2C%7B%22x%22%3A15.304714%2C%22y%22%3A31.867258%2C%22width%22%3A285.770606%2C%22height%22%3A15.607905000000002%2C%22text%22%3A%22%E5%BD%93%E5%89%8D%E8%BF%90%E8%A1%8C%E9%98%9F%E5%88%B0%E4%B8%AD%E5%B7%B2%E5%B0%B1%E7%BB%A9%E4%BD%86%E8%BF%98%E6%9C%A8%E6%89%A7%E8%A1%8C%E7%9A%84%E8%BF%90%E5%B7%B7%22%7D%2C%7B%22x%22%3A455.0371%2C%22y%22%3A49.02367%2C%22width%22%3A175.56085999999993%2C%22height%22%3A15.323590000000003%2C%22text%22%3A%22%E5%BD%93%E5%89%8D%E5%8F%91%E7%94%9F%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E5%9C%BA%E6%8D%A2%E6%95%B0%22%7D%2C%7B%22x%22%3A447.71545%2C%22y%22%3A81.32367%2C%22width%22%3A16.36719000000005%2C%22height%22%3A11.150569999999988%2C%22text%22%3A%22i0%22%7D%2C%7B%22x%22%3A508.87122%2C%22y%22%3A81.51922%2C%22width%22%3A53.85937999999999%2C%22height%22%3A12.964963999999995%2C%22text%22%3A%22system-%22%7D%2C%7B%22x%22%3A190.51945%2C%22y%22%3A82.381874%2C%22width%22%3A52.08382%2C%22height%22%3A11.003501999999997%2C%22text%22%3A%22memory%3A%22%7D%2C%7B%22x%22%3A354.59253%2C%22y%22%3A82.80777%2C%22width%22%3A27.878999999999962%2C%22height%22%3A11.15061%2C%22text%22%3A%22swap%22%7D%2C%7B%22x%22%3A55.21303%2C%22y%22%3A83.182556%2C%22width%22%3A40.08076%2C%22height%22%3A10.134463999999994%2C%22text%22%3A%22procs%22%7D%2C%7B%22x%22%3A620.0435%2C%22y%22%3A83.880684%2C%22width%22%3A19.590400000000045%2C%22height%22%3A9.440355999999994%2C%22text%22%3A%22cpu%22%7D%2C%7B%22x%22%3A227.58441%2C%22y%22%3A97.03518%2C%22width%22%3A34.83285999999998%2C%22height%22%3A13.199294000000009%2C%22text%22%3A%22buff%22%7D%2C%7B%22x%22%3A431.58823%2C%22y%22%3A97.472786%2C%22width%22%3A15.627830000000017%2C%22height%22%3A12.665064000000001%2C%22text%22%3A%22bi%22%7D%2C%7B%22x%22%3A176.31908%2C%22y%22%3A97.79954%2C%22width%22%3A31.129999999999995%2C%22height%22%3A11.75670000000001%2C%22text%22%3A%22free%22%7D%2C%7B%22x%22%3A638.5203%2C%22y%22%3A98.06229%2C%22width%22%3A10.846900000000005%2C%22height%22%3A10.846900000000005%2C%22text%22%3A%22d%22%7D%2C%7B%22x%22%3A479.27066%2C%22y%22%3A98.525444%2C%22width%22%3A17.046969999999988%2C%22height%22%3A10.830706000000006%2C%22text%22%3A%22bo%22%7D%2C%7B%22x%22%3A280.27194%2C%22y%22%3A98.99997%2C%22width%22%3A39.202180000000055%2C%22height%22%3A11.471983999999992%2C%22text%22%3A%22cache%22%7D%2C%7B%22x%22%3A656.95526%2C%22y%22%3A99.002525%2C%22width%22%3A15.528740000000084%2C%22height%22%3A11.981814999999997%2C%22text%22%3A%22wa%22%7D%2C%7B%22x%22%3A384.8536%2C%22y%22%3A98.42785%2C%22width%22%3A15.257100000000037%2C%22height%22%3A11.969069999999988%2C%22text%22%3A%22SO%22%7D%2C%7B%22x%22%3A120.13383%2C%22y%22%3A98.77014%2C%22width%22%3A33.443%2C%22height%22%3A12.563209999999998%2C%22text%22%3A%22swpd%22%7D%2C%7B%22x%22%3A480.63818%2C%22y%22%3A114.348755%2C%22width%22%3A14.965000000000032%2C%22height%22%3A11.432775000000007%2C%22text%22%3A%2235%22%7D%2C%7B%22x%22%3A522.1227%2C%22y%22%3A114.50465%2C%22width%22%3A14.30639999999994%2C%22height%22%3A11.200130000000001%2C%22text%22%3A%229%22%7D%2C%7B%22x%22%3A224.60168%2C%22y%22%3A114.86444%2C%22width%22%3A95.29599000000002%2C%22height%22%3A12.366209999999995%2C%22text%22%3A%2250816247660%22%7D%2C%7B%22x%22%3A423.97498%2C%22y%22%3A115.06602%2C%22width%22%3A24.342769999999973%2C%22height%22%3A12.191144000000008%2C%22text%22%3A%22111%22%7D%2C%7B%22x%22%3A166.63365%2C%22y%22%3A115.08392%2C%22width%22%3A42.42407%2C%22height%22%3A12.11766%2C%22text%22%3A%2249524%22%7D%2C%7B%22x%22%3A351.33337%2C%22y%22%3A115.0212%2C%22width%22%3A9.327789999999993%2C%22height%22%3A9.327789999999993%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A143.38805%2C%22y%22%3A115.28851%2C%22width%22%3A9.85626000000002%2C%22height%22%3A9.85626000000002%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A552.53754%2C%22y%22%3A115.579704%2C%22width%22%3A22.44029999999998%2C%22height%22%3A10.736221999999998%2C%22text%22%3A%22127%22%7D%2C%7B%22x%22%3A662.63074%2C%22y%22%3A130.82896%2C%22width%22%3A10.579060000000027%2C%22height%22%3A10.579060000000027%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A166.81746%2C%22y%22%3A131.95728%2C%22width%22%3A41.76147%2C%22height%22%3A12.74942999999999%2C%22text%22%3A%2249392%22%7D%2C%7B%22x%22%3A351.33328%2C%22y%22%3A131.80786%2C%22width%22%3A9.19932%2C%22height%22%3A9.19932%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A559.00714%2C%22y%22%3A132.01894%2C%22width%22%3A15.915859999999952%2C%22height%22%3A11.448760000000021%2C%22text%22%3A%2271%22%7D%2C%7B%22x%22%3A520.64056%2C%22y%22%3A131.98784%2C%22width%22%3A16.343039999999974%2C%22height%22%3A11.857339999999994%2C%22text%22%3A%2258%22%7D%2C%7B%22x%22%3A223.98706%2C%22y%22%3A132.40343%2C%22width%22%3A95.74683999999999%2C%22height%22%3A11.546350000000018%2C%22text%22%3A%2250816247660%22%7D%2C%7B%22x%22%3A391.56372%2C%22y%22%3A131.87952%2C%22width%22%3A9.726080000000024%2C%22height%22%3A9.726080000000024%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A62.207596%2C%22y%22%3A146.66467%2C%22width%22%3A11.294349000000004%2C%22height%22%3A11.294349000000004%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A554.11633%2C%22y%22%3A148.44498%2C%22width%22%3A22.431370000000015%2C%22height%22%3A11.952620000000024%2C%22text%22%3A%22152%22%7D%2C%7B%22x%22%3A169.86737%2C%22y%22%3A148.71887%2C%22width%22%3A37.94157000000001%2C%22height%22%3A11.418929999999989%2C%22text%22%3A%2249360%22%7D%2C%7B%22x%22%3A351.2224%2C%22y%22%3A148.75139%2C%22width%22%3A9.644800000000032%2C%22height%22%3A9.644800000000032%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A439.22437%2C%22y%22%3A148.88063%2C%22width%22%3A9.184229999999957%2C%22height%22%3A9.184229999999957%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A520.46027%2C%22y%22%3A148.6645%2C%22width%22%3A17.969479999999976%2C%22height%22%3A11.229479999999995%2C%22text%22%3A%2289%22%7D%2C%7B%22x%22%3A663.3334%2C%22y%22%3A148.7329%2C%22width%22%3A9.907699999999977%2C%22height%22%3A9.907699999999977%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A391.24118%2C%22y%22%3A148.7571%2C%22width%22%3A9.14566000000002%2C%22height%22%3A9.14566000000002%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A224.39282%2C%22y%22%3A149.17084%2C%22width%22%3A95.56858000000003%2C%22height%22%3A11.646530000000013%2C%22text%22%3A%2250816247660%22%7D%2C%7B%22x%22%3A61.457745%2C%22y%22%3A164.03233%2C%22width%22%3A11.875574999999998%2C%22height%22%3A11.875574999999998%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A84.497826%2C%22y%22%3A164.74884%2C%22width%22%3A12.296204000000003%2C%22height%22%3A12.296204000000003%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A663.98895%2C%22y%22%3A165.99239%2C%22width%22%3A8.535949999999957%2C%22height%22%3A8.535949999999957%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A391.49637%2C%22y%22%3A165.83919%2C%22width%22%3A9.380859999999984%2C%22height%22%3A9.380859999999984%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A168.41805%2C%22y%22%3A166.61902%2C%22width%22%3A39.90917000000002%2C%22height%22%3A10.714349999999996%2C%22text%22%3A%2249360%22%7D%2C%7B%22x%22%3A351.631%2C%22y%22%3A166.48347%2C%22width%22%3A9.346540000000005%2C%22height%22%3A9.346540000000005%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A224.31874%2C%22y%22%3A166.92775%2C%22width%22%3A95.43453%2C%22height%22%3A11.072969999999998%2C%22text%22%3A%2250816247660%22%7D%2C%7B%22x%22%3A521.65753%2C%22y%22%3A166.83281%2C%22width%22%3A13.523810000000026%2C%22height%22%3A10.95947000000001%2C%22text%22%3A%2258%22%7D%2C%7B%22x%22%3A635.4881%2C%22y%22%3A167.1649%2C%22width%22%3A12.497070000000008%2C%22height%22%3A9.57369%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A561.2432%2C%22y%22%3A168.06505%2C%22width%22%3A14.693599999999947%2C%22height%22%3A8.683839999999975%2C%22text%22%3A%229%22%7D%2C%7B%22x%22%3A663.7094%2C%22y%22%3A182.66664%2C%22width%22%3A8.819000000000074%2C%22height%22%3A8.819000000000074%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A62.278824%2C%22y%22%3A182.59117%2C%22width%22%3A10.693976000000006%2C%22height%22%3A10.693976000000006%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A390.8046%2C%22y%22%3A182.66661%2C%22width%22%3A9.949549999999988%2C%22height%22%3A9.949549999999988%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A350.89822%2C%22y%22%3A182.8927%2C%22width%22%3A10.044039999999995%2C%22height%22%3A10.044039999999995%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A224.88348%2C%22y%22%3A183.05414%2C%22width%22%3A38.406379999999984%2C%22height%22%3A11.95854%2C%22text%22%3A%2250816%22%7D%2C%7B%22x%22%3A168.26755%2C%22y%22%3A183.15338%2C%22width%22%3A40.36546000000001%2C%22height%22%3A11.613820000000004%2C%22text%22%3A%2249360%22%7D%2C%7B%22x%22%3A271.12823%2C%22y%22%3A183.19707%2C%22width%22%3A48.64771000000002%2C%22height%22%3A11.964179999999999%2C%22text%22%3A%22247660%22%7D%2C%7B%22x%22%3A553.983%2C%22y%22%3A183.42505%2C%22width%22%3A22.342500000000086%2C%22height%22%3A11.854119999999995%2C%22text%22%3A%22152%22%7D%2C%7B%22x%22%3A522.1732%2C%22y%22%3A183.54942%2C%22width%22%3A14.83910000000003%2C%22height%22%3A10.842479999999995%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A224.76057%2C%22y%22%3A199.42516%2C%22width%22%3A95.38820000000001%2C%22height%22%3A12.999020000000002%2C%22text%22%3A%2250824247652%22%7D%2C%7B%22x%22%3A560.4067%2C%22y%22%3A199.80603%2C%22width%22%3A15.495769999999993%2C%22height%22%3A10.6781%2C%22text%22%3A%2288%22%7D%2C%7B%22x%22%3A351.30887%2C%22y%22%3A199.7939%2C%22width%22%3A9.654729999999972%2C%22height%22%3A9.654729999999972%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A391.98108%2C%22y%22%3A199.7552%2C%22width%22%3A9.34505999999999%2C%22height%22%3A9.34505999999999%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A664.00006%2C%22y%22%3A199.92293%2C%22width%22%3A8.538940000000025%2C%22height%22%3A8.538940000000025%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A521.30054%2C%22y%22%3A200.20416%2C%22width%22%3A14.496260000000007%2C%22height%22%3A10.29119%2C%22text%22%3A%2269%22%7D%2C%7B%22x%22%3A167.22389%2C%22y%22%3A200.25774%2C%22width%22%3A41.23742999999999%2C%22height%22%3A11.629660000000001%2C%22text%22%3A%2249360%22%7D%2C%7B%22x%22%3A591.4965%2C%22y%22%3A200.1581%2C%22width%22%3A9.198750000000018%2C%22height%22%3A9.198750000000018%2C%22text%22%3A%226%22%7D%2C%7B%22x%22%3A632.9551%2C%22y%22%3A201.07849%2C%22width%22%3A12.260400000000004%2C%22height%22%3A8.971730000000008%2C%22text%22%3A%2289%22%7D%2C%7B%22x%22%3A591.6408%2C%22y%22%3A216.28993%2C%22width%22%3A9.977899999999977%2C%22height%22%3A9.977899999999977%2C%22text%22%3A%229%22%7D%2C%7B%22x%22%3A663.17645%2C%22y%22%3A216.58801%2C%22width%22%3A9.707649999999944%2C%22height%22%3A9.707649999999944%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A350.92087%2C%22y%22%3A216.64838%2C%22width%22%3A9.712310000000002%2C%22height%22%3A9.712310000000002%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A391.3334%2C%22y%22%3A216.54207%2C%22width%22%3A10.667820000000006%2C%22height%22%3A10.667820000000006%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A227.78609%2C%22y%22%3A216.68092%2C%22width%22%3A91.32862999999998%2C%22height%22%3A12.859100000000012%2C%22text%22%3A%2250824247652%22%7D%2C%7B%22x%22%3A614.79114%2C%22y%22%3A216.6841%2C%22width%22%3A33.311759999999936%2C%22height%22%3A12.37858%2C%22text%22%3A%22388%22%7D%2C%7B%22x%22%3A553.6136%2C%22y%22%3A217.24011%2C%22width%22%3A22.24630000000002%2C%22height%22%3A11.427080000000018%2C%22text%22%3A%22145%22%7D%2C%7B%22x%22%3A166.57469%2C%22y%22%3A217.24428%2C%22width%22%3A41.64813000000001%2C%22height%22%3A11.619959999999992%2C%22text%22%3A%2249360%22%7D%2C%7B%22x%22%3A520.9681%2C%22y%22%3A217.55376%2C%22width%22%3A14.217939999999999%2C%22height%22%3A10.671779999999984%2C%22text%22%3A%2291%22%7D%2C%7B%22x%22%3A391.54272%2C%22y%22%3A233.24498%2C%22width%22%3A9.611820000000023%2C%22height%22%3A9.611820000000023%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A663.0659%2C%22y%22%3A233.15979%2C%22width%22%3A9.811359999999922%2C%22height%22%3A9.811359999999922%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A86.18331%2C%22y%22%3A233.2826%2C%22width%22%3A10.976439999999997%2C%22height%22%3A10.976439999999997%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A62.866577%2C%22y%22%3A233.24983%2C%22width%22%3A9.835906999999999%2C%22height%22%3A9.835906999999999%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A614.9066%2C%22y%22%3A233.48564%2C%22width%22%3A32.5213%2C%22height%22%3A11.800490000000025%2C%22text%22%3A%222.89%22%7D%2C%7B%22x%22%3A167.94781%2C%22y%22%3A233.83752%2C%22width%22%3A40.093999999999994%2C%22height%22%3A11.058309999999977%2C%22text%22%3A%2249360%22%7D%2C%7B%22x%22%3A521.74506%2C%22y%22%3A233.84062%2C%22width%22%3A13.56529999999998%2C%22height%22%3A11.188259999999985%2C%22text%22%3A%2257%22%7D%2C%7B%22x%22%3A559.80145%2C%22y%22%3A234.0266%2C%22width%22%3A16.676349999999957%2C%22height%22%3A11.749779999999987%2C%22text%22%3A%2262%22%7D%2C%7B%22x%22%3A351.04898%2C%22y%22%3A233.99675%2C%22width%22%3A10.28436000000005%2C%22height%22%3A10.28436000000005%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A143.99998%2C%22y%22%3A234.26593%2C%22width%22%3A8.548590000000019%2C%22height%22%3A8.548590000000019%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A224.56242%2C%22y%22%3A233.9062%2C%22width%22%3A95.17244000000002%2C%22height%22%3A11.990699999999975%2C%22text%22%3A%2250824247660%22%7D%2C%7B%22x%22%3A615.27264%2C%22y%22%3A249.48064%2C%22width%22%3A9.471959999999967%2C%22height%22%3A9.471959999999967%2C%22text%22%3A%223%22%7D%2C%7B%22x%22%3A62.66666%2C%22y%22%3A249.72627%2C%22width%22%3A9.783549999999998%2C%22height%22%3A9.783549999999998%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A86.393105%2C%22y%22%3A249.98822%2C%22width%22%3A11.099795%2C%22height%22%3A11.099795%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A591.6327%2C%22y%22%3A250.00465%2C%22width%22%3A10.117669999999976%2C%22height%22%3A10.117669999999976%2C%22text%22%3A%228%22%7D%2C%7B%22x%22%3A663.66376%2C%22y%22%3A250.18768%2C%22width%22%3A8.64233999999999%2C%22height%22%3A8.64233999999999%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A632.54956%2C%22y%22%3A250.52913%2C%22width%22%3A14.705870000000004%2C%22height%22%3A11.656419999999969%2C%22text%22%3A%2289%22%7D%2C%7B%22x%22%3A553.42926%2C%22y%22%3A251.2002%2C%22width%22%3A22.131439999999998%2C%22height%22%3A11.699200000000019%2C%22text%22%3A%22155%22%7D%2C%7B%22x%22%3A144.06093%2C%22y%22%3A251.20699%2C%22width%22%3A8.066999999999979%2C%22height%22%3A8.066999999999979%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A167.84029%2C%22y%22%3A251.24565%2C%22width%22%3A40.48282999999998%2C%22height%22%3A11.291799999999967%2C%22text%22%3A%2249360%22%7D%2C%7B%22x%22%3A518.90247%2C%22y%22%3A251.61751%2C%22width%22%3A18.639580000000024%2C%22height%22%3A10.643189999999976%2C%22text%22%3A%2289%22%7D%2C%7B%22x%22%3A351.63058%2C%22y%22%3A251.83313%2C%22width%22%3A8.902019999999993%2C%22height%22%3A8.902019999999993%2C%22text%22%3A%22%E6%97%A5%22%7D%2C%7B%22x%22%3A224.16512%2C%22y%22%3A252.17163%2C%22width%22%3A95.25855999999999%2C%22height%22%3A10.650030000000015%2C%22text%22%3A%2250824247660%22%7D%2C%7B%22x%22%3A85.48345%2C%22y%22%3A265.95172%2C%22width%22%3A11.305949999999996%2C%22height%22%3A11.305949999999996%2C%22text%22%3A%220%22%7D%2C%7B%22x%22%3A630.2053%2C%22y%22%3A267.2435%2C%22width%22%3A17.87997000000007%2C%22height%22%3A12.758820000000014%2C%22text%22%3A%2291%22%7D%2C%7B%22x%22%3A591.4489%2C%22y%22%3A267.67953%2C%22width%22%3A10.019599999999969%2C%22height%22%3A10.019599999999969%2C%22text%22%3A%228%22%7D%2C%7B%22x%22%3A224.3338%2C%22y%22%3A267.8501%2C%22width%22%3A94.63968%2C%22height%22%3A12.037840000000017%2C%22text%22%3A%2250824247660%22%7D%2C%7B%22x%22%3A558.6432%2C%22y%22%3A267.796%2C%22width%22%3A17.601999999999975%2C%22height%22%3A12.300700000000006%2C%22text%22%3A%2266%22%7D%2C%7B%22x%22%3A167.86385%2C%22y%22%3A267.88824%2C%22width%22%3A39.33284999999998%2C%22height%22%3A11.886140000000012%2C%22text%22%3A%2249360%22%7D%2C%7B%22x%22%3A509.6606%2C%22y%22%3A267.34387%2C%22width%22%3A30.63536000000005%2C%22height%22%3A13.322760000000017%2C%22text%22%3A%2255%22%7D%2C%7B%22x%22%3A18.29937%2C%22y%22%3A298.46524%2C%22width%22%3A222.89097999999998%2C%22height%22%3A16.29361%2C%22text%22%3A%22%E5%BD%93%E5%89%8D%E6%97%A5%E5%B0%8A%E5%BE%851%2F0%E4%B8%A4%E9%98%BB%E5%A1%9E%E6%89%A7%E8%A1%8C%E7%9A%84%E8%BF%90%E5%B7%B7%22%7D%2C%7B%22x%22%3A474.25708%2C%22y%22%3A304.09885%2C%22width%22%3A148.35352%2C%22height%22%3A15.751829999999984%2C%22text%22%3A%22P%E5%AE%8C%E5%85%A8%E7%A9%BA%E9%97%B2%E6%97%B6%E9%97%B4%E6%AF%94%E5%88%9B%22%7D%2C%7B%22x%22%3A505.15625%2C%22y%22%3A328.85165%2C%22width%22%3A240.81304999999998%2C%22height%22%3A16.73924999999997%2C%22text%22%3A%22%E6%89%80%E6%9C%89%E7%9A%84%E5%B0%B1%E7%8C%9C%E8%BF%9B%E7%A5%A5%E7%AA%97%E4%B8%BA%E5%AF%BB%E5%BE%851%2F0%E5%92%8C%E9%98%BB%E5%A1%9E%22%7D%2C%7B%22x%22%3A276.3363%2C%22y%22%3A338.08243%2C%22width%22%3A193.73478%2C%22height%22%3A16.81537000000003%2C%22text%22%3A%22%E6%9D%A5%E7%BB%9F%E5%86%85%E6%A0%A1%E5%92%8C%E4%B8%AD%E6%8A%98%E7%9A%84C%E9%A3%8E%E4%BD%BF%E7%94%A8%E7%8E%87%22%7D%2C%7B%22x%22%3A547.3725%2C%22y%22%3A351.68344%2C%22width%22%3A160.5548%2C%22height%22%3A16.74151999999998%2C%22text%22%3A%22%E8%87%B4C%E7%A9%BA%E9%97%B2%E7%9A%84%E6%97%B6%E9%97%B4%E8%B4%B4%E4%BE%8B%22%7D%5D%2C%22style%22%3A%22none%22%2C%22search%22%3A%22%E7%94%A8%E6%88%B7%E8%BF%9B%E5%B7%B7%E7%9A%84%E5%8D%B0%E9%A3%8E%E4%BD%BF%E7%94%A8%E7%8E%87%20%E5%BD%93%E5%89%8D%E6%AD%A3%E8%95%8A%E5%A4%84%E7%90%86%E7%9A%84%E4%B8%AD%E6%8A%98%E7%9A%84%E6%95%B0%20%E5%BD%93%E5%89%8D%E8%BF%90%E8%A1%8C%E9%98%9F%E5%88%B0%E4%B8%AD%E5%B7%B2%E5%B0%B1%E7%BB%A9%E4%BD%86%E8%BF%98%E6%9C%A8%E6%89%A7%E8%A1%8C%E7%9A%84%E8%BF%90%E5%B7%B7%20%E5%BD%93%E5%89%8D%E5%8F%91%E7%94%9F%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E5%9C%BA%E6%8D%A2%E6%95%B0%20i0%20system-%20memory%3A%20swap%20procs%20cpu%20buff%20bi%20free%20d%20bo%20cache%20wa%20SO%20swpd%2035%209%2050816247660%20111%2049524%20%E6%97%A5%200%20127%200%2049392%200%2071%2058%2050816247660%200%200%20152%2049360%200%200%2089%20%E6%97%A5%20%E6%97%A5%2050816247660%200%200%200%20%E6%97%A5%2049360%20%E6%97%A5%2050816247660%2058%20%E6%97%A5%209%20%E6%97%A5%200%20%E6%97%A5%200%2050816%2049360%20247660%20152%200%2050824247652%2088%20%E6%97%A5%200%20%E6%97%A5%2069%2049360%206%2089%209%20%E6%97%A5%20%E6%97%A5%200%2050824247652%20388%20145%2049360%2091%200%200%200%200%202.89%2049360%2057%2062%20%E6%97%A5%200%2050824247660%203%200%20%E6%97%A5%208%20%E6%97%A5%2089%20155%200%2049360%2089%20%E6%97%A5%2050824247660%200%2091%208%2050824247660%2066%2049360%2055%20%E5%BD%93%E5%89%8D%E6%97%A5%E5%B0%8A%E5%BE%851%2F0%E4%B8%A4%E9%98%BB%E5%A1%9E%E6%89%A7%E8%A1%8C%E7%9A%84%E8%BF%90%E5%B7%B7%20P%E5%AE%8C%E5%85%A8%E7%A9%BA%E9%97%B2%E6%97%B6%E9%97%B4%E6%AF%94%E5%88%9B%20%E6%89%80%E6%9C%89%E7%9A%84%E5%B0%B1%E7%8C%9C%E8%BF%9B%E7%A5%A5%E7%AA%97%E4%B8%BA%E5%AF%BB%E5%BE%851%2F0%E5%92%8C%E9%98%BB%E5%A1%9E%20%E6%9D%A5%E7%BB%9F%E5%86%85%E6%A0%A1%E5%92%8C%E4%B8%AD%E6%8A%98%E7%9A%84C%E9%A3%8E%E4%BD%BF%E7%94%A8%E7%8E%87%20%E8%87%B4C%E7%A9%BA%E9%97%B2%E7%9A%84%E6%97%B6%E9%97%B4%E8%B4%B4%E4%BE%8B%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22width%22%3A752%2C%22height%22%3A373%7D"><a href="https://huster.top/wp-content/uploads/2021/02/5.png"><img class="alignnone size-full wp-image-756" src="https://huster.top/wp-content/uploads/2021/02/5.png" alt="" width="746" height="370" /></a></span></p>
<p data-lake-id="b3dd857ecaab3e23ce6666fb71f59f94">于是，我们把线程数改小了一半，通过压测发现cpu没有任何改善，如果是这个问题，问题不说完全解决，至少应该会下降一个量级，但是没有任何改变，就说明了不是这个问题。</p>
<h3 id="MjoVc" data-lake-id="f1c8508675ea506cb0d2ace2438a877c">日志打印导致？ log4j的版本问题</h3>
<p data-lake-id="3e56df79a094e9981e8b92c1e7d206f6"><a href="https://blog.csdn.net/qq_17231297/article/details/106621820" target="_blank" rel="noopener">https://blog.csdn.net/qq_17231297/article/details/106621820</a></p>
<p data-lake-id="3bc55d0ffe77f1c541dbad44e7425f54">无意中看到上面这篇文章，再结合Arthas打印出来的代码栈，怀疑是不是打印日志导致的，结果把所有的info日志关闭之后，再压测，问题依旧没有任何改变，说明也不是这个问题。</p>
<h2 id="Qaf2U" data-lake-id="a1ccea664921c4010d18c423bc9a6591">其他排查手段</h2>
<p data-lake-id="f129db9bfc1953808e17364f80410a5d">常规的排查手段都失效了，只能通过排除法来一行一行的定位问题代码了。通过注释掉怀疑的代码，反复的压测，来定位问题代码具体位于哪一行。如果最后定位到了的那行代码是正常的代码，跟旧代码没有任何差异，那肯定就是你的计算次数变多了导致。</p>
<h2 id="TgAg6" data-lake-id="3047784e34d34eafcafabd24eecdd849">问题定位</h2>
<p data-lake-id="a55dd18736b43b8efcbb789cb18f64c0">一直一直都是怀疑代码有问题导致的计算规模变大了，经过旁边同学仔细的查看代码的确如此。我们常常犯的一个错误就是循环的时候变量搞混，下面这行代码循环的时候，传进来的却还是原来的大数组，而不是拆解之后的小数组。</p>
<p data-lake-id="9c4bd2af11f9bbabb68370e1c392f39e"><span class="lake-card-margin-top lake-card-margin-bottom lake-selected" data-card-type="inline" data-lake-card="image" data-card-value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F180554%2F1613722187509-97e67961-9ee7-4903-a274-5ad0c3c87840.png%22%2C%22originWidth%22%3A1676%2C%22originHeight%22%3A360%2C%22name%22%3A%22image.png%22%2C%22size%22%3A462538%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A15.015238%2C%22y%22%3A0.27732763%2C%22width%22%3A950.970362%2C%22height%22%3A22.846329370000003%2C%22text%22%3A%22LtLLt0V%22%7D%2C%7B%22x%22%3A26.162443%2C%22y%22%3A27.80857%2C%22width%22%3A954.7793569999999%2C%22height%22%3A21.624930000000003%2C%22text%22%3A%22LISCMtBFUtU%22%7D%2C%7B%22x%22%3A15.966569%2C%22y%22%3A55.003048%2C%22width%22%3A192.915781%2C%22height%22%3A19.563092000000005%2C%22text%22%3A%22batchlistforEacl%22%7D%2C%7B%22x%22%3A191.89241%2C%22y%22%3A56.043045%2C%22width%22%3A92.37314999999998%2C%22height%22%3A19.315041%2C%22text%22%3A%22n(detait%22%7D%2C%7B%22x%22%3A57.986538%2C%22y%22%3A83.49088%2C%22width%22%3A641.940862%2C%22height%22%3A23.29662599999999%2C%22text%22%3A%22COMpLetAbleFutureListrivRnKResuttDetaiLDo%3Efuture%22%7D%2C%7B%22x%22%3A68.0875%2C%22y%22%3A106.93561%2C%22width%22%3A471.2545%2C%22height%22%3A22.85432%2C%22text%22%3A%22IF(ObjectsnonNu(nkFunctonForPMML))%22%7D%2C%7B%22x%22%3A104.161804%2C%22y%22%3A133.41505%2C%22width%22%3A434.887456%2C%22height%22%3A28.408829999999995%2C%22text%22%3A%22futureCompLetabLeFuture.supplyasync(%22%7D%2C%7B%22x%22%3A1142.2391%2C%22y%22%3A157.51974%2C%22width%22%3A524.1924999999999%2C%22height%22%3A29.046959999999984%2C%22text%22%3A%22ModeLMapsFEATUREGROUPIDNKFucTIONFORPMML%22%7D%2C%7B%22x%22%3A193.82437%2C%22y%22%3A161.68307%2C%22width%22%3A542.4693299999999%2C%22height%22%3A24.050340000000006%2C%22text%22%3A%22RANkModeLUTiLs.BATcHRANKForPMML(driverRANkA%22%7D%2C%7B%22x%22%3A797.66425%2C%22y%22%3A163.05714%2C%22width%22%3A188.90692%2C%22height%22%3A19.71663000000001%2C%22text%22%3A%22driverRankdDetails%22%7D%2C%7B%22x%22%3A1000.879%2C%22y%22%3A163.8747%2C%22width%22%3A154.97899999999993%2C%22height%22%3A20.153250000000014%2C%22text%22%3A%22moceUINPMML%2Cm%22%7D%2C%7B%22x%22%3A191.62552%2C%22y%22%3A190.21996%2C%22width%22%3A233.29886%2C%22height%22%3A21.384500000000003%2C%22text%22%3A%22createTaskThreadPoou)%22%7D%2C%7B%22x%22%3A196.28767%2C%22y%22%3A216.93419%2C%22width%22%3A359.82238%2C%22height%22%3A23.438439999999986%2C%22text%22%3A%22whenComplete((result%2Cexception)%22%7D%2C%7B%22x%22%3A617.30554%2C%22y%22%3A243.16455%2C%22width%22%3A63.840560000000096%2C%22height%22%3A20.74244999999999%2C%22text%22%3A%22nuiy)%22%7D%2C%7B%22x%22%3A233.49036%2C%22y%22%3A244.1266%2C%22width%22%3A357.61594%2C%22height%22%3A20.348860000000002%2C%22text%22%3A%22iF(ResultlanullEsexception%22%7D%2C%7B%22x%22%3A507.65115%2C%22y%22%3A266.15875%2C%22width%22%3A467.44575000000003%2C%22height%22%3A27.08829000000003%2C%22text%22%3A%22resuitMap%3Aput(rgetPassengerorderIdO)%2C%22%7D%2C%7B%22x%22%3A281.6201%2C%22y%22%3A271.91632%2C%22width%22%3A175.44650000000001%2C%22height%22%3A17.538999999999987%2C%22text%22%3A%22result.forEach(%22%7D%2C%7B%22x%22%3A190.7173%2C%22y%22%3A322.24368%2C%22width%22%3A32.73242000000002%2C%22height%22%3A23.023320000000012%2C%22text%22%3A%22%E4%B8%BA)%22%7D%5D%2C%22style%22%3A%22none%22%2C%22search%22%3A%22LtLLt0V%20LISCMtBFUtU%20batchlistforEacl%20n(detait%20COMpLetAbleFutureListrivRnKResuttDetaiLDo%3Efuture%20IF(ObjectsnonNu(nkFunctonForPMML))%20futureCompLetabLeFuture.supplyasync(%20ModeLMapsFEATUREGROUPIDNKFucTIONFORPMML%20RANkModeLUTiLs.BATcHRANKForPMML(driverRANkA%20driverRankdDetails%20moceUINPMML%2Cm%20createTaskThreadPoou)%20whenComplete((result%2Cexception)%20nuiy)%20iF(ResultlanullEsexception%20resuitMap%3Aput(rgetPassengerorderIdO)%2C%20result.forEach(%20%E4%B8%BA)%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22width%22%3A1676%2C%22height%22%3A360%7D"><a href="https://huster.top/wp-content/uploads/2021/02/6.png"><img class="alignnone size-full wp-image-757" src="https://huster.top/wp-content/uploads/2021/02/6.png" alt="" width="746" height="160" /></a></span></p>
<h1 id="do1uD" data-lake-id="53c9c8d124d9233effd2690d76c2700c">总结</h1>
<p data-lake-id="ba29b26b11c35a24de158ae61b5bf629">问题排查是自身技术提升最快的方法，要好好珍惜公司给你提供的免费练手机会，尤其很多故障都是有资损的，相当于公司出钱给你练手了。</p>
<p data-lake-id="cf1c46d271d54a8da6d21ccb3d7af2e2">通过这次的问题复盘，你可以掌握以下知识点，我觉得最重要的不是你解决了问题，而是你从中学到了什么</p>
<p data-lake-id="63936a883ffae54e3adabf4ef66ae7c6"><span class="lake-card-margin-top lake-card-margin-bottom lake-selected" data-card-type="inline" data-lake-card="image" data-card-value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F180554%2F1613723384808-bb1dba21-8843-4c62-a053-fe892c652888.png%22%2C%22originWidth%22%3A846%2C%22originHeight%22%3A756%2C%22name%22%3A%22image.png%22%2C%22size%22%3A135923%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A468.45963%2C%22y%22%3A14.004666%2C%22width%22%3A93.71827000000002%2C%22height%22%3A12.128642%2C%22text%22%3A%22jstack%E7%9A%84%E6%8E%92%E6%9F%A5%E6%89%8B%E6%AE%B5%22%7D%2C%7B%22x%22%3A261.51996%2C%22y%22%3A40.082096%2C%22width%22%3A156.00698999999997%2C%22height%22%3A16.955194%2C%22text%22%3A%22cpu%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%89%8B%E6%AE%B5%22%7D%2C%7B%22x%22%3A468.57608%2C%22y%22%3A43.25766%2C%22width%22%3A108.94301999999999%2C%22height%22%3A13.260174%2C%22text%22%3A%22Arthas%E7%9A%84%E4%BA%86%E8%A7%A3%E5%92%8C%E4%BD%BF%E7%94%A8%22%7D%2C%7B%22x%22%3A616.301%2C%22y%22%3A43.95824%2C%22width%22%3A87.10479999999995%2C%22height%22%3A14.018577999999998%2C%22text%22%3A%22java%E7%9A%84%E6%89%80%E6%9C%89%E9%97%AE%E9%A2%98%22%7D%2C%7B%22x%22%3A360.4553%2C%22y%22%3A107.32488%2C%22width%22%3A186.49309999999997%2C%22height%22%3A13.726214000000013%2C%22text%22%3A%22hashmap%E5%9C%A8%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%87%8C%E7%9A%84%E9%97%AE%E9%A2%98%E5%92%8C%E5%8E%9F%E5%9B%A0%22%7D%2C%7B%22x%22%3A515.8294%2C%22y%22%3A138.45601%2C%22width%22%3A29.08985000000007%2C%22height%22%3A11.188400000000001%2C%22text%22%3A%22NEW%22%7D%2C%7B%22x%22%3A618.6553%2C%22y%22%3A171.77223%2C%22width%22%3A33.79482999999993%2C%22height%22%3A11.12609999999998%2C%22text%22%3A%22ready%22%7D%2C%7B%22x%22%3A515.57733%2C%22y%22%3A186.20287%2C%22width%22%3A64.27737000000002%2C%22height%22%3A10.801389999999998%2C%22text%22%3A%22RUNNABLE%22%7D%2C%7B%22x%22%3A618.56354%2C%22y%22%3A203.34258%2C%22width%22%3A46.01486%2C%22height%22%3A12.058130000000006%2C%22text%22%3A%22running%22%7D%2C%7B%22x%22%3A609.39343%2C%22y%22%3A233.22638%2C%22width%22%3A154.26673000000005%2C%22height%22%3A13.714889999999997%2C%22text%22%3A%22%E9%80%9A%E5%B8%B8cpu%E4%B8%8A%E4%B8%8D%E5%8E%BB%E9%83%BD%E6%98%AF%E8%A2%AB%E9%98%BB%E5%A1%9E%E4%BA%86%22%7D%2C%7B%22x%22%3A360.962%2C%22y%22%3A233.23805%2C%22width%22%3A117.12848000000002%2C%22height%22%3A13.143770000000018%2C%22text%22%3A%22%E7%BA%BF%E7%A8%8B%E7%9A%846%E7%A7%8D%E7%8A%B6%E6%80%81%E5%92%8C%E8%BD%AC%E6%8D%A2%22%7D%2C%7B%22x%22%3A515.9182%2C%22y%22%3A234.04936%2C%22width%22%3A54.39179999999999%2C%22height%22%3A11.494589999999988%2C%22text%22%3A%22BLOCKED%22%7D%2C%7B%22x%22%3A515.21075%2C%22y%22%3A266.10135%2C%22width%22%3A51.85590000000002%2C%22height%22%3A12.396849999999972%2C%22text%22%3A%22WAITING%22%7D%2C%7B%22x%22%3A516.4665%2C%22y%22%3A297.77478%2C%22width%22%3A93.73850000000004%2C%22height%22%3A12.932619999999986%2C%22text%22%3A%22TIMEDWAITING%22%7D%2C%7B%22x%22%3A516.3526%2C%22y%22%3A329.95926%2C%22width%22%3A74.62694999999997%2C%22height%22%3A12.039060000000006%2C%22text%22%3A%22TERMINATED%22%7D%2C%7B%22x%22%3A109.638054%2C%22y%22%3A358.0488%2C%22width%22%3A54.32958599999999%2C%22height%22%3A23.248929999999973%2C%22text%22%3A%22Java%22%7D%2C%7B%22x%22%3A361.0801%2C%22y%22%3A358.368%2C%22width%22%3A150.95619999999997%2C%22height%22%3A14.909100000000024%2C%22text%22%3A%22%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B%3F%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88%22%7D%2C%7B%22x%22%3A262.28564%2C%22y%22%3A370.22147%2C%22width%22%3A47.24032999999997%2C%22height%22%3A15.612789999999961%2C%22text%22%3A%22%E5%A4%9A%E7%BA%BF%E7%A8%8B%22%7D%2C%7B%22x%22%3A556.00995%2C%22y%22%3A390.6381%2C%22width%22%3A34.41975000000002%2C%22height%22%3A12.242270000000019%2C%22text%22%3A%22notiry%22%7D%2C%7B%22x%22%3A556.53424%2C%22y%22%3A422.6753%2C%22width%22%3A52.942319999999995%2C%22height%22%3A11.816250000000025%2C%22text%22%3A%22notyfiall%22%7D%2C%7B%22x%22%3A360.92947%2C%22y%22%3A436.92798%2C%22width%22%3A157.09413%2C%22height%22%3A13.65634%2C%22text%22%3A%22%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD%E5%92%8C%E7%BA%BF%E7%A8%8B%E9%97%B4%E7%9A%84%E5%90%8C%E6%AD%A5%E6%89%8B%E6%AE%B5%22%7D%2C%7B%22x%22%3A556.2875%2C%22y%22%3A454.6591%2C%22width%22%3A23.87173999999993%2C%22height%22%3A12.207599999999957%2C%22text%22%3A%22join%22%7D%2C%7B%22x%22%3A556.61646%2C%22y%22%3A486.91577%2C%22width%22%3A32.08037999999999%2C%22height%22%3A12.46866%2C%22text%22%3A%22sleep%22%7D%2C%7B%22x%22%3A436.34763%2C%22y%22%3A515.41034%2C%22width%22%3A80.66967%2C%22height%22%3A13.334259999999972%2C%22text%22%3A%22%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E4%BD%9C%E7%94%A8%3F%22%7D%2C%7B%22x%22%3A436.67667%2C%22y%22%3A547.0414%2C%22width%22%3A86.19216999999998%2C%22height%22%3A14.096100000000092%2C%22text%22%3A%22%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%88%9B%E5%BB%BA%E6%96%B9%E6%B3%95%22%7D%2C%7B%22x%22%3A361.48544%2C%22y%22%3A547.7698%2C%22width%22%3A36.27286000000004%2C%22height%22%3A12.929399999999987%2C%22text%22%3A%22%E7%BA%BF%E7%A8%8B%E6%B1%A0%22%7D%2C%7B%22x%22%3A436.34055%2C%22y%22%3A578.5862%2C%22width%22%3A62.32851999999997%2C%22height%22%3A14.33976000000007%2C%22text%22%3A%22%E7%BB%99%E7%BA%BF%E7%A8%8B%E5%8F%96%E5%90%8D%22%7D%2C%7B%22x%22%3A361.81494%2C%22y%22%3A610.6679%2C%22width%22%3A94.21996000000001%2C%22height%22%3A12.526200000000017%2C%22text%22%3A%22%E5%85%B6%E4%BB%96%E7%9F%A5%E8%AF%86%E7%82%B9...%E5%BE%88%E5%A4%9A%22%7D%2C%7B%22x%22%3A396.48508%2C%22y%22%3A667.39014%2C%22width%22%3A73.81242000000003%2C%22height%22%3A14.246030000000019%2C%22text%22%3A%22%E6%AF%8F%E4%B8%80%E5%88%97%E7%9A%84%E5%90%AB%E4%B9%89%22%7D%2C%7B%22x%22%3A260.31436%2C%22y%22%3A677.7949%2C%22width%22%3A84.56426999999996%2C%22height%22%3A19.331750000000056%2C%22text%22%3A%22vmstat%E5%91%BD%E4%BB%A4%22%7D%5D%2C%22style%22%3A%22none%22%2C%22search%22%3A%22jstack%E7%9A%84%E6%8E%92%E6%9F%A5%E6%89%8B%E6%AE%B5%20cpu%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%89%8B%E6%AE%B5%20Arthas%E7%9A%84%E4%BA%86%E8%A7%A3%E5%92%8C%E4%BD%BF%E7%94%A8%20java%E7%9A%84%E6%89%80%E6%9C%89%E9%97%AE%E9%A2%98%20hashmap%E5%9C%A8%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%87%8C%E7%9A%84%E9%97%AE%E9%A2%98%E5%92%8C%E5%8E%9F%E5%9B%A0%20NEW%20ready%20RUNNABLE%20running%20%E9%80%9A%E5%B8%B8cpu%E4%B8%8A%E4%B8%8D%E5%8E%BB%E9%83%BD%E6%98%AF%E8%A2%AB%E9%98%BB%E5%A1%9E%E4%BA%86%20%E7%BA%BF%E7%A8%8B%E7%9A%846%E7%A7%8D%E7%8A%B6%E6%80%81%E5%92%8C%E8%BD%AC%E6%8D%A2%20BLOCKED%20WAITING%20TIMEDWAITING%20TERMINATED%20Java%20%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B%3F%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%20notiry%20notyfiall%20%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD%E5%92%8C%E7%BA%BF%E7%A8%8B%E9%97%B4%E7%9A%84%E5%90%8C%E6%AD%A5%E6%89%8B%E6%AE%B5%20join%20sleep%20%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E4%BD%9C%E7%94%A8%3F%20%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%88%9B%E5%BB%BA%E6%96%B9%E6%B3%95%20%E7%BA%BF%E7%A8%8B%E6%B1%A0%20%E7%BB%99%E7%BA%BF%E7%A8%8B%E5%8F%96%E5%90%8D%20%E5%85%B6%E4%BB%96%E7%9F%A5%E8%AF%86%E7%82%B9...%E5%BE%88%E5%A4%9A%20%E6%AF%8F%E4%B8%80%E5%88%97%E7%9A%84%E5%90%AB%E4%B9%89%20vmstat%E5%91%BD%E4%BB%A4%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22width%22%3A846%2C%22height%22%3A756%7D"><a href="https://huster.top/wp-content/uploads/2021/02/8.png"><img class="alignnone size-full wp-image-758" src="https://huster.top/wp-content/uploads/2021/02/8.png" alt="" width="746" height="667" /></a></span></p>
]]></content:encoded>
			<wfw:commentRss>https://huster.top/htmls/748.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>又一起GC问题排查过程</title>
		<link>https://huster.top/htmls/745.html</link>
		<comments>https://huster.top/htmls/745.html#respond</comments>
		<pubDate>Tue, 08 Sep 2020 11:57:51 +0000</pubDate>
		<dc:creator><![CDATA[龙安_任天兵]]></dc:creator>
				<category><![CDATA[Java学习]]></category>

		<guid isPermaLink="false">https://huster.top/?p=745</guid>
		<description><![CDATA[背景 继上次找到redis导致的gc问题之后，又有一个应用发生了gc时间长的问题。每次gc的大概1s的停顿时间 &#8230; <a href="https://huster.top/htmls/745.html" class="more-link">继续阅读<span class="screen-reader-text">“又一起GC问题排查过程”</span></a>]]></description>
				<content:encoded><![CDATA[<h2 id="ggbT8" data-lake-id="9f3c08a1f9fb9f3501aad6053e1c2122">背景</h2>
<p data-lake-id="f03a859e570b282b5d3e38ddf074e5b5">继上次找到redis导致的gc问题之后，又有一个应用发生了gc时间长的问题。每次gc的大概1s的停顿时间，导致这1s的请求全部超时，经常被业务方投诉。因为G1有更好的并行度，更短和确定的并行时间，因此负责的开发将应用从CMS升级到G1，然而问题依然没有解决. 这是一个网关类型的应用，负责接受rpc的调用，将请求转发到后端的http请求，将封装好的数据，转发给业务使用。所以实际上是</p>
<p data-lake-id="a00cddf79ea31d40896e0b20ef03866d">Application----&gt;rpc--&gt;GateWay(问题应用)-----http client ---&gt; 其他服务.</p>
<p data-lake-id="a00cddf79ea31d40896e0b20ef03866d">
<p data-lake-id="a00cddf79ea31d40896e0b20ef03866d">
<p data-lake-id="a00cddf79ea31d40896e0b20ef03866d"><span id="more-745"></span></p>
<h2 id="mICr2" data-lake-id="f39930be57bdf13856e2cc9487ab82c8">分析</h2>
<p data-lake-id="09b9b6fb2cc34f916d9a631b03774fc3">解决GC问题的思路，还是先要了解下你这个gc的特性和阶段，然后结合gc日志排查到底是哪里有问题。是频繁的youngGC还是oldGC，针对具体的问题，再配合jmap工具dump内存的heap下来分析。找到内存泄露或者是代码或者是配置不合理的地方。</p>
<h2 id="n4qX3" data-lake-id="e3133626794e7d711d1092283b766225">尝试的方法</h2>
<ol start="1" data-lake-id="263e944e080eb29a93d0c2e1aa75b2f4">
<li data-lake-id="e635180d7c5df27a2693f30178b666cf">首先是将CMS改为G1, 并且设定预期的时间为200ms，然而并没有解决问题</li>
</ol>
<div id="VQjnO" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22shell%22%2C%22code%22%3A%22Garbage_collector%3D%5C%22G1%5C%22%5CnGC_OPTS%3D%5C%22%24GC_OPTS%20-XX%3A%2BUseG1GC%20%5C%5C%5Cn-XX%3AMaxGCPauseMillis%3D200%20%5C%5C%5Cn-XX%3A%2BParallelRefProcEnabled%20-XX%3AParallelGCThreads%3D4%20-XX%3AConcGCThreads%3D4%20%5C%5C%5Cn-XX%3A%2BHeapDumpOnOutOfMemoryError%20%5C%5C%5Cn-XX%3A%2BPrintClassHistogramBeforeFullGC%20%5C%5C%5Cn-XX%3A%2BPrintClassHistogramAfterFullGC%20%20%5C%5C%5Cn-XX%3A%2BPrintGCApplicationConcurrentTime%20%20%5C%5C%5Cn-XX%3A%2BPrintGCApplicationStoppedTime%20%5C%5C%5Cn-XX%3A%2BPrintTenuringDistribution%20%5C%5C%5Cn-XX%3A%2BPrintReferenceGC%20%5C%5C%5Cn-XX%3A%2BPrintHeapAtGC%5C%22%22%2C%22heightLimit%22%3Atrue%2C%22margin%22%3Atrue%2C%22id%22%3A%22VQjnO%22%7D" data-language="shell">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-def">Garbage_collector</span><span class="cm-operator">=</span><span class="cm-string">"G1"</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-def">GC_OPTS</span><span class="cm-operator">=</span><span class="cm-string">"</span><span class="cm-def">$GC_OPTS</span><span class="cm-string"> -XX:+UseG1GC \</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-string">-XX:MaxGCPauseMillis=200 \</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-string">-XX:+ParallelRefProcEnabled -XX:ParallelGCThreads=4 -XX:ConcGCThreads=4 \</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-string">-XX:+HeapDumpOnOutOfMemoryError \</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-string">-XX:+PrintClassHistogramBeforeFullGC \</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-string">-XX:+PrintClassHistogramAfterFullGC  \</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-string">-XX:+PrintGCApplicationConcurrentTime  \</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-string">-XX:+PrintGCApplicationStoppedTime \</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-string">-XX:+PrintTenuringDistribution \</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-string">-XX:+PrintReferenceGC \</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-string">-XX:+PrintHeapAtGC"</span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="ccd857f387da6271e301f15a02ef787b">过2~3天，又会因为gc问题发生一波超时.</p>
<h2 id="yr0YE" data-lake-id="229a5ed9e620956bcc04875b8e828edd">G1日志分析</h2>
<h3 id="JfoAw" data-lake-id="18fd851195b09dad5e57fa88a6dd6884">G1了解</h3>
<p data-lake-id="31fadf830484526c4e7a4ba818e8eb92">要看懂g1日志，首先得知道这个G1的原理。总结无非这几点, G1使用的是Region作为内存单元来存储数据(大小可以设置)，然后他模糊了youngGC区和old区的概念，这个只作为一个逻辑分区。因此在他yonggc发生的时候，可以顺带的回收old区的内容，而不用像cms一样，等到一个百分比的时候，再触发一次oldgc，来一个全区的扫描，那个当然就费时间了</p>
<p data-lake-id="e0c9872bc981c4be4e937ab7cd234790">另外，就是他的核心RSet的设计，记录了跨区的引用，以此来防止全区的一个扫描。</p>
<p data-lake-id="01026feeddbc240578640b2a5c360a8e">G1的gc分为以下几个阶段:</p>
<h4 id="55be9bff" data-lake-id="0c0348102e9ddca690d983a2a9b46821">YoungGC阶段</h4>
<p data-lake-id="3bc2df7d01e1d054a2dbaf400fe1056e">触发时机 : 当Eden空间被占满之后，就会触发YGC,在G1中YGC依然采用复制存活对象到survivor空间的方式。他虽然是stop wold的，但是他是并发执行的，日志类似于这样：</p>
<p data-lake-id="c405f6142066414d75a2a162cbff513b">youngGC不需要扫描老年代，因为他通过RSet就知道哪些年轻代的对象是被老年代引用的.</p>
<div id="Vnq5M" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22shell%22%2C%22code%22%3A%222020-07-28T18%3A29%3A37.235%2B0800%3A%2078143.812%3A%20%5BSoftReference%2C%200%20refs%2C%200.0005405%20secs%5D2020-07-28T18%3A29%3A37.236%2B0800%3A%2078143.813%3A%20%5BWeakReference%2C%20650%20refs%2C%200.0004000%20secs%5D2020-07-28T18%3A29%3A37.236%2B0800%3A%2078143.813%3A%20%5BFinalReference%2C%2056137%20refs%2C%200.0136734%20secs%5D2020-07-28T18%3A29%3A37.250%2B0800%3A%2078143.827%3A%20%5BPhantomReference%2C%200%20refs%2C%2010%20refs%2C%200.0006262%20secs%5D2020-07-28T18%3A29%3A37.251%2B0800%3A%2078143.828%3A%20%5BJNI%20Weak%20Reference%2C%200.0000456%20secs%5D%2C%200.0872782%20secs%5D%5Cn%20%20%20%5BParallel%20Time%3A%2061.9%20ms%2C%20GC%20Workers%3A%204%5D%5Cn%20%20%20%20%20%20%5BGC%20Worker%20Start%20(ms)%3A%20Min%3A%2078143750.0%2C%20Avg%3A%2078143750.0%2C%20Max%3A%2078143750.0%2C%20Diff%3A%200.1%5D%5Cn%20%20%20%20%20%20%5BExt%20Root%20Scanning%20(ms)%3A%20Min%3A%2010.0%2C%20Avg%3A%2010.2%2C%20Max%3A%2010.3%2C%20Diff%3A%200.3%2C%20Sum%3A%2040.9%5D%5Cn%20%20%20%20%20%20%5BUpdate%20RS%20(ms)%3A%20Min%3A%2021.1%2C%20Avg%3A%2021.2%2C%20Max%3A%2021.2%2C%20Diff%3A%200.1%2C%20Sum%3A%2084.8%5D%5Cn%20%20%20%20%20%20%20%20%20%5BProcessed%20Buffers%3A%20Min%3A%20451%2C%20Avg%3A%20484.8%2C%20Max%3A%20516%2C%20Diff%3A%2065%2C%20Sum%3A%201939%5D%5Cn%20%20%20%20%20%20%5BScan%20RS%20(ms)%3A%20Min%3A%205.9%2C%20Avg%3A%206.0%2C%20Max%3A%206.0%2C%20Diff%3A%200.1%2C%20Sum%3A%2023.8%5D%5Cn%20%20%20%20%20%20%5BCode%20Root%20Scanning%20(ms)%3A%20Min%3A%200.0%2C%20Avg%3A%200.0%2C%20Max%3A%200.0%2C%20Diff%3A%200.0%2C%20Sum%3A%200.1%5D%5Cn%20%20%20%20%20%20%5BObject%20Copy%20(ms)%3A%20Min%3A%2024.0%2C%20Avg%3A%2024.2%2C%20Max%3A%2024.4%2C%20Diff%3A%200.4%2C%20Sum%3A%2096.9%5D%5Cn%20%20%20%20%20%20%5BTermination%20(ms)%3A%20Min%3A%200.0%2C%20Avg%3A%200.0%2C%20Max%3A%200.0%2C%20Diff%3A%200.0%2C%20Sum%3A%200.0%5D%5Cn%20%20%20%20%20%20%20%20%20%5BTermination%20Attempts%3A%20Min%3A%201%2C%20Avg%3A%208.8%2C%20Max%3A%2017%2C%20Diff%3A%2016%2C%20Sum%3A%2035%5D%5Cn%20%20%20%20%20%20%5BGC%20Worker%20Other%20(ms)%3A%20Min%3A%200.0%2C%20Avg%3A%200.1%2C%20Max%3A%200.1%2C%20Diff%3A%200.1%2C%20Sum%3A%200.3%5D%5Cn%20%20%20%20%20%20%5BGC%20Worker%20Total%20(ms)%3A%20Min%3A%2061.6%2C%20Avg%3A%2061.7%2C%20Max%3A%2061.7%2C%20Diff%3A%200.1%2C%20Sum%3A%20246.8%5D%5Cn%20%20%20%20%20%20%5BGC%20Worker%20End%20(ms)%3A%20Min%3A%2078143811.7%2C%20Avg%3A%2078143811.7%2C%20Max%3A%2078143811.8%2C%20Diff%3A%200.1%5D%5Cn%20%20%20%5BCode%20Root%20Fixup%3A%200.2%20ms%5D%5Cn%20%20%20%5BCode%20Root%20Purge%3A%200.0%20ms%5D%5Cn%20%20%20%5BClear%20CT%3A%201.8%20ms%5D%5Cn%20%20%20%5BOther%3A%2023.4%20ms%5D%5Cn%20%20%20%20%20%20%5BChoose%20CSet%3A%200.0%20ms%5D%5Cn%20%20%20%20%20%20%5BRef%20Proc%3A%2015.6%20ms%5D%5Cn%20%20%20%20%20%20%5BRef%20Enq%3A%200.4%20ms%5D%5Cn%20%20%20%20%20%20%5BRedirty%20Cards%3A%200.5%20ms%5D%5Cn%20%20%20%20%20%20%5BHumongous%20Register%3A%200.1%20ms%5D%5Cn%20%20%20%20%20%20%5BHumongous%20Reclaim%3A%200.0%20ms%5D%5Cn%20%20%20%20%20%20%5BFree%20CSet%3A%202.7%20ms%5D%5Cn%20%20%20%5BEden%3A%206084.0M(6084.0M)-%3E0.0B(6080.0M)%20Survivors%3A%2060.0M-%3E64.0M%20Heap%3A%208179.6M(10.0G)-%3E2102.0M(10.0G)%5D%5CnHeap%20after%20GC%20invocations%3D1261%20(full%200)%3A%5Cn%20garbage-first%20heap%20%20%20total%2010485760K%2C%20used%202152475K%20%5B0x0000000540000000%2C%200x0000000540405000%2C%200x00000007c0000000)%5Cn%20%20region%20size%204096K%2C%2016%20young%20(65536K)%2C%2016%20survivors%20(65536K)%5Cn%20Metaspace%20%20%20%20%20%20%20used%2082266K%2C%20capacity%2085616K%2C%20committed%2085760K%2C%20reserved%201124352K%5Cn%20%20class%20space%20%20%20%20used%209546K%2C%20capacity%2010192K%2C%20committed%2010240K%2C%20reserved%201048576K%5Cn%7D%5Cn%20%5BTimes%3A%20user%3D0.30%20sys%3D0.00%2C%20real%3D0.08%20secs%5D%20%22%2C%22heightLimit%22%3Atrue%2C%22margin%22%3Atrue%2C%22id%22%3A%22Vnq5M%22%7D" data-language="shell">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:37.235<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78143</span>.812: [SoftReference, <span class="cm-number">0</span> refs, <span class="cm-number">0</span>.0005405 secs]2020-07-28T18:29:37.236<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78143</span>.813: [WeakReference, <span class="cm-number">650</span> refs, <span class="cm-number">0</span>.0004000 secs]2020-07-28T18:29:37.236<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78143</span>.813: [FinalReference, <span class="cm-number">56137</span> refs, <span class="cm-number">0</span>.0136734 secs]2020-07-28T18:29:37.250<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78143</span>.827: [PhantomReference, <span class="cm-number">0</span> refs, <span class="cm-number">10</span> refs, <span class="cm-number">0</span>.0006262 secs]2020-07-28T18:29:37.251<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78143</span>.828: [JNI Weak Reference, <span class="cm-number">0</span>.0000456 secs], <span class="cm-number">0</span>.0872782 secs]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">   [Parallel Time: <span class="cm-number">61</span>.9 ms, GC Workers: <span class="cm-number">4</span>]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [GC Worker Start (ms): Min: <span class="cm-number">78143750</span>.0, Avg: <span class="cm-number">78143750</span>.0, Max: <span class="cm-number">78143750</span>.0, Diff: <span class="cm-number">0</span>.1]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Ext Root Scanning (ms): Min: <span class="cm-number">10</span>.0, Avg: <span class="cm-number">10</span>.2, Max: <span class="cm-number">10</span>.3, Diff: <span class="cm-number">0</span>.3, Sum: <span class="cm-number">40</span>.9]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Update RS (ms): Min: <span class="cm-number">21</span>.1, Avg: <span class="cm-number">21</span>.2, Max: <span class="cm-number">21</span>.2, Diff: <span class="cm-number">0</span>.1, Sum: <span class="cm-number">84</span>.8]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">         [Processed Buffers: Min: <span class="cm-number">451</span>, Avg: <span class="cm-number">484</span>.8, Max: <span class="cm-number">516</span>, Diff: <span class="cm-number">65</span>, Sum: <span class="cm-number">1939</span>]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Scan RS (ms): Min: <span class="cm-number">5</span>.9, Avg: <span class="cm-number">6</span>.0, Max: <span class="cm-number">6</span>.0, Diff: <span class="cm-number">0</span>.1, Sum: <span class="cm-number">23</span>.8]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Code Root Scanning (ms): Min: <span class="cm-number">0</span>.0, Avg: <span class="cm-number">0</span>.0, Max: <span class="cm-number">0</span>.0, Diff: <span class="cm-number">0</span>.0, Sum: <span class="cm-number">0</span>.1]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Object Copy (ms): Min: <span class="cm-number">24</span>.0, Avg: <span class="cm-number">24</span>.2, Max: <span class="cm-number">24</span>.4, Diff: <span class="cm-number">0</span>.4, Sum: <span class="cm-number">96</span>.9]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Termination (ms): Min: <span class="cm-number">0</span>.0, Avg: <span class="cm-number">0</span>.0, Max: <span class="cm-number">0</span>.0, Diff: <span class="cm-number">0</span>.0, Sum: <span class="cm-number">0</span>.0]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">         [Termination Attempts: Min: <span class="cm-number">1</span>, Avg: <span class="cm-number">8</span>.8, Max: <span class="cm-number">17</span>, Diff: <span class="cm-number">16</span>, Sum: <span class="cm-number">35</span>]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [GC Worker Other (ms): Min: <span class="cm-number">0</span>.0, Avg: <span class="cm-number">0</span>.1, Max: <span class="cm-number">0</span>.1, Diff: <span class="cm-number">0</span>.1, Sum: <span class="cm-number">0</span>.3]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [GC Worker Total (ms): Min: <span class="cm-number">61</span>.6, Avg: <span class="cm-number">61</span>.7, Max: <span class="cm-number">61</span>.7, Diff: <span class="cm-number">0</span>.1, Sum: <span class="cm-number">246</span>.8]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [GC Worker End (ms): Min: <span class="cm-number">78143811</span>.7, Avg: <span class="cm-number">78143811</span>.7, Max: <span class="cm-number">78143811</span>.8, Diff: <span class="cm-number">0</span>.1]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">   [Code Root Fixup: <span class="cm-number">0</span>.2 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">   [Code Root Purge: <span class="cm-number">0</span>.0 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">   [Clear CT: <span class="cm-number">1</span>.8 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">   [Other: <span class="cm-number">23</span>.4 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Choose CSet: <span class="cm-number">0</span>.0 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Ref Proc: <span class="cm-number">15</span>.6 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Ref Enq: <span class="cm-number">0</span>.4 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Redirty Cards: <span class="cm-number">0</span>.5 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Humongous Register: <span class="cm-number">0</span>.1 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Humongous Reclaim: <span class="cm-number">0</span>.0 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Free CSet: <span class="cm-number">2</span>.7 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">   [Eden: <span class="cm-number">6084</span>.0M(6084.0M)-&gt;0.0B(6080.0M) Survivors: <span class="cm-number">60</span>.0M-&gt;64.0M Heap: <span class="cm-number">8179</span>.6M(10.0G)-&gt;2102.0M(10.0G)]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">Heap after GC <span class="cm-def">invocations</span><span class="cm-operator">=</span><span class="cm-number">1261</span> (full <span class="cm-number">0</span>):
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"> garbage-first heap   total 10485760K, used 2152475K [0x0000000540000000, 0x0000000540405000, 0x00000007c0000000)
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">  region size 4096K, <span class="cm-number">16</span> young (65536K), <span class="cm-number">16</span> survivors (65536K)
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"> Metaspace       used 82266K, capacity 85616K, committed 85760K, reserved 1124352K
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">  class space    used 9546K, capacity 10192K, committed 10240K, reserved 1048576K
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">}
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"> [Times: <span class="cm-def">user</span><span class="cm-operator">=</span><span class="cm-number">0</span>.30 <span class="cm-def">sys</span><span class="cm-operator">=</span><span class="cm-number">0</span>.00, <span class="cm-def">real</span><span class="cm-operator">=</span><span class="cm-number">0</span>.08 secs] </span></span></pre>
</div>
</div>
</div>
<p data-lake-id="ed17263922f1a2b65579acbc3af8cbdf">然后我们可以看到这个并发交替的过程如下，他是一会执行用户程序，一会执行gc任务，清楚的看到他的交替过程:</p>
<div id="MAb9X" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22shell%22%2C%22code%22%3A%222020-07-28T18%3A29%3A37.259%2B0800%3A%2078143.836%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0960241%20seconds%2C%20Stopping%20threads%20took%3A%200.0009531%20seconds%5Cn2020-07-28T18%3A29%3A39.182%2B0800%3A%2078145.759%3A%20Application%20time%3A%201.9228829%20seconds%5Cn2020-07-28T18%3A29%3A39.190%2B0800%3A%2078145.767%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0079957%20seconds%2C%20Stopping%20threads%20took%3A%200.0009701%20seconds%5Cn2020-07-28T18%3A29%3A39.190%2B0800%3A%2078145.767%3A%20Application%20time%3A%200.0002209%20seconds%5Cn2020-07-28T18%3A29%3A39.195%2B0800%3A%2078145.772%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0047948%20seconds%2C%20Stopping%20threads%20took%3A%200.0003450%20seconds%5Cn2020-07-28T18%3A29%3A39.195%2B0800%3A%2078145.772%3A%20Application%20time%3A%200.0003185%20seconds%5Cn2020-07-28T18%3A29%3A39.199%2B0800%3A%2078145.776%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0038102%20seconds%2C%20Stopping%20threads%20took%3A%200.0002901%20seconds%5Cn2020-07-28T18%3A29%3A39.200%2B0800%3A%2078145.776%3A%20Application%20time%3A%200.0004269%20seconds%5Cn2020-07-28T18%3A29%3A39.203%2B0800%3A%2078145.780%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0036949%20seconds%2C%20Stopping%20threads%20took%3A%200.0003017%20seconds%5Cn2020-07-28T18%3A29%3A39.204%2B0800%3A%2078145.780%3A%20Application%20time%3A%200.0003345%20seconds%5Cn2020-07-28T18%3A29%3A39.207%2B0800%3A%2078145.784%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0037270%20seconds%2C%20Stopping%20threads%20took%3A%200.0002750%20seconds%5Cn2020-07-28T18%3A29%3A39.208%2B0800%3A%2078145.784%3A%20Application%20time%3A%200.0002432%20seconds%5Cn2020-07-28T18%3A29%3A39.211%2B0800%3A%2078145.788%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0034454%20seconds%2C%20Stopping%20threads%20took%3A%200.0002974%20seconds%5Cn2020-07-28T18%3A29%3A39.211%2B0800%3A%2078145.788%3A%20Application%20time%3A%200.0002809%20seconds%5Cn2020-07-28T18%3A29%3A39.215%2B0800%3A%2078145.792%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0034799%20seconds%2C%20Stopping%20threads%20took%3A%200.0003126%20seconds%5Cn2020-07-28T18%3A29%3A39.215%2B0800%3A%2078145.792%3A%20Application%20time%3A%200.0001971%20seconds%5Cn2020-07-28T18%3A29%3A39.218%2B0800%3A%2078145.795%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0033639%20seconds%2C%20Stopping%20threads%20took%3A%200.0002907%20seconds%5Cn2020-07-28T18%3A29%3A39.219%2B0800%3A%2078145.795%3A%20Application%20time%3A%200.0002002%20seconds%5Cn2020-07-28T18%3A29%3A39.222%2B0800%3A%2078145.799%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0034734%20seconds%2C%20Stopping%20threads%20took%3A%200.0002560%20seconds%5Cn2020-07-28T18%3A29%3A39.223%2B0800%3A%2078145.799%3A%20Application%20time%3A%200.0004148%20seconds%5Cn2020-07-28T18%3A29%3A39.230%2B0800%3A%2078145.807%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0078923%20seconds%2C%20Stopping%20threads%20took%3A%200.0007479%20seconds%5Cn2020-07-28T18%3A29%3A39.231%2B0800%3A%2078145.807%3A%20Application%20time%3A%200.0002697%20seconds%5Cn2020-07-28T18%3A29%3A39.239%2B0800%3A%2078145.816%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0080425%20seconds%2C%20Stopping%20threads%20took%3A%200.0005797%20seconds%5Cn2020-07-28T18%3A29%3A39.239%2B0800%3A%2078145.816%3A%20Application%20time%3A%200.0004746%20seconds%5Cn2020-07-28T18%3A29%3A39.247%2B0800%3A%2078145.824%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0081480%20seconds%2C%20Stopping%20threads%20took%3A%200.0005586%20seconds%5Cn2020-07-28T18%3A29%3A39.248%2B0800%3A%2078145.824%3A%20Application%20time%3A%200.0002206%20seconds%5Cn2020-07-28T18%3A29%3A39.255%2B0800%3A%2078145.832%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0077953%20seconds%2C%20Stopping%20threads%20took%3A%200.0003357%20seconds%5Cn2020-07-28T18%3A29%3A39.256%2B0800%3A%2078145.833%3A%20Application%20time%3A%200.0004123%20seconds%5Cn2020-07-28T18%3A29%3A39.263%2B0800%3A%2078145.840%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0075859%20seconds%2C%20Stopping%20threads%20took%3A%200.0004447%20seconds%5Cn2020-07-28T18%3A29%3A39.264%2B0800%3A%2078145.840%3A%20Application%20time%3A%200.0001576%20seconds%5Cn2020-07-28T18%3A29%3A39.271%2B0800%3A%2078145.847%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0070406%20seconds%2C%20Stopping%20threads%20took%3A%200.0003025%20seconds%5Cn2020-07-28T18%3A29%3A39.271%2B0800%3A%2078145.848%3A%20Application%20time%3A%200.0003462%20seconds%5Cn2020-07-28T18%3A29%3A39.278%2B0800%3A%2078145.855%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0071142%20seconds%2C%20Stopping%20threads%20took%3A%200.0004311%20seconds%5Cn2020-07-28T18%3A29%3A39.278%2B0800%3A%2078145.855%3A%20Application%20time%3A%200.0001479%20seconds%5Cn2020-07-28T18%3A29%3A39.285%2B0800%3A%2078145.862%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0071285%20seconds%2C%20Stopping%20threads%20took%3A%200.0003712%20seconds%5Cn2020-07-28T18%3A29%3A39.287%2B0800%3A%2078145.864%3A%20Application%20time%3A%200.0018179%20seconds%5Cn2020-07-28T18%3A29%3A39.295%2B0800%3A%2078145.872%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0075329%20seconds%2C%20Stopping%20threads%20took%3A%200.0005250%20seconds%5Cn2020-07-28T18%3A29%3A39.296%2B0800%3A%2078145.872%3A%20Application%20time%3A%200.0008192%20seconds%5Cn2020-07-28T18%3A29%3A39.303%2B0800%3A%2078145.880%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0072368%20seconds%2C%20Stopping%20threads%20took%3A%200.0002966%20seconds%5Cn2020-07-28T18%3A29%3A39.303%2B0800%3A%2078145.880%3A%20Application%20time%3A%200.0006276%20seconds%5Cn2020-07-28T18%3A29%3A39.324%2B0800%3A%2078145.901%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0202434%20seconds%2C%20Stopping%20threads%20took%3A%200.0002417%20seconds%5Cn2020-07-28T18%3A30%3A04.065%2B0800%3A%2078170.642%3A%20Application%20time%3A%2024.7410815%20seconds%5Cn2020-07-28T18%3A30%3A04.073%2B0800%3A%2078170.650%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0082734%20seconds%2C%20Stopping%20threads%20took%3A%200.0009748%20seconds%5Cn2020-07-28T18%3A30%3A14.002%2B0800%3A%2078180.578%3A%20Application%20time%3A%209.9284404%20seconds%22%2C%22heightLimit%22%3Atrue%2C%22margin%22%3Atrue%2C%22id%22%3A%22MAb9X%22%7D" data-language="shell">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:37.259<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78143</span>.836: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0960241 seconds, Stopping threads took: <span class="cm-number">0</span>.0009531 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.182<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.759: Application time: <span class="cm-number">1</span>.9228829 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.190<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.767: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0079957 seconds, Stopping threads took: <span class="cm-number">0</span>.0009701 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.190<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.767: Application time: <span class="cm-number">0</span>.0002209 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.195<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.772: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0047948 seconds, Stopping threads took: <span class="cm-number">0</span>.0003450 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.195<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.772: Application time: <span class="cm-number">0</span>.0003185 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.199<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.776: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0038102 seconds, Stopping threads took: <span class="cm-number">0</span>.0002901 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.200<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.776: Application time: <span class="cm-number">0</span>.0004269 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.203<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.780: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0036949 seconds, Stopping threads took: <span class="cm-number">0</span>.0003017 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.204<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.780: Application time: <span class="cm-number">0</span>.0003345 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.207<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.784: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0037270 seconds, Stopping threads took: <span class="cm-number">0</span>.0002750 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.208<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.784: Application time: <span class="cm-number">0</span>.0002432 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.211<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.788: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0034454 seconds, Stopping threads took: <span class="cm-number">0</span>.0002974 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.211<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.788: Application time: <span class="cm-number">0</span>.0002809 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.215<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.792: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0034799 seconds, Stopping threads took: <span class="cm-number">0</span>.0003126 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.215<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.792: Application time: <span class="cm-number">0</span>.0001971 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.218<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.795: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0033639 seconds, Stopping threads took: <span class="cm-number">0</span>.0002907 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.219<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.795: Application time: <span class="cm-number">0</span>.0002002 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.222<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.799: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0034734 seconds, Stopping threads took: <span class="cm-number">0</span>.0002560 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.223<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.799: Application time: <span class="cm-number">0</span>.0004148 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.230<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.807: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0078923 seconds, Stopping threads took: <span class="cm-number">0</span>.0007479 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.231<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.807: Application time: <span class="cm-number">0</span>.0002697 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.239<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.816: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0080425 seconds, Stopping threads took: <span class="cm-number">0</span>.0005797 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.239<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.816: Application time: <span class="cm-number">0</span>.0004746 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.247<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.824: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0081480 seconds, Stopping threads took: <span class="cm-number">0</span>.0005586 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.248<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.824: Application time: <span class="cm-number">0</span>.0002206 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.255<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.832: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0077953 seconds, Stopping threads took: <span class="cm-number">0</span>.0003357 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.256<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.833: Application time: <span class="cm-number">0</span>.0004123 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.263<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.840: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0075859 seconds, Stopping threads took: <span class="cm-number">0</span>.0004447 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.264<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.840: Application time: <span class="cm-number">0</span>.0001576 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.271<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.847: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0070406 seconds, Stopping threads took: <span class="cm-number">0</span>.0003025 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.271<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.848: Application time: <span class="cm-number">0</span>.0003462 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.278<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.855: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0071142 seconds, Stopping threads took: <span class="cm-number">0</span>.0004311 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.278<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.855: Application time: <span class="cm-number">0</span>.0001479 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.285<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.862: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0071285 seconds, Stopping threads took: <span class="cm-number">0</span>.0003712 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.287<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.864: Application time: <span class="cm-number">0</span>.0018179 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.295<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.872: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0075329 seconds, Stopping threads took: <span class="cm-number">0</span>.0005250 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.296<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.872: Application time: <span class="cm-number">0</span>.0008192 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.303<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.880: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0072368 seconds, Stopping threads took: <span class="cm-number">0</span>.0002966 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.303<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.880: Application time: <span class="cm-number">0</span>.0006276 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:29:39.324<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78145</span>.901: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0202434 seconds, Stopping threads took: <span class="cm-number">0</span>.0002417 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:04.065<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78170</span>.642: Application time: <span class="cm-number">24</span>.7410815 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:04.073<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78170</span>.650: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0082734 seconds, Stopping threads took: <span class="cm-number">0</span>.0009748 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:14.002<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78180</span>.578: Application time: <span class="cm-number">9</span>.9284404 seconds</span></span></pre>
</div>
</div>
</div>
<h4 id="yFv5d" data-lake-id="a7122d8d63e4cbd9e3441d4b01963e1f">MIXGC混合GC阶段</h4>
<p data-lake-id="3bb7e2e512755dd1631dda9667a66995">G1中的MIXGC选定所有新生代里的Region，外加根据global concurrent marking统计得出收集收益高的若干老年代Region，在用户指定的开销目标范围内尽可能选择收益高的老年代Region进行回收。所以MIXGC回收的内存区域是新生代+老年代</p>
<h4 id="ymvMf" data-lake-id="8624c1293c13bbe78bc1c05750a95007">FullGC</h4>
<p data-lake-id="06be1af386281321031577d50e4c42d0">G1一般不会发生FullGC，如果发生了，基本上就是有灾难了.</p>
<p data-lake-id="f720229fe302ae296b1013186887f94a"><a href="https://zhuanlan.zhihu.com/p/52841787" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/52841787</a></p>
<h3 id="RSo39" data-lake-id="66c7ba5c0bf76b88efb1e763d6bb7441">G1日志分析</h3>
<p data-lake-id="61ee6ee6fafd528107b991284246c54d">引用: g1日志格式分析 ：<a href="https://segmentfault.com/a/1190000018885417" target="_blank" rel="noopener">https://segmentfault.com/a/1190000018885417</a></p>
<p data-lake-id="014603d9e0a61e3760977f6446d3a8d4"><a href="https://matt33.com/2018/07/28/jvm-cms/" target="_blank" rel="noopener">https://matt33.com/2018/07/28/jvm-cms/</a></p>
<p data-lake-id="d17d0cd8f3296aa6125e97b8dd0ddc00">我们通过jvm的参数，打开gc日志详情,我们可以看到，出问题的时间点的日志如下:</p>
<div id="7CCPt" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22shell%22%2C%22code%22%3A%222020-07-28T18%3A30%3A14.107%2B0800%3A%2078180.684%3A%20%5BGC%20concurrent-root-region-scan-start%5D%5Cn2020-07-28T18%3A30%3A14.108%2B0800%3A%2078180.685%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.1065961%20seconds%2C%20Stopping%20threads%20took%3A%200.0010147%20seconds%5Cn2020-07-28T18%3A30%3A14.223%2B0800%3A%2078180.800%3A%20%5BGC%20concurrent-root-region-scan-end%2C%200.1157296%20secs%5D%5Cn2020-07-28T18%3A30%3A14.223%2B0800%3A%2078180.800%3A%20%5BGC%20concurrent-mark-start%5D%5Cn2020-07-28T18%3A30%3A15.297%2B0800%3A%2078181.873%3A%20%5BGC%20concurrent-mark-end%2C%201.0732893%20secs%5D%5Cn2020-07-28T18%3A30%3A15.297%2B0800%3A%2078181.873%3A%20Application%20time%3A%201.1884735%20seconds%5Cn2020-07-28T18%3A30%3A15.304%2B0800%3A%2078181.881%3A%20%5BGC%20remark%202020-07-28T18%3A30%3A15.304%2B0800%3A%2078181.881%3A%20%5BFinalize%20Marking%2C%200.0042761%20secs%5D%202020-07-28T18%3A30%3A15.309%2B0800%3A%2078181.885%3A%20%5BGC%20ref-proc2020-07-28T18%3A30%3A15.309%2B0800%3A%2078181.885%3A%20%5BSoftReference%2C%20434351%20refs%2C%200.0672266%20secs%5D2020-07-28T18%3A30%3A15.376%2B0800%3A%2078181.953%3A%20%5BWeakReference%2C%20376%20refs%2C%200.0004634%20secs%5D2020-07-28T18%3A30%3A15.376%2B0800%3A%2078181.953%3A%20%5BFinalReference%2C%20435363%20refs%2C%200.3004894%20secs%5D2020-07-28T18%3A30%3A15.677%2B0800%3A%2078182.254%3A%20%5BPhantomReference%2C%200%20refs%2C%20331%20refs%2C%200.0009668%20secs%5D2020-07-28T18%3A30%3A15.678%2B0800%3A%2078182.255%3A%20%5BJNI%20Weak%20Reference%2C%200.0002237%20secs%5D%2C%200.4895046%20secs%5D%202020-07-28T18%3A30%3A15.798%2B0800%3A%2078182.375%3A%20%5BUnloading%2C%200.0347793%20secs%5D%2C%200.5384580%20secs%5D%5Cn%20%5BTimes%3A%20user%3D1.65%20sys%3D0.24%2C%20real%3D0.54%20secs%5D%22%2C%22heightLimit%22%3Atrue%2C%22margin%22%3Atrue%2C%22id%22%3A%227CCPt%22%2C%22height%22%3A230%7D" data-language="shell">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:14.107<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78180</span>.684: [GC concurrent-root-region-scan-start]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:14.108<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78180</span>.685: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.1065961 seconds, Stopping threads took: <span class="cm-number">0</span>.0010147 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:14.223<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78180</span>.800: [GC concurrent-root-region-scan-end, <span class="cm-number">0</span>.1157296 secs]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:14.223<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78180</span>.800: [GC concurrent-mark-start]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:15.297<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78181</span>.873: [GC concurrent-mark-end, <span class="cm-number">1</span>.0732893 secs]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:15.297<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78181</span>.873: Application time: <span class="cm-number">1</span>.1884735 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:15.304<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78181</span>.881: [GC remark <span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:15.304<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78181</span>.881: [Finalize Marking, <span class="cm-number">0</span>.0042761 secs] <span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:15.309<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78181</span>.885: [GC ref-proc2020-07-28T18:30:15.309<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78181</span>.885: [SoftReference, <span class="cm-number">434351</span> refs, <span class="cm-number">0</span>.0672266 secs]2020-07-28T18:30:15.376<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78181</span>.953: [WeakReference, <span class="cm-number">376</span> refs, <span class="cm-number">0</span>.0004634 secs]2020-07-28T18:30:15.376<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78181</span>.953: [FinalReference, <span class="cm-number">435363</span> refs, <span class="cm-number">0</span>.3004894 secs]2020-07-28T18:30:15.677<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78182</span>.254: [PhantomReference, <span class="cm-number">0</span> refs, <span class="cm-number">331</span> refs, <span class="cm-number">0</span>.0009668 secs]2020-07-28T18:30:15.678<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78182</span>.255: [JNI Weak Reference, <span class="cm-number">0</span>.0002237 secs], <span class="cm-number">0</span>.4895046 secs] <span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:15.798<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78182</span>.375: [Unloading, <span class="cm-number">0</span>.0347793 secs], <span class="cm-number">0</span>.5384580 secs]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"> [Times: <span class="cm-def">user</span><span class="cm-operator">=</span><span class="cm-number">1</span>.65 <span class="cm-def">sys</span><span class="cm-operator">=</span><span class="cm-number">0</span>.24, <span class="cm-def">real</span><span class="cm-operator">=</span><span class="cm-number">0</span>.54 secs]</span></span></pre>
</div>
</div>
</div>
<p data-lake-id="e6b4747013c989366490dcbcff4549b2">我们看到GC ref-proc这个阶段耗时很长，这个是个stop the world的过程，再看看 FinalReference居然有40多万，平时是6万多(也不少)</p>
<p data-lake-id="fc3e553b94b2d4b8012db4c118e6dbe2">再来学习下这个并发标记是什么意思.</p>
<h4 id="ab01eebf" data-lake-id="cf32c95e8e0a647ebca41bd9190ad1d3">认识全局并发标记</h4>
<p data-lake-id="942d75b9fb466931476ce6d0ff184e06">全局并发标记过程分为五个阶段</p>
<p data-lake-id="6cd3ca540e34760ffd620b0735d6f8c7">(1) Initial Mark初始标记 STW</p>
<p data-lake-id="7951e7b90d468bf7d35d38f6e02f4372">Initial Mark初始标记是一个STW事件，其完成工作是标记GC ROOTS 直接可达的对象。并将它们的字段压入扫描栈（marking stack）中等到后续扫描。G1使用外部的bitmap来记录mark信息，而不使用对象头的mark word里的mark bit。因为 STW，所以通常YGC的时候借用YGC的STW顺便启动Initial Mark，也就是启动全局并发标记，全局并发标记与YGC在逻辑上独立。</p>
<p data-lake-id="55b2bd1448449b57ca62ad9c55af065b">(2)Root Region Scanning 根区域扫描</p>
<p data-lake-id="4428c8dc679bb57a2ed2a5f78757c07a">根区域扫描是从Survior区的对象出发，标记被引用到老年代中的对象，并把它们的字段在压入扫描栈（marking stack）中等到后续扫描。与Initial Mark不一样的是，Root Region Scanning不需要STW与应用程序是并发运行。Root Region Scanning必须在YGC开始前完成。</p>
<p data-lake-id="4649162dd632e9b388c5f7f511524ace">(3)Concurrent Marking 并发标记</p>
<p data-lake-id="1f48202c4059eb7c7c8046821f618e16">不需要STW。不断从扫描栈取出引用递归扫描整个堆里的对象。每扫描到一个对象就会对其标记，并将其字段压入扫描栈。重复扫描过程直到扫描栈清空。过程中还会扫描SATB write barrier所记录下的引用。Concurrent Marking 可以被YGC中断</p>
<p data-lake-id="950c410d3f7afe2684461a3f6c268332">就是日志这里的内容:</p>
<div id="HE47y" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22shell%22%2C%22code%22%3A%222020-07-28T18%3A30%3A14.107%2B0800%3A%2078180.684%3A%20%5BGC%20concurrent-root-region-scan-start%5D%5Cn2020-07-28T18%3A30%3A14.108%2B0800%3A%2078180.685%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.1065961%20seconds%2C%20Stopping%20threads%20took%3A%200.0010147%20seconds%5Cn2020-07-28T18%3A30%3A14.223%2B0800%3A%2078180.800%3A%20%5BGC%20concurrent-root-region-scan-end%2C%200.1157296%20secs%5D%5Cn2020-07-28T18%3A30%3A14.223%2B0800%3A%2078180.800%3A%20%5BGC%20concurrent-mark-start%5D%5Cn2020-07-28T18%3A30%3A15.297%2B0800%3A%2078181.873%3A%20%5BGC%20concurrent-mark-end%2C%201.0732893%20secs%5D%22%2C%22heightLimit%22%3Atrue%2C%22margin%22%3Atrue%2C%22id%22%3A%22HE47y%22%7D" data-language="shell">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:14.107<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78180</span>.684: [GC concurrent-root-region-scan-start]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:14.108<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78180</span>.685: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.1065961 seconds, Stopping threads took: <span class="cm-number">0</span>.0010147 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:14.223<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78180</span>.800: [GC concurrent-root-region-scan-end, <span class="cm-number">0</span>.1157296 secs]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:14.223<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78180</span>.800: [GC concurrent-mark-start]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:15.297<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78181</span>.873: [GC concurrent-mark-end, <span class="cm-number">1</span>.0732893 secs]</span></span></pre>
</div>
</div>
</div>
<p data-lake-id="6ca4618527b765da705dc98e9b8b72d2">(4)Remark 最终标记 STW</p>
<p data-lake-id="7c79f903d97c1f76f1bd488dbeaad587">STW操作。在完成并发标记后，每个Java线程还会有一些剩下的SATB write barrier记录的引用尚未处理。这个阶段就负责把剩下的引用处理完。同时这个阶段也进行弱引用处理（reference processing）。注意这个暂停与CMS的remark有一个本质上的区别，那就是这个暂停只需要扫描SATB buffer，而CMS的remark需要重新扫描mod-union table里的dirty card外加整个根集合，而此时整个young gen（不管对象死活）都会被当作根集合的一部分，因而CMS remark有可能会非常慢。</p>
<p data-lake-id="606be955cc69b2fb6eb3451214417e2b">就是出问题的地方</p>
<div id="8hSO9" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22shell%22%2C%22code%22%3A%222020-07-28T18%3A30%3A15.304%2B0800%3A%2078181.881%3A%20%5BGC%20remark%202020-07-28T18%3A30%3A15.304%2B0800%3A%2078181.881%3A%20%5BFinalize%20Marking%2C%200.0042761%20secs%5D%202020-07-28T18%3A30%3A15.309%2B0800%3A%2078181.885%3A%20%5BGC%20ref-proc2020-07-28T18%3A30%3A15.309%2B0800%3A%2078181.885%3A%20%5BSoftReference%2C%20434351%20refs%2C%200.0672266%20secs%5D2020-07-28T18%3A30%3A15.376%2B0800%3A%2078181.953%3A%20%5BWeakReference%2C%20376%20refs%2C%200.0004634%20secs%5D2020-07-28T18%3A30%3A15.376%2B0800%3A%2078181.953%3A%20%5BFinalReference%2C%20435363%20refs%2C%200.3004894%20secs%5D2020-07-28T18%3A30%3A15.677%2B0800%3A%2078182.254%3A%20%5BPhantomReference%2C%200%20refs%2C%20331%20refs%2C%200.0009668%20secs%5D2020-07-28T18%3A30%3A15.678%2B0800%3A%2078182.255%3A%20%5BJNI%20Weak%20Reference%2C%200.0002237%20secs%5D%2C%200.4895046%20secs%5D%202020-07-28T18%3A30%3A15.798%2B0800%3A%2078182.375%3A%20%5BUnloading%2C%200.0347793%20secs%5D%2C%200.5384580%20secs%5D%22%2C%22heightLimit%22%3Atrue%2C%22margin%22%3Atrue%2C%22id%22%3A%228hSO9%22%7D" data-language="shell">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:15.304<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78181</span>.881: [GC remark <span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:15.304<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78181</span>.881: [Finalize Marking, <span class="cm-number">0</span>.0042761 secs] <span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:15.309<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78181</span>.885: [GC ref-proc2020-07-28T18:30:15.309<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78181</span>.885: [SoftReference, <span class="cm-number">434351</span> refs, <span class="cm-number">0</span>.0672266 secs]2020-07-28T18:30:15.376<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78181</span>.953: [WeakReference, <span class="cm-number">376</span> refs, <span class="cm-number">0</span>.0004634 secs]2020-07-28T18:30:15.376<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78181</span>.953: [FinalReference, <span class="cm-number">435363</span> refs, <span class="cm-number">0</span>.3004894 secs]2020-07-28T18:30:15.677<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78182</span>.254: [PhantomReference, <span class="cm-number">0</span> refs, <span class="cm-number">331</span> refs, <span class="cm-number">0</span>.0009668 secs]2020-07-28T18:30:15.678<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78182</span>.255: [JNI Weak Reference, <span class="cm-number">0</span>.0002237 secs], <span class="cm-number">0</span>.4895046 secs] <span class="cm-number">2020</span><span class="cm-attribute">-07</span><span class="cm-attribute">-28T18</span>:30:15.798<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">78182</span>.375: [Unloading, <span class="cm-number">0</span>.0347793 secs], <span class="cm-number">0</span>.5384580 secs]</span></span></pre>
</div>
</div>
</div>
<p data-lake-id="2c1329c18125ecd556f4190497feb8b5">(5)Cleanup 清除 STW AND<em> Concurrent</em></p>
<p data-lake-id="c3bdcc667c9af3026dd25e7362502540">STW操作，清点出有存活对象的Region和没有存活对象的Region(Empty Region)</p>
<p data-lake-id="3c8e180eac9dd9b4f9a3df70d429bfb3">STW操作，更新Rset</p>
<p data-lake-id="cbfa4abe0d5feb3b8fe03b27bb8fa6a2">通过以上分析我们基本上断定了，就是因为并发FinalReference太多了，导致标记的时候，花费了很长的时间，造成了应用的暂停和抖动。</p>
<p data-lake-id="89d0a79afe6125f3435293248b6451ed">定位到这个问题之后，就尝试着去分析，为啥会有这么多的FinalReference这玩意儿呢? 能不能减少呢？</p>
<h2 id="wSv76" data-lake-id="a7fea7d2bbfcbf3b705bdc9d0827d183">heap分析</h2>
<p data-lake-id="02da64d0730e3438a4ecae1ca7838bb9">通过jmap -dump:format=b,file=heapdump.phrof 把生产的内存区下载下来之后，再去分析，也没发现什么有用的信息, 果然是发现这个东西很多<span class="lake-card-margin-top lake-card-margin-bottom lake-selected" data-card-type="inline" data-lake-card="image" data-card-value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2020%2Fpng%2F180554%2F1599556958375-49d136b6-f770-42ff-8123-9699b67ed521.png%22%2C%22originWidth%22%3A912%2C%22originHeight%22%3A359%2C%22name%22%3A%22image.png%22%2C%22size%22%3A232806%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A98.65999%2C%22y%22%3A17.615725%2C%22width%22%3A88.13296%2C%22height%22%3A12.299191999999998%2C%22text%22%3A%22dominatortree%22%7D%2C%7B%22x%22%3A27.516315%2C%22y%22%3A18.118801%2C%22width%22%3A50.625745%2C%22height%22%3A11.574691999999999%2C%22text%22%3A%22Overview%22%7D%2C%7B%22x%22%3A7.26933%2C%22y%22%3A36.5102%2C%22width%22%3A62.26341000000001%2C%22height%22%3A11.412957000000006%2C%22text%22%3A%22ClassName%22%7D%2C%7B%22x%22%3A520.552%2C%22y%22%3A36.591743%2C%22width%22%3A71.22500000000002%2C%22height%22%3A10.918877000000002%2C%22text%22%3A%22ShallowHeap%22%7D%2C%7B%22x%22%3A608.4108%2C%22y%22%3A36.79788%2C%22width%22%3A91.47850000000005%2C%22height%22%3A10.324826999999999%2C%22text%22%3A%22RetainedHeap%22%7D%2C%7B%22x%22%3A728.1165%2C%22y%22%3A36.96813%2C%22width%22%3A61.76819999999998%2C%22height%22%3A10.834209999999999%2C%22text%22%3A%22Percentage%22%7D%2C%7B%22x%22%3A731.2339%2C%22y%22%3A54.12503%2C%22width%22%3A55.549800000000005%2C%22height%22%3A10.406600000000005%2C%22text%22%3A%22%3CNumeric%3E%22%7D%2C%7B%22x%22%3A638.754%2C%22y%22%3A54.17504%2C%22width%22%3A58.90649999999994%2C%22height%22%3A10.595869999999998%2C%22text%22%3A%22%3CNumeric%3E%22%7D%2C%7B%22x%22%3A533.41034%2C%22y%22%3A54.333603%2C%22width%22%3A56.445659999999975%2C%22height%22%3A10.044077000000001%2C%22text%22%3A%22%3CNumeric%3E%22%7D%2C%7B%22x%22%3A753.1623%2C%22y%22%3A70.044075%2C%22width%22%3A34.38040000000001%2C%22height%22%3A10.87013499999999%2C%22text%22%3A%223.06%25%22%7D%2C%7B%22x%22%3A635.1424%2C%22y%22%3A70.47033%2C%22width%22%3A64.14020000000005%2C%22height%22%3A10.84836%2C%22text%22%3A%2225%2C756%2C040%22%7D%2C%7B%22x%22%3A38.61448%2C%22y%22%3A71.89185%2C%22width%22%3A283.56482%2C%22height%22%3A11.598279999999988%2C%22text%22%3A%22classjava.langinlizx7%22%7D%2C%7B%22x%22%3A316.52676%2C%22y%22%3A72.36007%2C%22width%22%3A40.63092%2C%22height%22%3A11.041070000000005%2C%22text%22%3A%22nclass%22%7D%2C%7B%22x%22%3A754.00287%2C%22y%22%3A86.566185%2C%22width%22%3A34.65258999999992%2C%22height%22%3A11.382114999999999%2C%22text%22%3A%223.06%25%22%7D%2C%7B%22x%22%3A633.82275%2C%22y%22%3A86.9225%2C%22width%22%3A65.87365%2C%22height%22%3A11.412000000000006%2C%22text%22%3A%2225%2C756%2C008%22%7D%2C%7B%22x%22%3A47.33805%2C%22y%22%3A88.52634%2C%22width%22%3A214.26205%2C%22height%22%3A10.81783%2C%22text%22%3A%22java.lang.ref.Finalizer%40x6c63dabc8%22%7D%2C%7B%22x%22%3A576.1451%2C%22y%22%3A99.123634%2C%22width%22%3A17.622600000000034%2C%22height%22%3A17.622600000000034%2C%22text%22%3A%228%22%7D%2C%7B%22x%22%3A754.89966%2C%22y%22%3A103.34179%2C%22width%22%3A33.22863999999993%2C%22height%22%3A10.976579999999998%2C%22text%22%3A%223.06%25%22%7D%2C%7B%22x%22%3A634.2653%2C%22y%22%3A104.63223%2C%22width%22%3A64.1137%2C%22height%22%3A11.056929999999994%2C%22text%22%3A%2225%2C755%2C968%22%7D%2C%7B%22x%22%3A78.476555%2C%22y%22%3A106.23136%2C%22width%22%3A200.68451499999998%2C%22height%22%3A11.506906%2C%22text%22%3A%22java.langref.Finalize%40ox6c63da9c8%22%7D%2C%7B%22x%22%3A754.3249%2C%22y%22%3A120.64545%2C%22width%22%3A33.33140000000003%2C%22height%22%3A10.500240000000005%2C%22text%22%3A%223%2C06%25%22%7D%2C%7B%22x%22%3A634.4754%2C%22y%22%3A121.4482%2C%22width%22%3A63.74860000000001%2C%22height%22%3A11.470600000000005%2C%22text%22%3A%2225%2C755%2C928%22%7D%2C%7B%22x%22%3A89.96585%2C%22y%22%3A121.797226%2C%22width%22%3A206.26274999999998%2C%22height%22%3A13.092714%2C%22text%22%3A%22java.lang.ret.Finalize%40ox6c6179a70%22%7D%2C%7B%22x%22%3A754.20526%2C%22y%22%3A137.74982%2C%22width%22%3A34.170240000000035%2C%22height%22%3A11.383510000000001%2C%22text%22%3A%223.06%25%22%7D%2C%7B%22x%22%3A633.493%2C%22y%22%3A138.36172%2C%22width%22%3A65.0435%2C%22height%22%3A11.534230000000008%2C%22text%22%3A%2225%2C755%2C888%22%7D%2C%7B%22x%22%3A102.948715%2C%22y%22%3A138.3827%2C%22width%22%3A207.09040500000003%2C%22height%22%3A13.38678999999999%2C%22text%22%3A%22javalang.ret.Finalizer%40x6c63da7c8%22%7D%2C%7B%22x%22%3A753.6116%2C%22y%22%3A154.59015%2C%22width%22%3A36.554700000000025%2C%22height%22%3A13.079740000000015%2C%22text%22%3A%223.06%25%22%7D%2C%7B%22x%22%3A632.8418%2C%22y%22%3A155.15968%2C%22width%22%3A67.27850000000001%2C%22height%22%3A12.508499999999998%2C%22text%22%3A%2225%2C755%2C336%22%7D%2C%7B%22x%22%3A120.776825%2C%22y%22%3A154.85799%2C%22width%22%3A203.32522500000002%2C%22height%22%3A13.42828%2C%22text%22%3A%22java.lang.re.Finalizor%40Ox6c63da5c8%22%7D%2C%7B%22x%22%3A753.8039%2C%22y%22%3A171.33548%2C%22width%22%3A36.490999999999985%2C%22height%22%3A12.777860000000004%2C%22text%22%3A%220.00%25%22%7D%2C%7B%22x%22%3A122.21285%2C%22y%22%3A171.53555%2C%22width%22%3A225.61890999999997%2C%22height%22%3A13.120200000000011%2C%22text%22%3A%22javanet.SocksSocketImpl%40Ox6c63da758%22%7D%2C%7B%22x%22%3A571.18494%2C%22y%22%3A171.89272%2C%22width%22%3A22.795709999999985%2C%22height%22%3A12.303809999999999%2C%22text%22%3A%22112%22%7D%2C%7B%22x%22%3A676.18787%2C%22y%22%3A172.83818%2C%22width%22%3A24.269430000000057%2C%22height%22%3A11.186049999999994%2C%22text%22%3A%22512%22%7D%2C%7B%22x%22%3A114.40913%2C%22y%22%3A188.89816%2C%22width%22%3A93.98047%2C%22height%22%3A11.920110000000022%2C%22text%22%3A%22Total%3A2entries%22%7D%2C%7B%22x%22%3A753.114%2C%22y%22%3A204.25812%2C%22width%22%3A34.71943999999996%2C%22height%22%3A13.262720000000002%2C%22text%22%3A%220.00%25%22%7D%2C%7B%22x%22%3A577.5196%2C%22y%22%3A205.18141%2C%22width%22%3A13.742799999999988%2C%22height%22%3A11.931610000000006%2C%22text%22%3A%2216%22%7D%2C%7B%22x%22%3A684.1707%2C%22y%22%3A205.39677%2C%22width%22%3A14.157240000000002%2C%22height%22%3A12.867159999999984%2C%22text%22%3A%2216%22%7D%2C%7B%22x%22%3A53.721397%2C%22y%22%3A205.6704%2C%22width%22%3A183.484263%2C%22height%22%3A14.940120000000007%2C%22text%22%3A%22java.lang.obiject%40Ox5400a2b3o%22%7D%2C%7B%22x%22%3A42.402977%2C%22y%22%3A220.42873%2C%22width%22%3A113.137493%2C%22height%22%3A16.22398000000001%2C%22text%22%3A%22TOTAL%3A2CNtrIES%22%7D%2C%7B%22x%22%3A755.92896%2C%22y%22%3A239.27107%2C%22width%22%3A33.49724000000003%2C%22height%22%3A12.36042999999998%2C%22text%22%3A%221.58%25%22%7D%2C%7B%22x%22%3A635.9074%2C%22y%22%3A239.31331%2C%22width%22%3A63.12489999999991%2C%22height%22%3A12.83323999999999%2C%22text%22%3A%2213%2C294%2C640%22%7D%2C%7B%22x%22%3A572.6236%2C%22y%22%3A240.29793%2C%22width%22%3A19.15809999999999%2C%22height%22%3A10.816270000000003%2C%22text%22%3A%22128%22%7D%2C%7B%22x%22%3A38.92121%2C%22y%22%3A239.42406%2C%22width%22%3A467.70754%2C%22height%22%3A16.888809999999978%2C%22text%22%3A%22og.springtramework.contextanaton.nacocacoe%22%7D%2C%7B%22x%22%3A754.67224%2C%22y%22%3A256.10248%2C%22width%22%3A34.27326000000005%2C%22height%22%3A11.639819999999986%2C%22text%22%3A%220.80%25%22%7D%2C%7B%22x%22%3A640.46594%2C%22y%22%3A256.44992%2C%22width%22%3A58.361209999999915%2C%22height%22%3A12.333010000000002%2C%22text%22%3A%226%2C698%2C960%22%7D%2C%7B%22x%22%3A38.95774%2C%22y%22%3A257.78708%2C%22width%22%3A293.5751%2C%22height%22%3A14.118819999999971%2C%22text%22%3A%22sun.misc.LauchrsAppclassLoader%40ox540000000%22%7D%2C%7B%22x%22%3A642.38275%2C%22y%22%3A273.43124%2C%22width%22%3A55.83869000000004%2C%22height%22%3A12.48529000000002%2C%22text%22%3A%221%2C418%2C824%22%7D%2C%7B%22x%22%3A754.52356%2C%22y%22%3A273.45502%2C%22width%22%3A34.1087%2C%22height%22%3A11.57763%2C%22text%22%3A%220.17%25%22%7D%2C%7B%22x%22%3A577.6854%2C%22y%22%3A273.5149%2C%22width%22%3A12.979150000000004%2C%22height%22%3A12.194479999999999%2C%22text%22%3A%2280%22%7D%2C%7B%22x%22%3A40.23149%2C%22y%22%3A273.59384%2C%22width%22%3A279.84139%2C%22height%22%3A15.716340000000002%2C%22text%22%3A%22sun.net.www.protocoljarURLJarFil%40Ox5409f0cf8%22%7D%2C%7B%22x%22%3A642.4233%2C%22y%22%3A290.6466%2C%22width%22%3A55.51816999999994%2C%22height%22%3A12.379580000000033%2C%22text%22%3A%221%2C389%2C656%22%7D%2C%7B%22x%22%3A755.29034%2C%22y%22%3A290.90332%2C%22width%22%3A32.61761999999999%2C%22height%22%3A10.677399999999977%2C%22text%22%3A%220.17%25%22%7D%2C%7B%22x%22%3A39.931904%2C%22y%22%3A291.38345%2C%22width%22%3A201.816016%2C%22height%22%3A14.12360000000001%2C%22text%22%3A%22java.util.jarJarFile%40Ox540618co%22%7D%2C%7B%22x%22%3A40.78678%2C%22y%22%3A305.96628%2C%22width%22%3A341.62257999999997%2C%22height%22%3A15.75305000000003%2C%22text%22%3A%22com.fasterxmljackson.databind.ObjctMapper0x542600390%22%7D%2C%7B%22x%22%3A577.0516%2C%22y%22%3A307.34702%2C%22width%22%3A14.028999999999996%2C%22height%22%3A12.889479999999992%2C%22text%22%3A%2264%22%7D%2C%7B%22x%22%3A645.1148%2C%22y%22%3A307.37213%2C%22width%22%3A53.332340000000045%2C%22height%22%3A12.552949999999953%2C%22text%22%3A%221%2C0835%22%7D%2C%7B%22x%22%3A754.6296%2C%22y%22%3A307.89584%2C%22width%22%3A34.15055000000007%2C%22height%22%3A11.029729999999972%2C%22text%22%3A%220.12%25%22%7D%2C%7B%22x%22%3A650.8912%2C%22y%22%3A325.37177%2C%22width%22%3A48.24563999999998%2C%22height%22%3A10.829729999999984%2C%22text%22%3A%22901%2C816%22%7D%2C%7B%22x%22%3A39.72683%2C%22y%22%3A323.745%2C%22width%22%3A339.53129%2C%22height%22%3A15.29113000000001%2C%22text%22%3A%22org.apache.http.co.uliuihx0290%22%7D%2C%7B%22x%22%3A753.80536%2C%22y%22%3A325.56653%2C%22width%22%3A35.55749000000003%2C%22height%22%3A9.940920000000006%2C%22text%22%3A%220.11%25%22%7D%2C%7B%22x%22%3A571.0014%2C%22y%22%3A341.94644%2C%22width%22%3A22.173599999999965%2C%22height%22%3A12.032989999999984%2C%22text%22%3A%22120%22%7D%2C%7B%22x%22%3A651.6472%2C%22y%22%3A341.96573%2C%22width%22%3A47.245559999999955%2C%22height%22%3A11.490139999999997%2C%22text%22%3A%22842%2C552%22%7D%2C%7B%22x%22%3A753.2987%2C%22y%22%3A342.33893%2C%22width%22%3A34.918499999999995%2C%22height%22%3A10.833340000000021%2C%22text%22%3A%220.10%25%22%7D%2C%7B%22x%22%3A39.10348%2C%22y%22%3A343.21628%2C%22width%22%3A468.13105%2C%22height%22%3A12.831389999999999%2C%22text%22%3A%22juvalbng.th%3A%22%7D%5D%2C%22style%22%3A%22none%22%2C%22search%22%3A%22dominatortree%20Overview%20ClassName%20ShallowHeap%20RetainedHeap%20Percentage%20%3CNumeric%3E%20%3CNumeric%3E%20%3CNumeric%3E%203.06%25%2025%2C756%2C040%20classjava.langinlizx7%20nclass%203.06%25%2025%2C756%2C008%20java.lang.ref.Finalizer%40x6c63dabc8%208%203.06%25%2025%2C755%2C968%20java.langref.Finalize%40ox6c63da9c8%203%2C06%25%2025%2C755%2C928%20java.lang.ret.Finalize%40ox6c6179a70%203.06%25%2025%2C755%2C888%20javalang.ret.Finalizer%40x6c63da7c8%203.06%25%2025%2C755%2C336%20java.lang.re.Finalizor%40Ox6c63da5c8%200.00%25%20javanet.SocksSocketImpl%40Ox6c63da758%20112%20512%20Total%3A2entries%200.00%25%2016%2016%20java.lang.obiject%40Ox5400a2b3o%20TOTAL%3A2CNtrIES%201.58%25%2013%2C294%2C640%20128%20og.springtramework.contextanaton.nacocacoe%200.80%25%206%2C698%2C960%20sun.misc.LauchrsAppclassLoader%40ox540000000%201%2C418%2C824%200.17%25%2080%20sun.net.www.protocoljarURLJarFil%40Ox5409f0cf8%201%2C389%2C656%200.17%25%20java.util.jarJarFile%40Ox540618co%20com.fasterxmljackson.databind.ObjctMapper0x542600390%2064%201%2C0835%200.12%25%20901%2C816%20org.apache.http.co.uliuihx0290%200.11%25%20120%20842%2C552%200.10%25%20juvalbng.th%3A%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22width%22%3A912%2C%22height%22%3A359%7D"><img class="image lake-drag-image" title="image.png" src="https://cdn.nlark.com/yuque/0/2020/png/180554/1599556958375-49d136b6-f770-42ff-8123-9699b67ed521.png" alt="image.png" data-role="image" data-raw-src="" data-height="359px" /></span>, 看起来依然是跟SocksSocketImpl有关系</p>
<h2 id="efb2e858" data-lake-id="0288b39dd6bdbcd5a381f386d7e9f794">问题定位</h2>
<h3 id="jNN10" data-lake-id="64679c38b059277a46dfcfcd2b52bea1">查找new SocksSoketImpl()的来源</h3>
<p data-lake-id="697850ec7b5e599b4e2d62e9d03cbd7e">我们看看为什么会有这么多java.net.SocksSoketImpl呢？通过以前的手段，我们继续使用阿尔萨斯来定位。通过监控SocksSoketImpl的构造方法，我们发现不断的被创建新的连接。</p>
<h4 id="e71de7df" data-lake-id="57b1787c0a6e0b1f0c0ce03ba0de2e60">尝试1: 关闭JMX收集</h4>
<p data-lake-id="fe84c2e257280b05120cfcfb4dd408d4">我们发现不少的连接是来自JMX的信息收集，我先把这个关闭了看看，结果并没有任何改观</p>
<h4 id="ebfd4a5a" data-lake-id="399c82649e65cde6a4f92863a0666f1a">尝试2: httpclient的短连接问题?</h4>
<p data-lake-id="006a3b025aa2086108231b7bb7899e57">开始试着查找为什么不断的new 新的连接呢？是不是连接未能复用呢?网上很多人也遇到了同样的问题，很多是因为错误的使用了短连接造成的。</p>
<p data-lake-id="570983ffd7800dbaf10e01295780d343">我开始质疑是不是公司的中间件有问题。公司的httpclient统一使用的是中间件封装的一层，目的是为了便于统计和跟踪。在本地测试的时候，发现连接是能够保持的。是不是生产网络的连接无法保持呢？</p>
<h4 id="sBaZY" data-lake-id="33b2ea7772707a65a27831c06051d85f">搞清楚httpclient,调整httpclient连接池参数</h4>
<p data-lake-id="a2d3b179ea744aec618fb4fd03a94277">我们内部调用http的服务，一般是这么调的</p>
<p data-lake-id="ff60ae60dab40ca8444a93d4b5b75eb5">JSONObject obj = restTemplate.getForObject(realUrl, JSONObject.class);</p>
<p data-lake-id="4229f497eb212b309b1eb6d092578040">这个其实是spring给你封装的一个模板方法，大大的减少了使用httpclient的成本。还记得以前使用httpclient都会自己封装一层，使用连接池，使用idle线程踢出不再使用的线程等等。</p>
<p data-lake-id="01a8b2bb6f7804af944b8570103dd258">而公司的中间利用的是模板方法里提供的插入自己逻辑的机会，增加了埋点。另外就是把配置暴露到application.yml里给你可以配置。</p>
<h4 id="tN4nA" data-lake-id="664ce334adc07bcc2520859513441485">PoolingHttpClientConnectionManager的分析</h4>
<p data-lake-id="6b92c904d710acc1c6b6faa49649b461">去爬了一遍PoolingHttpClientConnectionManager的源代码，了解下连接池管理这一段，去找找到底为什么连接无法保持呢?分析的过程如下</p>
<p data-lake-id="70b6d1e1a4b7fb9949caeaed9c839314">涉及的类</p>
<p data-lake-id="4856b14d635d54980e689f12131e134c">CPoolEntry: Pool的一个单元，包含了route信息和connect的连接</p>
<p data-lake-id="5c3622c2f3e240a4d055e0b8e60431f9">Cpool: lease 尝试去租用一个连接, 此方法会获取一个Future的对象.</p>
<p data-lake-id="5a4e6c1b9e3d5b5b41751a72e81c40c4">Future&lt;CPoolEntry&gt; 具体的能力是无阻塞的获取一个Pool单元.</p>
<p data-lake-id="ace73116b83359b2c0960670a116c345">那么这个Future是怎么获取连接的，调用他get方法, 会拿到上一次的连接，如果没拿到，会调用</p>
<p data-lake-id="1909cb630676aa5550eb861224ed8362">getPoolEntryBlocking方法，进一步的获取连接单元.</p>
<p data-lake-id="aab543f5731d2403866172fddc13b3b6">这个方法调用了RouteSpecificPool.getFree.//拿到一个可用的连接.</p>
<p data-lake-id="ca99fa9fd1e10b3e219f10b27cc35095">RouteSpecificPool: 里面是两个链表, 存储的是route维度的连接信息. 如果是getFree方法，那就从avaiable里拿一个元素出来，并且放到lease的链表里，代表成功lease了一个连接。</p>
<p data-lake-id="426d4f85f44bdb21f39aa136265017fb">  try {</p>
<p data-lake-id="915fc8d33ec55dc9a51d5c0f7d66ccfe">           final RouteSpecificPool&lt;T, C, E&gt; pool = getPool(route);</p>
<p data-lake-id="0e5583255fb0070be41e72dc8ef9f55a">           E entry;</p>
<p data-lake-id="080b4d0056badae556f9dc5584e5b464">           for (;;) {</p>
<p data-lake-id="f251e386587cdeebc2cfab0c50fdd0b9">               Asserts.check(!this.isShutDown, "Connection pool shut down");</p>
<p data-lake-id="990e7c1b9eea18c7f47a1bf2a2efdd04">               for (;;) {</p>
<p data-lake-id="42567f3dce1845583f3bf39b5ae67d25">                   //从avaiable的队列里取出来一个并且放到lease的队列里</p>
<p data-lake-id="de76584a5d858a611ede485d262f4052">                   //获取一个可用</p>
<p data-lake-id="c499b6fc9bf58915795b871d7175bd54">                   entry = pool.getFree(state);</p>
<p data-lake-id="e7400dfa18c274a9cf25fa3c600e9b41">                   if (entry == null) {</p>
<p data-lake-id="b6c5fabfe6f2a2be1f43341c677bcc35">                       break;</p>
<p data-lake-id="c5068c2d7b6e7fca3269f3d2e98eb145">                   }</p>
<p data-lake-id="73ddbdf3a0493eb630701407a6446969">                   if (entry.isExpired(System.currentTimeMillis())) {</p>
<p data-lake-id="c4209c7468b7ad990536a6e6fbab37d1">                       entry.close();</p>
<p data-lake-id="9d2f98ac598a724bda1db43cb6c82a3b">                   }</p>
<p data-lake-id="5ea94f160a05a9ababa918a08e429b44">                   //如果连接是关闭的,过期了会自动关闭</p>
<p data-lake-id="a4793b2281a10b68defc7a4958c4cc41">                   if (entry.isClosed()) {</p>
<p data-lake-id="f3ecf6d4328fdaf9fd97ad1f780023f5">                       //因为这个连接已经不可用了, 把他从可用列表里移除</p>
<p data-lake-id="6ead79d53ee8127c4d0ca68a3e567a6e">                       this.available.remove(entry);</p>
<p data-lake-id="076c2e856889d4d12b7979086f4b44f2">                       //再从pool里的lease的队列里取一个放到available的队列列</p>
<p data-lake-id="0e2600e70db83f908f1e7fe279579afc">                       //因为是false,所以不会放到avaiable里</p>
<p data-lake-id="47ed83d1e3e3e21740a7e5f1288c43b1">                       pool.free(entry, false);</p>
<p data-lake-id="d2b52f27f022a48bc33a7c98009245dd">                   } else {</p>
<p data-lake-id="24b6b6b71732f7cf350c8820a08401bc">                       break;</p>
<p data-lake-id="32d7c738de691bc1b1c8df34d8cdfead">                   }</p>
<p data-lake-id="9595c1a92ba2f6820c06591c4d7a692d">                   //第一个for完了,得到了一个entry(可用)或者null</p>
<p data-lake-id="f9fd98b38b91c811f9236d1852e34270">                  if (entry != null) {</p>
<p data-lake-id="7f97dd811959d74f57f4fc2edc830528">                      //成功的获取到了，记录一下从可用里移除,并且结束进程</p>
<p data-lake-id="91fef1c0db6208db7c3fb80bdd9ac59e">                   this.available.remove(entry);</p>
<p data-lake-id="009d8589cfeecb564392f9edbf395e98">                      //放到lease的里面去</p>
<p data-lake-id="53c0c25568479d9e9acf6bc855766805">                   this.leased.add(entry);</p>
<p data-lake-id="23a98647c1001f772690479b6ca8beb2">                      //标记为可重复使用</p>
<p data-lake-id="d74518a92b1dffd4012842450476f96a">                   onReuse(entry);</p>
<p data-lake-id="def3c63d3c045704a08664c09c36321f">                   return entry;</p>
<p data-lake-id="6c235bfa3d86822df34acbfab9cb4363">               }</p>
<p data-lake-id="c8d81eb9c7565da2d94417fd4179f925">                        // 如果为null则需要重新构建一个连接.</p>
<p data-lake-id="d40e17c265215331cb19915ed93b35da">               final int maxPerRoute = getMax(route);</p>
<p data-lake-id="e34bcb12d2a5616ea252b019544e7402">               // Shrink the pool prior to allocating a new connection</p>
<p data-lake-id="0ae305270c476cd4068513b3269d232a">               final int excess = Math.max(0, pool.getAllocatedCount() + 1 - maxPerRoute);</p>
<p data-lake-id="043a8c29c8260f97df266e72bbe382ea">                   //这个excess恒大于1?</p>
<p data-lake-id="8d8ad59f3fccb6dd9e126968369f11cb">                   if (excess &gt; 0) {</p>
<p data-lake-id="589b3b9ab7d2d6a0abc06d77c684b6f3">                   for (int i = 0; i &lt; excess; i++) {</p>
<p data-lake-id="8af13cd24812485777aa62b7f6e14dbf">                       final E lastUsed = pool.getLastUsed();</p>
<p data-lake-id="70814456fbc643c4e5ee5c60689770e0">                       if (lastUsed == null) {</p>
<p data-lake-id="a60c88d405b9cf816825c3b86ff3464b">                           break;</p>
<p data-lake-id="175931a97516114cbca09466f4727412">                       }</p>
<p data-lake-id="0a9558385759379e544e7479c23d8d67">                       lastUsed.close();</p>
<p data-lake-id="2970222bc1e405a27948051e9c4edcfb">                       this.available.remove(lastUsed);</p>
<p data-lake-id="bd2d83b609b9eb5aaba1548c504a4730">                       pool.remove(lastUsed);</p>
<p data-lake-id="3ef2532a31edf3a280a9a3c3536ff527">                   }</p>
<p data-lake-id="bb872f11bdd3d0a992457e94eb8b321b">               }</p>
<p data-lake-id="5d27a5b6829f4ae109d20cd7285c5c87">
<p data-lake-id="91c8e74a204446f005ce468e0d00d4e2">                   //如果还有容量, 则新建一个连接</p>
<p data-lake-id="705f16c2772c106fc822adc2c8b72c90">
<p data-lake-id="952722c5123ef12d46efda2be5e79ff5">                     if (pool.getAllocatedCount() &lt; maxPerRoute) {</p>
<p data-lake-id="33879a733cdeb3f1331b30b3758bc6ec">                   final int totalUsed = this.leased.size();</p>
<p data-lake-id="1a3dfc197e195f664b9a4e28fe2bef18">                   final int freeCapacity = Math.max(this.maxTotal - totalUsed, 0);</p>
<p data-lake-id="c6cc30619b2d6275f04ae40e48658b3d">                   if (freeCapacity &gt; 0) {</p>
<p data-lake-id="f7b38a99cd93057983a36e3103fc3c99">                       final int totalAvailable = this.available.size();</p>
<p data-lake-id="7417d4af38a55666ad341ba739737d2f">                       if (totalAvailable &gt; freeCapacity - 1) {</p>
<p data-lake-id="95180eb2b42aa0406ec48d8c335e22c6">                           if (!this.available.isEmpty()) {</p>
<p data-lake-id="e340006d44f88ff55c8e5c40f47ee9f5">                               final E lastUsed = this.available.removeLast();</p>
<p data-lake-id="1eed268466053d5b88688f4838454da4">                               lastUsed.close();</p>
<p data-lake-id="7119f00c8fdc299b841ed1dec45debb7">                               final RouteSpecificPool&lt;T, C, E&gt; otherpool = getPool(lastUsed.getRoute());</p>
<p data-lake-id="ded24b8ad1b539d062310bb64ad2e2e7">                               otherpool.remove(lastUsed);</p>
<p data-lake-id="001774f4657b006e441c34a395985e2a">                           }</p>
<p data-lake-id="2b145ab5ae2888efc709fd9dfbce7154">                       }</p>
<p data-lake-id="90502ba49cea82bb7a7898993022eae9">                       final C conn = this.connFactory.create(route);</p>
<p data-lake-id="2f79e503e279a361d29308941cb276ba">                       entry = pool.add(conn);</p>
<p data-lake-id="446d193fe8def0a1ed8f67077ce85532">                       this.leased.add(entry);</p>
<p data-lake-id="3fead4d7e82b1afa32e6966f92fab149">                       return entry;</p>
<p data-lake-id="b204f0cadf2aaab341e1d45c19a8f77e">                   }</p>
<p data-lake-id="98920e0d271722fee122e3ccbfdde178">               }</p>
<p data-lake-id="31333ffa4ff08950a8d646990792f799">
<p data-lake-id="74e0a7b576a112e265057fd42e1f823f">
<p data-lake-id="a2087a17fe52454d39fa21a91460eca7">               }</p>
<p data-lake-id="5bc8edf0f2339e03da752e8650df3870">通过这个可以清楚的了解到，这些配置参数的含义。</p>
<p data-lake-id="2905be5d296743bd985687c444a4d8c2">max-total: 连接池最大的连接数量</p>
<p data-lake-id="1669704fba0bff875aa3e19c0e3695ab">max-per-route: 连接池里每个域名的最大连接数量</p>
<p data-lake-id="22a3f6f51d7c367981a419224629d029">default-max-per-route: 没找到对应的域名的配置时候，使用的连接数量</p>
<p data-lake-id="2496366f1a3b2b57414446365a9fa218">公司的中间还封装了一个逻辑，默认全局只有一个连接池，使用的是上面的配置。他封装了一个逻辑，可以一个域名配置一个连接池。配置格式类似如下，下面就有两个连接池，每个连接池用自己的配置。</p>
<div id="0ocg8" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22shell%22%2C%22code%22%3A%22httpclient%3A%5Cn%20%20default-pool%3A%5Cn%20%20%20%20default-max-per-route%3A%2020%5Cn%20%20%20%20max-total%3A%20100%5Cn%20%20%20%20max-per-route%3A%2050%5Cn%20%20%20%20keep-alive-time%3A%2060%5Cn%20%20%20%20connect-timeout%3A%205000%5Cn%20%20%20%20connection-request-timeout%3A%205000%5Cn%20%20%20%20socket-timeout%3A%201000%5Cn%20%20%20%20idle-connections-timeout%3A%2030%5Cn%20%20%20%20idle-connections-check-schedule%3A%205000%5Cn%20%20pool-configs%3A%5Cn%20%20%20%20%20%20%5C%22%5Bhttp%3A%2F%2F10.69.3.58%3A9003%5D%5C%22%3A%5Cn%20%20%20%20%20%20%20%20max-total%3A%20213%5Cn%20%20%20%20%20%20%20%20max-per-route%3A%20123%5Cn%20%20%20%20%20%20%20%20keep-alive-time%3A%20900%5Cn%20%20%20%20%20%20%20%20connect-timeout%3A%20450%5Cn%20%20%20%20%20%20%20%20connection-request-timeout%3A%20450%5Cn%20%20%20%20%20%20%20%20socket-timeout%3A%20450%5Cn%20%20%20%20%20%20%20%20idle-connections-timeout%3A%2030%5Cn%20%20%20%20%20%20%20%20idle-connections-check-schedule%3A%205000%22%2C%22heightLimit%22%3Atrue%2C%22margin%22%3Atrue%2C%22id%22%3A%220ocg8%22%7D" data-language="shell">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-codeblock-content">httpclient:
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">  default-pool:
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">    default-max-per-route: <span class="cm-number">20</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">    max-total: <span class="cm-number">100</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">    max-per-route: <span class="cm-number">50</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">    keep-alive-time: <span class="cm-number">60</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">    connect-timeout: <span class="cm-number">5000</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">    connection-request-timeout: <span class="cm-number">5000</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">    socket-timeout: <span class="cm-number">1000</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">    idle-connections-timeout: <span class="cm-number">30</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">    idle-connections-check-schedule: <span class="cm-number">5000</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">  pool-configs:
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      <span class="cm-string">"[http://10.69.3.58:9003]"</span>:
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">        max-total: <span class="cm-number">213</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">        max-per-route: <span class="cm-number">123</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">        keep-alive-time: <span class="cm-number">900</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">        connect-timeout: <span class="cm-number">450</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">        connection-request-timeout: <span class="cm-number">450</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">        socket-timeout: <span class="cm-number">450</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">        idle-connections-timeout: <span class="cm-number">30</span>
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">        idle-connections-check-schedule: <span class="cm-number">5000</span></span></span></pre>
</div>
</div>
</div>
<h4 id="rHfOp" data-lake-id="08f4816707efce6f1b85c38590c0a592">生产问题定位</h4>
<p data-lake-id="7038f43cec5ab5704619cb400b2116b0">了解了PoolingHttpClientConnectionManager之后，其实我们可以把日志打开看一看，到底是什么情况？</p>
<p data-lake-id="9160fc8ce98db43369a83870642de5fe">  &lt;Logger name="org.apache.http.impl.conn.PoolingHttpClientConnectionManager" level="DEBUG"&gt;</p>
<p data-lake-id="ced18afe925bcc2be351101553369fad">       &lt;/Logger&gt;</p>
<p data-lake-id="037551fe2db85f904ff64a404bc3f0b4">我把这个类的info日志打开，发现日志如下:</p>
<div id="VHJSj" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22shell%22%2C%22code%22%3A%222020-08-26%2016%3A47%3A36%20%5Cu001b%5B36mDEBUG%5Cu001b%5Bm%5Bpool-7-thread-149%5D%20%5Bo.a.h.i.c.PoolingHttpClientConnectionManager.requestConnection%3A266%5D%20%5B154ee4edcd6d1152%2C154ee4edcd6d1152%2C0%5D%20Connection%20request%3A%20%5Broute%3A%20%7Bs%7D-%3Ehttps%3A%2F%2Faiengine-hellomap-route-inner.hellobike.cn%3A9003%5D%5Btotal%20kept%20alive%3A%200%3B%20route%20allocated%3A%2050%20of%2050%3B%20total%20allocated%3A%2050%20of%20100%5D%5Cn2020-08-26%2016%3A47%3A36%20%5Cu001b%5B36mDEBUG%5Cu001b%5Bm%5Bpool-7-thread-219%5D%20%5Bo.a.h.i.c.PoolingHttpClientConnectionManager.leaseConnection%3A310%5D%20%5B8f2ce76435c397c6%2C8f2ce76435c397c6%2C0%5D%20Connection%20leased%3A%20%5Bid%3A%20607%5D%5Broute%3A%20%7Bs%7D-%3Ehttps%3A%2F%2Faiengine-hellomap-route-inner.hellobike.cn%3A9003%5D%5Btotal%20kept%20alive%3A%200%3B%20route%20allocated%3A%2050%20of%2050%3B%20total%20allocated%3A%2050%20of%20100%5D%22%2C%22heightLimit%22%3Atrue%2C%22margin%22%3Atrue%2C%22id%22%3A%22VHJSj%22%7D" data-language="shell">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-08</span><span class="cm-attribute">-26</span> <span class="cm-number">16</span>:47:36 [36mDEBUG[m[pool-7-thread-149] [o.a.h.i.c.PoolingHttpClientConnectionManager.requestConnection:266] [154ee4edcd6d1152,154ee4edcd6d1152,0] Connection request: [route: {s}-&gt;https://aiengine-hellomap-route-inner.hellobike.cn:9003][total kept alive: <span class="cm-number">0</span>; route allocated: <span class="cm-number">50</span> of <span class="cm-number">50</span>; total allocated: <span class="cm-number">50</span> of <span class="cm-number">100</span>]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-08</span><span class="cm-attribute">-26</span> <span class="cm-number">16</span>:47:36 [36mDEBUG[m[pool-7-thread-219] [o.a.h.i.c.PoolingHttpClientConnectionManager.leaseConnection:310] [8f2ce76435c397c6,8f2ce76435c397c6,0] Connection leased: [id: <span class="cm-number">607</span>][route: {s}-&gt;https://aiengine-hellomap-route-inner.hellobike.cn:9003][total kept alive: <span class="cm-number">0</span>; route allocated: <span class="cm-number">50</span> of <span class="cm-number">50</span>; total allocated: <span class="cm-number">50</span> of <span class="cm-number">100</span>]</span></span></pre>
</div>
</div>
</div>
<p data-lake-id="54fc37e9c0d6b38e9f14c6590234a327">这个结合着PoolingHttpClientConnectionManager源代码还是比较容易理解的。</p>
<p data-lake-id="f396d11de88d57dd12a364413f4b0d28">这里为啥是 50 of 50跟我配置的不一样？ 后来发现是中间件的bug!!! 在https的时候就有bug，用户自己配的 max-per-route是无效的..这个是后话了</p>
<p data-lake-id="ec635aefb27842d9c5a96aab79ac8a3a">通过这个日志可以很清楚的知道，不仅使用了连接池，而且还能够保持连接。所以这个猜想是错误的。</p>
<h3 id="zGDLl" data-lake-id="4d0edbdb3f8ae679516d993387eefbf5">是不是有突增的流量进来呢</h3>
<p data-lake-id="8c6d38bf8149755e5d5a654ed257c5c0">我们这个应用还给另外一个特殊的定时任务类型的应用使用，会不会是他带来的巨大的流量，导致了很多连接的创建，最终导致了FinalReference过多呢？ 我们尝试把这部分流量切出去，然而问题依旧。</p>
<h3 id="cDk3v" data-lake-id="4ec115dbec91820013af436b3548cda9">是不是sslsession的问题导致的呢</h3>
<p data-lake-id="3288baa28d694459985bc24859b86a7a">期间还听说另外一个开放也遇到gc的问题，是因为jdk的bug导致的</p>
<p data-lake-id="0f0bbecf59c434801872e6dedfeaa0c8"><a href="https://bugs.openjdk.java.net/browse/JDK-8210985" target="_blank" rel="noopener">https://bugs.openjdk.java.net/browse/JDK-8210985</a></p>
<p data-lake-id="924129d048b905dd0bb22d0ee8b34be0">-Djavax.net.ssl.sessionCacheSize=101 通过设置他的大小来控制队列的长度，通过修改这个参数，依然没什么效果。</p>
<h2 id="HMq1s" data-lake-id="b3316fefdf366881f57b9f80963283e2">另类的解决方法</h2>
<p data-lake-id="e9ea8ac7df7ed2c629a5bfc7bf2f143e">查找FinalReference过多是查不到了，可能这个应用就是这么个特性。因为并发高，后端逻辑是纯http request，所以连接比较多是正常的。至于为啥FinalReference突然从6万多到了40多万，带来了gc的停顿，至今也没想明白。</p>
<p data-lake-id="1d905dde162df39c09d9aa8183a99c9f">但是生产的问题依然存在，必须火速解决。既然解决不了问题，我们就解决提出问题的人！回到问题的本质，是因为在并发标记阶段FinalReference太多了导致的。每次出问题都是并发标记带来的，那么我是不是可以通过增加并发标记的次数，主动的去干这个事，而不是让他累积到一定的量导致爆发呢？</p>
<h4 id="oWEdT" data-lake-id="441949dac66419bfd72911384df338e5">增加并发标记的次数</h4>
<p data-lake-id="4fe473dcf86bf1fe24127bb938110c6a">说干就干，我们通过增加参数-XX:InitiatingHeapOccupancyPercent=7来达到主动的触发并发标记的目的。这个参数的默认是45，也就是达到了45%会触发一次并发标记。同时我们把4核的机器换成8核，把并发标记的线程从4个提升到6个，我给你更多的计算资源，让你帮我把FinalReference主动的减少，行不行呢？</p>
<p data-lake-id="69630b344b36adfbbab7447c239e916c">参数修改之后，观察效果，发现并发标记的次数确实变多了，每次并发标记之后，FinalReference也如期减少了，达到了预期的效果。经过一周的观察，gc问题解决了，再也没有gc带来的超时问题.</p>
<p data-lake-id="2b7dee8b3903a5bb7728ff15000876f2">从日志上看7万多的FinalReference经过并发标记之后，到了5000多，目的达到了。</p>
<div id="bT011" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22shell%22%2C%22code%22%3A%222020-09-08T18%3A26%3A29.601%2B0800%3A%20509725.355%3A%20%5BSoftReference%2C%200%20refs%2C%200.0005530%20secs%5D2020-09-08T18%3A26%3A29.602%2B0800%3A%20509725.355%3A%20%5BWeakReference%2C%20651%20refs%2C%200.0003417%20secs%5D2020-09-08T18%3A26%3A29.602%2B0800%3A%20509725.356%3A%20%5BFinalReference%2C%2059425%20refs%2C%200.0084187%20secs%5D2020-09-08T18%3A26%3A29.611%2B0800%3A%20509725.364%3A%20%5BPhantomReference%2C%200%20refs%2C%200%20refs%2C%200.0007736%20secs%5D2020-09-08T18%3A26%3A29.611%2B0800%3A%20509725.365%3A%20%5BJNI%20Weak%20Reference%2C%200.0000406%20secs%5D%2C%200.0485472%20secs%5D%5Cn%20%20%20%5BParallel%20Time%3A%2031.2%20ms%2C%20GC%20Workers%3A%206%5D%5Cn%20%20%20%20%20%20%5BGC%20Worker%20Start%20(ms)%3A%20Min%3A%20509725323.3%2C%20Avg%3A%20509725323.4%2C%20Max%3A%20509725323.5%2C%20Diff%3A%200.1%5D%5Cn%20%20%20%20%20%20%5BExt%20Root%20Scanning%20(ms)%3A%20Min%3A%203.8%2C%20Avg%3A%205.3%2C%20Max%3A%2011.4%2C%20Diff%3A%207.6%2C%20Sum%3A%2031.7%5D%5Cn%20%20%20%20%20%20%5BUpdate%20RS%20(ms)%3A%20Min%3A%203.6%2C%20Avg%3A%209.6%2C%20Max%3A%2011.0%2C%20Diff%3A%207.3%2C%20Sum%3A%2057.7%5D%5Cn%20%20%20%20%20%20%20%20%20%5BProcessed%20Buffers%3A%20Min%3A%20256%2C%20Avg%3A%20319.7%2C%20Max%3A%20376%2C%20Diff%3A%20120%2C%20Sum%3A%201918%5D%5Cn%20%20%20%20%20%20%5BScan%20RS%20(ms)%3A%20Min%3A%200.1%2C%20Avg%3A%200.3%2C%20Max%3A%200.3%2C%20Diff%3A%200.2%2C%20Sum%3A%201.6%5D%5Cn%20%20%20%20%20%20%5BCode%20Root%20Scanning%20(ms)%3A%20Min%3A%200.0%2C%20Avg%3A%200.0%2C%20Max%3A%200.0%2C%20Diff%3A%200.0%2C%20Sum%3A%200.1%5D%5Cn%20%20%20%20%20%20%5BObject%20Copy%20(ms)%3A%20Min%3A%2015.2%2C%20Avg%3A%2015.5%2C%20Max%3A%2015.8%2C%20Diff%3A%200.5%2C%20Sum%3A%2093.2%5D%5Cn%20%20%20%20%20%20%5BTermination%20(ms)%3A%20Min%3A%200.0%2C%20Avg%3A%200.1%2C%20Max%3A%200.1%2C%20Diff%3A%200.1%2C%20Sum%3A%200.3%5D%5Cn%20%20%20%20%20%20%20%20%20%5BTermination%20Attempts%3A%20Min%3A%201%2C%20Avg%3A%20150.8%2C%20Max%3A%20196%2C%20Diff%3A%20195%2C%20Sum%3A%20905%5D%5Cn%20%20%20%20%20%20%5BGC%20Worker%20Other%20(ms)%3A%20Min%3A%200.0%2C%20Avg%3A%200.1%2C%20Max%3A%200.1%2C%20Diff%3A%200.1%2C%20Sum%3A%200.5%5D%5Cn%20%20%20%20%20%20%5BGC%20Worker%20Total%20(ms)%3A%20Min%3A%2030.8%2C%20Avg%3A%2030.8%2C%20Max%3A%2030.9%2C%20Diff%3A%200.1%2C%20Sum%3A%20185.0%5D%5Cn%20%20%20%20%20%20%5BGC%20Worker%20End%20(ms)%3A%20Min%3A%20509725354.2%2C%20Avg%3A%20509725354.2%2C%20Max%3A%20509725354.3%2C%20Diff%3A%200.1%5D%5Cn%20%20%20%5BCode%20Root%20Fixup%3A%200.2%20ms%5D%5Cn%20%20%20%5BCode%20Root%20Purge%3A%200.0%20ms%5D%5Cn%20%20%20%5BClear%20CT%3A%200.6%20ms%5D%5Cn%20%20%20%5BOther%3A%2016.6%20ms%5D%5Cn%20%20%20%20%20%20%5BChoose%20CSet%3A%200.0%20ms%5D%5Cn%20%20%20%20%20%20%5BRef%20Proc%3A%2010.4%20ms%5D%5Cn%20%20%20%20%20%20%5BRef%20Enq%3A%200.3%20ms%5D%5Cn%20%20%20%20%20%20%5BRedirty%20Cards%3A%200.1%20ms%5D%5Cn%20%20%20%20%20%20%5BHumongous%20Register%3A%200.0%20ms%5D%5Cn%20%20%20%20%20%20%5BHumongous%20Reclaim%3A%200.0%20ms%5D%5Cn%20%20%20%20%20%20%5BFree%20CSet%3A%201.4%20ms%5D%5Cn%20%20%20%5BEden%3A%206084.0M(6084.0M)-%3E0.0B(6084.0M)%20Survivors%3A%2060.0M-%3E60.0M%20Heap%3A%207811.1M(10.0G)-%3E1725.1M(10.0G)%5D%5CnHeap%20after%20GC%20invocations%3D19624%20(full%200)%3A%5Cn%20garbage-first%20heap%20%20%20total%2010485760K%2C%20used%201766479K%20%5B0x0000000540000000%2C%200x0000000540405000%2C%200x00000007c0000000)%5Cn%20%20region%20size%204096K%2C%2015%20young%20(61440K)%2C%2015%20survivors%20(61440K)%5Cn%20Metaspace%20%20%20%20%20%20%20used%2096904K%2C%20capacity%20100148K%2C%20committed%20101504K%2C%20reserved%201138688K%5Cn%20%20class%20space%20%20%20%20used%2011478K%2C%20capacity%2012106K%2C%20committed%2012416K%2C%20reserved%201048576K%5Cn%7D%5Cn%20%5BTimes%3A%20user%3D0.19%20sys%3D0.06%2C%20real%3D0.05%20secs%5D%5Cn2020-09-08T18%3A26%3A29.616%2B0800%3A%20509725.370%3A%20%5BGC%20concurrent-root-region-scan-start%5D%5Cn2020-09-08T18%3A26%3A29.617%2B0800%3A%20509725.370%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0667356%20seconds%2C%20Stopping%20threads%20took%3A%200.0006084%20seconds%5Cn2020-09-08T18%3A26%3A29.624%2B0800%3A%20509725.377%3A%20%5BGC%20concurrent-root-region-scan-end%2C%200.0075624%20secs%5D%5Cn2020-09-08T18%3A26%3A29.624%2B0800%3A%20509725.377%3A%20%5BGC%20concurrent-mark-start%5D%5Cn2020-09-08T18%3A26%3A29.745%2B0800%3A%20509725.498%3A%20%5BGC%20concurrent-mark-end%2C%200.1212810%20secs%5D%5Cn2020-09-08T18%3A26%3A29.745%2B0800%3A%20509725.499%3A%20Application%20time%3A%200.1284912%20seconds%5Cn2020-09-08T18%3A26%3A29.762%2B0800%3A%20509725.516%3A%20%5BGC%20remark%202020-09-08T18%3A26%3A29.762%2B0800%3A%20509725.516%3A%20%5BFinalize%20Marking%2C%200.0020710%20secs%5D%202020-09-08T18%3A26%3A29.764%2B0800%3A%20509725.518%3A%20%5BGC%20ref-proc2020-09-08T18%3A26%3A29.764%2B0800%3A%20509725.518%3A%20%5BSoftReference%2C%20244%20refs%2C%200.0005201%20secs%5D2020-09-08T18%3A26%3A29.765%2B0800%3A%20509725.518%3A%20%5BWeakReference%2C%202549%20refs%2C%200.0006340%20secs%5D2020-09-08T18%3A26%3A29.766%2B0800%3A%20509725.519%3A%20%5BFinalReference%2C%2034%20refs%2C%200.0003842%20secs%5D2020-09-08T18%3A26%3A29.766%2B0800%3A%20509725.519%3A%20%5BPhantomReference%2C%200%20refs%2C%20772%20refs%2C%200.0008726%20secs%5D2020-09-08T18%3A26%3A29.767%2B0800%3A%20509725.520%3A%20%5BJNI%20Weak%20Reference%2C%200.0002677%20secs%5D%2C%200.0028920%20secs%5D%202020-09-08T18%3A26%3A29.767%2B0800%3A%20509725.521%3A%20%5BUnloading%2C%200.0209432%20secs%5D%2C%200.0292943%20secs%5D%5Cn%20%5BTimes%3A%20user%3D0.10%20sys%3D0.03%2C%20real%3D0.03%20secs%5D%5Cn2020-09-08T18%3A26%3A29.792%2B0800%3A%20509725.546%3A%20Total%20time%20for%20which%20application%20threads%20were%20stopped%3A%200.0473635%20seconds%2C%20Stopping%20threads%20took%3A%200.0005978%20seconds%5Cn2020-09-08T18%3A26%3A29.793%2B0800%3A%20509725.546%3A%20Application%20time%3A%200.0001449%20seconds%5Cn2020-09-08T18%3A26%3A29.809%2B0800%3A%20509725.563%3A%20%5BGC%20cleanup%201797M-%3E1797M(10G)%2C%200.0051662%20secs%5D%5Cn%20%5BTimes%3A%20user%3D0.02%20sys%3D0.00%2C%20real%3D0.00%20secs%5D%22%2C%22heightLimit%22%3Atrue%2C%22margin%22%3Atrue%2C%22id%22%3A%22bT011%22%7D" data-language="shell">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-09</span><span class="cm-attribute">-08T18</span>:26:29.601<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.355: [SoftReference, <span class="cm-number">0</span> refs, <span class="cm-number">0</span>.0005530 secs]2020-09-08T18:26:29.602<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.355: [WeakReference, <span class="cm-number">651</span> refs, <span class="cm-number">0</span>.0003417 secs]2020-09-08T18:26:29.602<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.356: [FinalReference, <span class="cm-number">59425</span> refs, <span class="cm-number">0</span>.0084187 secs]2020-09-08T18:26:29.611<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.364: [PhantomReference, <span class="cm-number">0</span> refs, <span class="cm-number">0</span> refs, <span class="cm-number">0</span>.0007736 secs]2020-09-08T18:26:29.611<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.365: [JNI Weak Reference, <span class="cm-number">0</span>.0000406 secs], <span class="cm-number">0</span>.0485472 secs]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">   [Parallel Time: <span class="cm-number">31</span>.2 ms, GC Workers: <span class="cm-number">6</span>]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [GC Worker Start (ms): Min: <span class="cm-number">509725323</span>.3, Avg: <span class="cm-number">509725323</span>.4, Max: <span class="cm-number">509725323</span>.5, Diff: <span class="cm-number">0</span>.1]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Ext Root Scanning (ms): Min: <span class="cm-number">3</span>.8, Avg: <span class="cm-number">5</span>.3, Max: <span class="cm-number">11</span>.4, Diff: <span class="cm-number">7</span>.6, Sum: <span class="cm-number">31</span>.7]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Update RS (ms): Min: <span class="cm-number">3</span>.6, Avg: <span class="cm-number">9</span>.6, Max: <span class="cm-number">11</span>.0, Diff: <span class="cm-number">7</span>.3, Sum: <span class="cm-number">57</span>.7]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">         [Processed Buffers: Min: <span class="cm-number">256</span>, Avg: <span class="cm-number">319</span>.7, Max: <span class="cm-number">376</span>, Diff: <span class="cm-number">120</span>, Sum: <span class="cm-number">1918</span>]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Scan RS (ms): Min: <span class="cm-number">0</span>.1, Avg: <span class="cm-number">0</span>.3, Max: <span class="cm-number">0</span>.3, Diff: <span class="cm-number">0</span>.2, Sum: <span class="cm-number">1</span>.6]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Code Root Scanning (ms): Min: <span class="cm-number">0</span>.0, Avg: <span class="cm-number">0</span>.0, Max: <span class="cm-number">0</span>.0, Diff: <span class="cm-number">0</span>.0, Sum: <span class="cm-number">0</span>.1]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Object Copy (ms): Min: <span class="cm-number">15</span>.2, Avg: <span class="cm-number">15</span>.5, Max: <span class="cm-number">15</span>.8, Diff: <span class="cm-number">0</span>.5, Sum: <span class="cm-number">93</span>.2]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Termination (ms): Min: <span class="cm-number">0</span>.0, Avg: <span class="cm-number">0</span>.1, Max: <span class="cm-number">0</span>.1, Diff: <span class="cm-number">0</span>.1, Sum: <span class="cm-number">0</span>.3]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">         [Termination Attempts: Min: <span class="cm-number">1</span>, Avg: <span class="cm-number">150</span>.8, Max: <span class="cm-number">196</span>, Diff: <span class="cm-number">195</span>, Sum: <span class="cm-number">905</span>]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [GC Worker Other (ms): Min: <span class="cm-number">0</span>.0, Avg: <span class="cm-number">0</span>.1, Max: <span class="cm-number">0</span>.1, Diff: <span class="cm-number">0</span>.1, Sum: <span class="cm-number">0</span>.5]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [GC Worker Total (ms): Min: <span class="cm-number">30</span>.8, Avg: <span class="cm-number">30</span>.8, Max: <span class="cm-number">30</span>.9, Diff: <span class="cm-number">0</span>.1, Sum: <span class="cm-number">185</span>.0]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [GC Worker End (ms): Min: <span class="cm-number">509725354</span>.2, Avg: <span class="cm-number">509725354</span>.2, Max: <span class="cm-number">509725354</span>.3, Diff: <span class="cm-number">0</span>.1]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">   [Code Root Fixup: <span class="cm-number">0</span>.2 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">   [Code Root Purge: <span class="cm-number">0</span>.0 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">   [Clear CT: <span class="cm-number">0</span>.6 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">   [Other: <span class="cm-number">16</span>.6 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Choose CSet: <span class="cm-number">0</span>.0 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Ref Proc: <span class="cm-number">10</span>.4 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Ref Enq: <span class="cm-number">0</span>.3 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Redirty Cards: <span class="cm-number">0</span>.1 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Humongous Register: <span class="cm-number">0</span>.0 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Humongous Reclaim: <span class="cm-number">0</span>.0 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">      [Free CSet: <span class="cm-number">1</span>.4 ms]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">   [Eden: <span class="cm-number">6084</span>.0M(6084.0M)-&gt;0.0B(6084.0M) Survivors: <span class="cm-number">60</span>.0M-&gt;60.0M Heap: <span class="cm-number">7811</span>.1M(10.0G)-&gt;1725.1M(10.0G)]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">Heap after GC <span class="cm-def">invocations</span><span class="cm-operator">=</span><span class="cm-number">19624</span> (full <span class="cm-number">0</span>):
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"> garbage-first heap   total 10485760K, used 1766479K [0x0000000540000000, 0x0000000540405000, 0x00000007c0000000)
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">  region size 4096K, <span class="cm-number">15</span> young (61440K), <span class="cm-number">15</span> survivors (61440K)
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"> Metaspace       used 96904K, capacity 100148K, committed 101504K, reserved 1138688K
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">  class space    used 11478K, capacity 12106K, committed 12416K, reserved 1048576K
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content">}
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"> [Times: <span class="cm-def">user</span><span class="cm-operator">=</span><span class="cm-number">0</span>.19 <span class="cm-def">sys</span><span class="cm-operator">=</span><span class="cm-number">0</span>.06, <span class="cm-def">real</span><span class="cm-operator">=</span><span class="cm-number">0</span>.05 secs]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-09</span><span class="cm-attribute">-08T18</span>:26:29.616<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.370: [GC concurrent-root-region-scan-start]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-09</span><span class="cm-attribute">-08T18</span>:26:29.617<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.370: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0667356 seconds, Stopping threads took: <span class="cm-number">0</span>.0006084 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-09</span><span class="cm-attribute">-08T18</span>:26:29.624<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.377: [GC concurrent-root-region-scan-end, <span class="cm-number">0</span>.0075624 secs]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-09</span><span class="cm-attribute">-08T18</span>:26:29.624<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.377: [GC concurrent-mark-start]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-09</span><span class="cm-attribute">-08T18</span>:26:29.745<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.498: [GC concurrent-mark-end, <span class="cm-number">0</span>.1212810 secs]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-09</span><span class="cm-attribute">-08T18</span>:26:29.745<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.499: Application time: <span class="cm-number">0</span>.1284912 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-09</span><span class="cm-attribute">-08T18</span>:26:29.762<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.516: [GC remark <span class="cm-number">2020</span><span class="cm-attribute">-09</span><span class="cm-attribute">-08T18</span>:26:29.762<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.516: [Finalize Marking, <span class="cm-number">0</span>.0020710 secs] <span class="cm-number">2020</span><span class="cm-attribute">-09</span><span class="cm-attribute">-08T18</span>:26:29.764<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.518: [GC ref-proc2020-09-08T18:26:29.764<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.518: [SoftReference, <span class="cm-number">244</span> refs, <span class="cm-number">0</span>.0005201 secs]2020-09-08T18:26:29.765<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.518: [WeakReference, <span class="cm-number">2549</span> refs, <span class="cm-number">0</span>.0006340 secs]2020-09-08T18:26:29.766<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.519: [FinalReference, <span class="cm-number">34</span> refs, <span class="cm-number">0</span>.0003842 secs]2020-09-08T18:26:29.766<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.519: [PhantomReference, <span class="cm-number">0</span> refs, <span class="cm-number">772</span> refs, <span class="cm-number">0</span>.0008726 secs]2020-09-08T18:26:29.767<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.520: [JNI Weak Reference, <span class="cm-number">0</span>.0002677 secs], <span class="cm-number">0</span>.0028920 secs] <span class="cm-number">2020</span><span class="cm-attribute">-09</span><span class="cm-attribute">-08T18</span>:26:29.767<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.521: [Unloading, <span class="cm-number">0</span>.0209432 secs], <span class="cm-number">0</span>.0292943 secs]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"> [Times: <span class="cm-def">user</span><span class="cm-operator">=</span><span class="cm-number">0</span>.10 <span class="cm-def">sys</span><span class="cm-operator">=</span><span class="cm-number">0</span>.03, <span class="cm-def">real</span><span class="cm-operator">=</span><span class="cm-number">0</span>.03 secs]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-09</span><span class="cm-attribute">-08T18</span>:26:29.792<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.546: Total time <span class="cm-keyword">for</span> which application threads were stopped: <span class="cm-number">0</span>.0473635 seconds, Stopping threads took: <span class="cm-number">0</span>.0005978 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-09</span><span class="cm-attribute">-08T18</span>:26:29.793<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.546: Application time: <span class="cm-number">0</span>.0001449 seconds
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"><span class="cm-number">2020</span><span class="cm-attribute">-09</span><span class="cm-attribute">-08T18</span>:26:29.809<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">509725</span>.563: [GC cleanup 1797M-&gt;1797M(10G), <span class="cm-number">0</span>.0051662 secs]
</span></span><span class="lake-preview-line"><span class="lake-preview-codeblock-content"> [Times: <span class="cm-def">user</span><span class="cm-operator">=</span><span class="cm-number">0</span>.02 <span class="cm-def">sys</span><span class="cm-operator">=</span><span class="cm-number">0</span>.00, <span class="cm-def">real</span><span class="cm-operator">=</span><span class="cm-number">0</span>.00 secs]</span></span></pre>
</div>
</div>
</div>
<h1 id="iDFXM" data-lake-id="c94c818c63cb10b1ad93621f3205f1c6">总结</h1>
<p data-lake-id="fb016f2ecf1e966d4eae60fe239e1e63">至此，困扰长达一个多月的gc问题解决了，尽管没有找到FinalReference为什么突然增多的问题，但是通过另外的手段解决了生产的问题，根治了顽固的gc问题。通过整个过程，我们有以下收获</p>
<ol start="1" data-lake-id="87eeac2a340fbbfb475256f53c8ea81a">
<li data-lake-id="32de30334f3a2614261124dce53c819e">充分的了解了G1垃圾回收器的原理和细节，为我们以后排查问题打下基础</li>
<li data-lake-id="a8343ec7276d63c1dfb9b28cbaa3b10f">认识了g1的gc日志，这些日志密密麻麻，其实藏了很多关键信息，结合这1所学的知识，看起来也就不费力了，还是需要静下心来，耐心的去看</li>
<li data-lake-id="984ff586c6ed107fe7da2d490a0a44d0">再解决的过程中，我们顺便看了公司的中间的代码，替他们找到一个大bug.另外，我们也了解了apache httpclient的连接池的原理以及分析和看了他的源代码</li>
<li data-lake-id="995a7aab6af0983bae05664686e49e11">再次使用了heap分析工具mat，尽管未能定位到问题</li>
<li data-lake-id="932b9513720c80bb65ef5e96e6d9975f">-Djavax.net.ssl.sessionCacheSize=101的bug问题</li>
</ol>
]]></content:encoded>
			<wfw:commentRss>https://huster.top/htmls/745.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>生产FullGC问题排查</title>
		<link>https://huster.top/htmls/720.html</link>
		<comments>https://huster.top/htmls/720.html#respond</comments>
		<pubDate>Sun, 28 Jun 2020 08:13:08 +0000</pubDate>
		<dc:creator><![CDATA[龙安_任天兵]]></dc:creator>
				<category><![CDATA[Java学习]]></category>

		<guid isPermaLink="false">https://huster.top/?p=720</guid>
		<description><![CDATA[FullGC时间过长 &#160; 问题 突然来了一波gc时间过长的告警，类似下面这个，接着接二连三的来了很多 &#8230; <a href="https://huster.top/htmls/720.html" class="more-link">继续阅读<span class="screen-reader-text">“生产FullGC问题排查”</span></a>]]></description>
				<content:encoded><![CDATA[<h1>FullGC时间过长</h1>
<p>&nbsp;</p>
<div class="lake-content-editor-core lake-engine lake-typography-classic" data-lake-element="root" data-selection-180554="%7B%22path%22%3A%5B%5B92%2C0%2C4%5D%2C%5B92%2C0%2C4%5D%5D%2C%22uuid%22%3A%22180554%22%2C%22active%22%3Atrue%7D">
<h1 id="qzE4Q" style="padding: 7px 0px; margin: 0px; font-weight: bold; font-size: 28px; line-height: 36px;" data-lake-id="23466eb074f518106519e48041dcbfbc">问题</h1>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="fb2a5ed1334fa4fc14d39ef94751d2d5">突然来了一波gc时间过长的告警，类似下面这个，接着接二连三的来了很多机器都是同样的</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="fb2a5ed1334fa4fc14d39ef94751d2d5">情况，看来集群同时发生了FullGC, 而且时间还不短。</p>
</div>
<p data-lake-id="fb2a5ed1334fa4fc14d39ef94751d2d5"><span id="more-720"></span></p>
<div class="lake-content-editor-core lake-engine lake-typography-classic" data-lake-element="root" data-selection-180554="%7B%22path%22%3A%5B%5B92%2C0%2C4%5D%2C%5B92%2C0%2C4%5D%5D%2C%22uuid%22%3A%22180554%22%2C%22active%22%3Atrue%7D">
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="ba09d0a0fac50dc3dc4d19644d8111a0"><a href="https://huster.top/wp-content/uploads/2020/06/1.png"><img class="alignnone size-full wp-image-724" src="https://huster.top/wp-content/uploads/2020/06/1.png" alt="" width="463" height="511" /></a></p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="d1e4f9bc7064e7585bfb2d7389136d9a"><a href="https://huster.top/wp-content/uploads/2020/06/2-2.png"><img class="alignnone size-full wp-image-728" src="https://huster.top/wp-content/uploads/2020/06/2-2.png" alt="" width="746" height="170" /></a></p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="f12de10e6a0999082df1a65692ccf1ff">通常来说，fullGC也不是什么问题，即使你的GC时间超过了500ms，也没有影响业务, 没有上游业务的超时告警。但是你看看，这个old区的内存max最大设置了7个G, 而且我们每周至少发布一次，还发生了fullGC，就有点说不过去了，值得好好看一下. 有这么大的空间要GC，当然超过了500ms也不足为奇了.</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="6d47003f0b7653742770eba079725170">2020-06-14T21:11:03.623+0800: 347435.070: [GC (CMS Final Remark) [YG occupancy: 1425258 K (3145472 K)]2020-06-14T21:11:03.624+0800: 347435.071: [Rescan (parallel) , 0.2118361 secs]2020-06-14T21:11:03.836+0800: 347435.283: [weak refs processing, 0.3505888 secs]2020-06-14T21:11:04.186+0800: 347435.634: [class unloading, 0.0493179 secs]2020-06-14T21:11:04.236+0800: 347435.683: [scrub symbol table, 0.0162566 secs]2020-06-14T21:11:04.252+0800: 347435.699: [scrub string table, 0.0022326 secs][1 CMS-remark: 4334730K(6990848K)] 5759989K(10136320K), 0.6480160 secs] [Times: user=1.97 sys=0.00, real=0.65 secs]</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="76b3014e114231eb7105c707c3d6afcc">主要时间耗费在了scan和weak refs processing, 说明里面的对象非常多</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="b132c337d2a1a4e23410c32d40b8c2e2">一打开流量，old区就增加，一直到full gc. 一停止流量，old区就基本不变，这个太奇怪了。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="7136a11e9f6c272d727c332514776ca1"><span class="lake-card-margin-top lake-card-margin-bottom" data-card-type="inline" data-lake-card="image"><a href="https://huster.top/wp-content/uploads/2020/06/3.png"><img class="alignnone size-full wp-image-729" src="https://huster.top/wp-content/uploads/2020/06/3.png" alt="" width="598" height="183" /></a></span></p>
<h1 id="OYwXB" style="padding: 7px 0px; margin: 0px; font-weight: bold; font-size: 28px; line-height: 36px;" data-lake-id="8ec2cf89768a5fcca7ee6d4e56a3ee1b">heap dump分析开始推测</h1>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="578a7e771e174212c688b934fa81201c">要分析gc问题，就离不开heap dump， 将机器拉下线，然后 jmap -dump:format=b,file=xxxxxx.hprof pid</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="0c3917228bf50fa248fe508626bdb0e0">进行dump，把dump文件压缩一下，不压缩有3个G, 压缩完只有400M，压缩比还是非常高的。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="df56d928d1bedfeff1615a134580bae1">前几次没有压缩，使用sz从服务器上download，没有断点续传，一掉线就得从头开始。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="53416bf2a133903ceeacda027ff3501b">继续看dump文件，发现里面有一些可疑的地方。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="10bc82abc0c27023811f2d8f88fc0942">使用mat打开dump文件，使用Leak Suspects:功能，提示有三个问题。都是java自身的类，这就比较头大了。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="61312a27bb5d76013f2f958630437f53">我dump了很多次，挨个分析，</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="52725384ba0f2e7f6ce94905635d0a35">dump1的提示</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="03ce0249ceea2680142ff746038940db"><a href="https://huster.top/wp-content/uploads/2020/06/4.png"><img class="alignnone size-full wp-image-730" src="https://huster.top/wp-content/uploads/2020/06/4.png" alt="" width="621" height="619" /></a></p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="990b0019e0128897bba401a2606980b3">dump2的提示</p>
<p data-lake-id="990b0019e0128897bba401a2606980b3"><a href="https://huster.top/wp-content/uploads/2020/06/5.png"><img class="alignnone size-full wp-image-731" src="https://huster.top/wp-content/uploads/2020/06/5.png" alt="" width="633" height="463" /></a></p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="9d4272a577ba78a2f9d397613a577027">dump3的提示</p>
<p data-lake-id="9d4272a577ba78a2f9d397613a577027"><a href="https://huster.top/wp-content/uploads/2020/06/6.png"><img class="alignnone size-full wp-image-732" src="https://huster.top/wp-content/uploads/2020/06/6.png" alt="" width="638" height="617" /></a></p>
<h2 id="1CPbD" style="padding: 7px 0px; margin: 0px; font-weight: bold; font-size: 24px; line-height: 32px;" data-lake-id="07e0ddc7a09b0ab00578a5f36a1cef16">java.lang.Thread</h2>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="5334eae8bf21ce29e2e38ac80ca20c7e">每个dump文件里都有java.lang.Thread的这个东西，于是打开tree看看，终于看到了熟悉的我们自己写的类，原来这是一个配置文件的类，他里面有很多的配置，有些配置本身比较大，是json对象，导致了占用了很多空间。再仔细看看，持有的这个对象在所有线程里都是同一个，内存地址一样的。所以虽然thread占据了空间，但是其实是同一个对象的重复统计了.而且可以明显的看到，每个线程的hetained heap大小基本一致, 所以这个暂时就先排除了。</p>
<h2 id="Lbdxo" style="padding: 7px 0px; margin: 0px; font-weight: bold; font-size: 24px; line-height: 32px;" data-lake-id="a45bfcba86c64ed34953f50342fd444d">java.lang.ref.Finalizer</h2>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="ed3ce9e2a10743817c38a353de2dae62">那么是不是这个? java.lang.ref.Finalizer</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="5aefa8b8380dee7279f9fcd50f2894b3">打开tree进一步分析，发现java.lang.ref.Finalizer占了很多的内存。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="52ad3243fccbd1257d75d7fcb0a35619"><span class="lake-card-margin-top lake-card-margin-bottom" data-card-type="inline" data-lake-card="image"><a href="https://huster.top/wp-content/uploads/2020/06/76.png"><img class="alignnone size-full wp-image-733" src="https://huster.top/wp-content/uploads/2020/06/76.png" alt="" width="718" height="498" /></a></span></p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="2568f62636d5ed1f3294dc560c95c1d4">接着使用这个功能 ， show retained set</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="a78828decaa77f0c91335cfc167f9f93"><a href="https://huster.top/wp-content/uploads/2020/06/8.png"><img class="alignnone size-full wp-image-734" src="https://huster.top/wp-content/uploads/2020/06/8.png" alt="" width="746" height="271" /></a></p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="7e20eacf061749ec7ca6a1f706b1ac13">打开看到了和java.net.SocksSocketImpl发生了关联</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="a7d77f4fab88e17afa9979d8b5c140f4"><a href="https://huster.top/wp-content/uploads/2020/06/9.png"><img class="alignnone size-full wp-image-735" src="https://huster.top/wp-content/uploads/2020/06/9.png" alt="" width="694" height="551" /></a></p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="a73780db20152583002665a76802f038">于是，一顿Google后了解到，Finalizer是一个优先级很低的资源回收线程，一般是实现了Object.finalize的类，会被这个线程给调用，由于他的优先级很低，所以轮不到他调度，要被调用的对象就被丢到队列里越积越多。而一般用户自己是不会去实现finalize这个方法的，恰恰SocksSocketImpl就实现了这个方法。这个是为了防止内存泄露，有的人忘记close，他会在SocksSocketImpl的finalize帮你去关闭资源。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="342016b7ee84919fb9af02d7be84e220">这样的文章很多，可以搜 java.lang.ref.Finalizer memory leak 关键字.</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="26ba749915a71a3808abbd76e71e4405">恰好，我们的系统作为一个服务端，就是一个线程很吃紧的服务，因为各种原因，应用一共开了接近3000个线程，导致了Finalizer肯定是被调度不到了，也就造成了内存不断的增加，最后导致fullGC.</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="06e1f181851ca0d3b0d2afc116402b28">感觉很像。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="325c68b52b33ffa3d08bdc863a582842">到底是不是这个东西呢？ 我分别dump了两次，一次是未接流量前，然后打开流量跑一个小时，再进行对比，对比发现Finalizer增加的非常快，看来是这个东西无疑了</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="4010ca35b7fc7f509ca8dc2ee9ada6d7"><a href="https://huster.top/wp-content/uploads/2020/06/10.png"><img class="alignnone size-full wp-image-736" src="https://huster.top/wp-content/uploads/2020/06/10.png" alt="" width="746" height="500" /></a></p>
<h1 id="IxUe0" style="padding: 7px 0px; margin: 0px; font-weight: bold; font-size: 28px; line-height: 36px;" data-lake-id="28a8dd4b1ae0ab026bfab581d66b2d64">寻找真凶</h1>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="ed16c449a6e00e851cac7aab74f49183">原理和推测我们基本搞清楚了，也算有了一个方向，那么我们就要寻找，到底是谁用了SocksSocketImpl这个东西，并且没有手动的close，放任他内存泄露呢？</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="c000fc63cf2f60bfe63a932050cfd253">这些都是jdk自己的类，而且是第三方的jar包调用的，不是业务代码，在代码里根本找不到关联。通过搜索SocksSocketImpl的调用方，根本关联不起来。这就非常头大了。</p>
<h2 id="EfnFH" style="padding: 7px 0px; margin: 0px; font-weight: bold; font-size: 24px; line-height: 32px;" data-lake-id="ea6ab92d804497d61bca75bb95191698">怀疑是不是内部的定时任务</h2>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="203d82d8eb3064ea6c1442fdd3b64f7e">看到代码里有两个定时任务，是从hdfs拉取模型数据的，最开始是怀疑这个东西，如果他没有用线程池，每次都发起新的连接，然后又不关闭的话，应该是会导致内存泄露的，能够和我们的分析对的上号。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="95793160c9e7aa21dddb465d972cbb91">但是奇怪的是，流量停止了之后为什么就不增加了呢？ 而流量停止了，我们的定时任务实际上仍然是在执行的。这个有点悖论，讲不通。</p>
<h2 id="VMLU3" style="padding: 7px 0px; margin: 0px; font-weight: bold; font-size: 24px; line-height: 32px;" data-lake-id="d303d6b38e3cd3a9f2bdf8c1e2382156">使用Arthas大杀器继续寻找真凶</h2>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="9790ee7b19de6c4752268f33b1a2be2f">将流量拉下线之后，我们使用Arthas这个大杀器。这个是使用了javaaent的技术，注入到原有的代码里，跟踪代码的运行情况的。我们使用trace功能，trace一下到底是谁new SocksSocketImpl这个东西。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="9bc8f0f33ab432320a6781200a27d21b">trace java.net.SocksSocketImpl *init* . 最开始用构造函数SocksSocketImpl不成功，使用sm java.net.SocksSocketImpl打开类里面加载的到底是个什么东西，发现函数不是SocksSocketImpl而是叫init.</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="61cffd3f416f4b79a16795ef4de415f9"><a href="https://huster.top/wp-content/uploads/2020/06/11.png"><img class="alignnone size-full wp-image-737" src="https://huster.top/wp-content/uploads/2020/06/11.png" alt="" width="746" height="448" /></a></p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="89b15a2b846a456a1417cb6de11f1932">虽然没啥有用的信息，但是找到了一条关键的线索: commons-pool-evictor-thread, 又去Google发现是redis client使用的commons-pool线程池引进来的。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="763c68613dc7783ae992bb1d239fe9f2">然后打开这个线程池的类，再去搜哪里用到了他，依然是搜不到的，再次陷入了僵局。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="256783c66e5265dcfcfc8eae17b76188">jstack把线程打出来，依然找不到任何线索，那么这个东西到底是如何work的呢？</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="8bfd69491e3261a3c926adbd5a9bf753"><a href="https://huster.top/wp-content/uploads/2020/06/12.png"><img class="alignnone size-full wp-image-738" src="https://huster.top/wp-content/uploads/2020/06/12.png" alt="" width="746" height="201" /></a></p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="ea28d8168b3aefd15798c3a434f8d6fb">本地debug开启，打开断点，停在断点的时候，可以看到调用的堆栈。发现果然是redis拉起来的，这是一个定时任务，从evictor这个单词可以看出，这个东西就是清除空闲线程作用的。这就很奇怪了，清楚空闲的线程跟SocksSocketImpl是如何关联上的呢？ 代码又不能搜索被谁用的，太麻烦了。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="2bbb5973c52c239972c9daef15001c7f">既然是定时程序，那么肯定也就跟流量无关了，本地也可以触发。于是把SocksSocketImpl打满了断点，</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="0477bea52f43a2aa68db7b1372d05775"><a href="https://huster.top/wp-content/uploads/2020/06/13.png"><img class="alignnone size-full wp-image-739" src="https://huster.top/wp-content/uploads/2020/06/13.png" alt="" width="387" height="323" /></a></p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="7d3448a481a801c542c490dd64eb34a2">总算捕获到了这个断点，然后从idea的调用栈里面去寻找。理清楚了他们之间的关系。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="e0e5dfbe6599784b2b6200e76c6d0fd6">原来系统起来的时候，会去初始化redis client, redis.clients.jedis.connect这个类被初始化的时候，就会拉起一个定时任务来清楚空闲的线程，线程名字就叫做 commons-pool-evictor-thread， 接着这线程开始工作。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="ec7248ee01ea8f5cde45fd1175b6ffb2">这个线程是属于commons-pool这个池化的jar包里的内容，跟业务其实是不相关的。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="3142e7575210089924e7e281da9a2173">这个线程的入口在</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="0bcffc34a4b83bc5959b4ef42489c85d">org.apache.commons.pool2.impl.BaseGenericObjectPool.Evictor.run</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="2e16a4259e6cd2e4e7735a291a319874">这个run干了两件事， 先evict清楚空闲线程，再重新创建.</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="016365f5cd4a8c0a3e4e26d87cfdabea"><a href="https://huster.top/wp-content/uploads/2020/06/14.png"><img class="alignnone size-full wp-image-740" src="https://huster.top/wp-content/uploads/2020/06/14.png" alt="" width="746" height="477" /></a></p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="e8b66697415a62c61d6d263e3e6b970f">如何去清楚空闲线程呢？</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="f4f0f0ff0779b2ec29111efef2c34152">    evict = evictionPolicy.evict(evictionConfig, underTest,</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="09994cc6657d368eb24116a46f26b619">                               idleObjects.size());</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="c4401f72ed4559693f12c96e9e1863fd">在这个方法里，这个underTest记录了最后使用的时间，然后和当前的时间比较，如果超过了空闲的时间（有默认配置）, 就会把他干掉。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="ada3c8216033c2e2fc11459352ea6081">org.apache.commons.pool2.impl.GenericObjectPool.ensureIdle这个方法就是重新拉起一个连接，具体实现在</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="46f6baf18fcc1c3fc46a962e7346f9d6">JedisFactory.makeObject里的 jedis.connect();这行代码，redis.clients.jedis方法如下</p>
<div id="hbPV8" class="lake-card-margin" data-card-type="block" data-lake-card="codeblock" data-language="java">
<div class="lake-codeblock-content" style="border: 1px solid #e8e8e8; max-width: 750px; color: #595959; margin: 0px; padding: 0px; background: #f9f9f9;">
<div class="" style="color: #595959; margin: 0px; padding: 16px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">
<pre class="cm-s-default" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">public</span> <span class="cm-type" style="color: #22863a; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">void</span> <span class="cm-def" style="color: #005cc5; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">connect</span>() {
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">if</span> (<span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">!</span><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">isConnected</span>()) {
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">try</span> {
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">socket</span> <span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">=</span> <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">new</span> <span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">Socket</span>();
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">socket</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">setReuseAddress</span>(<span class="cm-atom" style="color: #990055; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">true</span>);
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">socket</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">setKeepAlive</span>(<span class="cm-atom" style="color: #990055; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">true</span>);
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">socket</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">setTcpNoDelay</span>(<span class="cm-atom" style="color: #990055; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">true</span>);
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">socket</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">setSoLinger</span>(<span class="cm-atom" style="color: #990055; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">true</span>, <span class="cm-number" style="color: #005cc5; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">0</span>);
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">socket</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">connect</span>(<span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">new</span> <span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">InetSocketAddress</span>(<span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">host</span>, <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">port</span>), <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">connectionTimeout</span>);
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">socket</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">setSoTimeout</span>(<span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">soTimeout</span>);
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">if</span> (<span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">ssl</span>) {
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">if</span> (<span class="cm-atom" style="color: #990055; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">null</span> <span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">==</span> <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">sslSocketFactory</span>) {
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">sslSocketFactory</span> <span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">=</span> (<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">SSLSocketFactory</span>)<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">SSLSocketFactory</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">getDefault</span>();
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">                    }
</span></span>
<span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">socket</span> <span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">=</span> <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">sslSocketFactory</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">createSocket</span>(<span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">socket</span>, <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">host</span>, <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">port</span>, <span class="cm-atom" style="color: #990055; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">true</span>);
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">if</span> (<span class="cm-atom" style="color: #990055; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">null</span> <span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">!=</span> <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">sslParameters</span>) {
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">                        ((<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">SSLSocket</span>)<span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">socket</span>).<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">setSSLParameters</span>(<span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">sslParameters</span>);
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">                    }
</span></span>
<span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">if</span> (<span class="cm-atom" style="color: #990055; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">null</span> <span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">!=</span> <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">hostnameVerifier</span> <span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">&amp;&amp;</span> <span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">!</span><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">hostnameVerifier</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">verify</span>(<span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">host</span>, ((<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">SSLSocket</span>)<span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">socket</span>).<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">getSession</span>())) {
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-type" style="color: #22863a; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">String</span> <span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">message</span> <span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">=</span> <span class="cm-type" style="color: #22863a; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">String</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">format</span>(<span class="cm-string" style="color: #669900; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">"The connection to '%s' failed ssl/tls hostname verification."</span>, <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">host</span>);
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">throw</span> <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">new</span> <span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">JedisConnectionException</span>(<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">message</span>);
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">                    }
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">                }
</span></span>
<span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">outputStream</span> <span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">=</span> <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">new</span> <span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">RedisOutputStream</span>(<span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">socket</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">getOutputStream</span>());
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">inputStream</span> <span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">=</span> <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">new</span> <span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">RedisInputStream</span>(<span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">socket</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">getInputStream</span>());
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">            } <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">catch</span> (<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">IOException</span> <span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">var2</span>) {
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">broken</span> <span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">=</span> <span class="cm-atom" style="color: #990055; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">true</span>;
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">throw</span> <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">new</span> <span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">JedisConnectionException</span>(<span class="cm-string" style="color: #669900; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">"Failed connecting to host "</span> <span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">+</span> <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">host</span> <span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">+</span> <span class="cm-string" style="color: #669900; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">":"</span> <span class="cm-operator" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">+</span> <span class="cm-keyword" style="color: #d73a49; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">this</span>.<span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">port</span>, <span class="cm-variable" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">var2</span>);
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">            }
</span></span><span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">        }
</span></span>
<span class="lake-preview-line" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><span class="lake-preview-codeblock-content" style="color: #595959; margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);">    }
</span></span></pre>
</div>
</div>
</div>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="3d2f7b6cc66d97ddbbc81a5a41017835">可以清楚的看到是 new Socket();打开了一个连接，而因为是连接池的原因是不能关闭的。</p>
<h2 id="TZOeu" style="padding: 7px 0px; margin: 0px; font-weight: bold; font-size: 24px; line-height: 32px;" data-lake-id="c0196a19e771e7bc6363ee69bb1bdfdb">找到问题</h2>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="5f728301bdad5f09aa65b66897e9163f">最终我们知道了， 确实redis client导致了不断的去new Socket(). 最开始走了弯路是因为，我问了负责的开发，我们的系统是没有用redis的。那为什么会出现redis client呢？ 原因是我们的代码的算法模块来自于以前叫gateway的应用，这个应用依赖了redis，迁移过来的时候没有删除。因为单单删除application.yml里的redis的配置，系统起不来，只好保留了。</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="8c11939d99a34a456b74e7b9464af819">仔细来看，其实是因为pom.xml一旦引入了redis-spring-boot的依赖，他就会尝试初始化一个redis的client出来，如果application.yml里少了redis的配置，那当然是起不来的。</p>
<h1 id="FnlSo" style="padding: 7px 0px; margin: 0px; font-weight: bold; font-size: 28px; line-height: 36px;" data-lake-id="9b4e1db1b26bdb833a13f65256256423">验证</h1>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="33bc8fa38ea70c98279a462e5f8f21d1">还是找这台机器，修改配置，删除redis-spring-boot的jar包重启应用进行观察. 首先old区的增长没有那么快了</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="46b1c6b901ad06c8d17be338ffecd44b"><a href="https://huster.top/wp-content/uploads/2020/06/15.png"><img class="alignnone size-full wp-image-741" src="https://huster.top/wp-content/uploads/2020/06/15.png" alt="" width="603" height="828" /></a></p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="5e45d1caadc55ffe5cccf4a92ace8680">别的机器是这样的</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="3ea333188a60b4a46b510095d3738568"><a href="https://huster.top/wp-content/uploads/2020/06/16.png"><img class="alignnone size-full wp-image-742" src="https://huster.top/wp-content/uploads/2020/06/16.png" alt="" width="621" height="827" /></a></p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="128da665398d3b8044205ce0f1062747">首先old区增长没有这么快了，另外就是young区gc完了之后，释放了更多的内存，说明更多的对象在youngGC的时候就已经清理掉了.</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="c6d513754e6b3a59a5b74cfa587a93c5">还需要更长时间，更多的观察数据，发布前最近7天的数据</p>
<p style="font-size: 14px; color: #262626; line-height: 1.74; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;" data-lake-id="d4f61c2f0c99d73a2778485821e52085"><a href="https://huster.top/wp-content/uploads/2020/06/17.png"><img class="alignnone size-full wp-image-743" src="https://huster.top/wp-content/uploads/2020/06/17.png" alt="" width="746" height="222" /></a></p>
</div>
<p><!--more--></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
]]></content:encoded>
			<wfw:commentRss>https://huster.top/htmls/720.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>flink读取kafka数据未能触发watermark</title>
		<link>https://huster.top/htmls/713.html</link>
		<comments>https://huster.top/htmls/713.html#respond</comments>
		<pubDate>Wed, 05 Feb 2020 10:33:25 +0000</pubDate>
		<dc:creator><![CDATA[龙安_任天兵]]></dc:creator>
				<category><![CDATA[flink]]></category>

		<guid isPermaLink="false">https://huster.top/?p=713</guid>
		<description><![CDATA[过年被病毒闹的出不了门，就顺带着把flink秒级统计的逻辑写了一下，逻辑很简单，就是从kafka消费数据，然后 &#8230; <a href="https://huster.top/htmls/713.html" class="more-link">继续阅读<span class="screen-reader-text">“flink读取kafka数据未能触发watermark”</span></a>]]></description>
				<content:encoded><![CDATA[<p>过年被病毒闹的出不了门，就顺带着把flink秒级统计的逻辑写了一下，逻辑很简单，就是从kafka消费数据，然后select count(*) from xxx group by xxx来一秒产出一个打点。程序代码非常简单</p>
<p><span id="more-713"></span></p>
<p>```java</p>
<pre>StreamExecutionEnvironment bsEnv = StreamExecutionEnvironment.getExecutionEnvironment();
EnvironmentSettings bsSettings = EnvironmentSettings.newInstance().useBlinkPlanner().inStreamingMode().build();
StreamTableEnvironment bsTableEnv = StreamTableEnvironment.create(bsEnv, bsSettings);
bsEnv.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);
//并发数量小于等于kafka的partition数量,否则不会触发水位线
bsEnv.setParallelism(1);
//get input from kafka
String[] fieldNamesOriginal = new String[]{"i","t","op"};
TypeInformation[] typesOriginal = new TypeInformation[]{Types.STRING(), Types.JAVA_BIG_DEC(), Types.STRING()};
Properties properties = new Properties();
properties.setProperty("bootstrap.servers", "xxxx.com:9200");
properties.setProperty("group.id", "xxxxxxx");
//主动提交offset,不利用flink的job
properties.put("enable.auto.commit", "true");
properties.put("auto.commit.interval.ms", "1000");
FlinkKafkaConsumer011&lt;Row&gt; kafkaConsumer011 = new FlinkKafkaConsumer011&lt;&gt;("xxxxxxxx",
        new JsonRowDeserializationSchema(new RowTypeInfo(typesOriginal, fieldNamesOriginal)), properties);
kafkaConsumer011.setStartFromLatest();
DataStream&lt;Row&gt; streamSource = bsEnv
        .addSource(kafkaConsumer011)
        .uid("from_kafka_topic_is");
TypeInformation[] returnTypeTmp = new TypeInformation[]{Types.STRING(), Types.SQL_TIME(), Types.STRING()};
DataStream&lt;Row&gt; dataStreamWithTime = streamSource.map(new MapFunction&lt;Row, Row&gt;() {
    @Override
    public Row map(Row value) throws Exception {
        //SimpleDateFormat simpleDateFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        Row row = new Row(3);
        BigDecimal time = (BigDecimal)value.getField(1);
        row.setField(0, value.getField(0));
        row.setField(1, new Time(time.longValue()));
        row.setField(2, value.getField(2));
        return row;
    }
})
        .returns(new RowTypeInfo(returnTypeTmp, fieldNamesOriginal))
        .uid("add_time")
        .assignTimestampsAndWatermarks(new BoundedOutOfOrdernessTimestampExtractor&lt;Row&gt;(org.apache.flink.streaming.api.windowing.time.Time.seconds(2)) {
            @Override
            public long extractTimestamp(Row element) {
                return ((Time)element.getField(1)).getTime();
            }
        });
bsTableEnv.registerDataStream("_source_table", dataStreamWithTime, "i,t,op, rowtime.rowtime");
bsTableEnv.connect(new Kafka()
        .version("0.11")
        .topic("s-log")
        .property("bootstrap.servers", "abc.com:9200")
        .startFromEarliest())
        .withFormat(new Json().jsonSchema("{\"type\":\"object\",\"properties\":{\"index_name\":{\"type\":\"string\"},\"event_time_log\":{\"type\":\"string\"},\"op_type\":{\"type\":\"string\"},\"count_result\":{\"type\":\"number\"}}}"))
        .withSchema(new Schema()
                .field("index_name", Types.STRING())
                .field("event_time_log", Types.STRING())
                .field("op_type", Types.STRING())
                .field("count_result", Types.LONG()))
        .inAppendMode()
        .registerTableSink("operator_log_result");
bsTableEnv.sqlUpdate("insert into operator_log_result " +
        "select  i as index_name,  DATE_FORMAT(TUMBLE_END(rowtime, INTERVAL '1' SECOND), 'yyyy-MM-dd HH:mm:ss') as event_time_log, op as op_type, count(op) as count_result " +
        "from _source_table group by TUMBLE(rowtime, INTERVAL '1' SECOND) , i, op");
bsEnv.execute("data-metrics");




</pre>
<p>代码如上，非常简单，输入的数据类似于</p>
<p>```json</p>
<p class="p1"><span class="s1">{"t":1580896327330,"st":"DIRECT","i":"hitch_passenger_order_2020_01_22_23_50_40","op":"es_sink","id":",guid:15756341902141200002900","ut":",order_update_time:2020-02-05 17:52:07.190435","msg":"","rId":"0.1.1.1"}</span></p>
<p class="p1"><span class="s1">{"t":1580896327831,"st":"DIRECT","i":"hitch_passenger_order_2020_01_22_23_50_40","op":"es_sink","id":",guid:15756341902141200002900","ut":",order_update_time:2020-02-05 17:52:07.687468","msg":"","rId":"0.1.1.1"}</span></p>
<p class="p1"><span class="s1">{"t":1580896328131,"st":"DIRECT","i":"hitch_passenger_order_2020_01_22_23_50_40","op":"es_sink","id":",guid:15756341902141200002900","ut":",order_update_time:2020-02-05 17:52:08.047474","msg":"","rId":"0.1.1.1"}</span></p>
<p>&nbsp;</p>
<p>然而，死活就是无法输出正确的统计数据。但是当我把setParallelism并发设置为1的时候，就能正常输出统计数据。太神奇了，为什么跟并发度有关系呢？</p>
<p>于是我在本地打开了跟踪调试功能，我发现问题出在StatusWatermarkValve这个类里，这个类的这个方法是这么写的</p>
<p>```java</p>
<pre>private void findAndOutputNewMinWatermarkAcrossAlignedChannels() {
   long newMinWatermark = Long.MAX_VALUE;
   boolean hasAlignedChannels = false;

   // determine new overall watermark by considering only watermark-aligned channels across all channels
   for (InputChannelStatus channelStatus : channelStatuses) {
      if (channelStatus.isWatermarkAligned) {
         hasAlignedChannels = true;
         newMinWatermark = Math.min(channelStatus.watermark, newMinWatermark);
      }
   }

   // we acknowledge and output the new overall watermark if it really is aggregated
   // from some remaining aligned channel, and is also larger than the last output watermark
   if (hasAlignedChannels &amp;&amp; newMinWatermark &gt; lastOutputWatermark) {
      lastOutputWatermark = newMinWatermark;
      outputHandler.handleWatermark(new Watermark(lastOutputWatermark));
   }
}</pre>
<p>这个方法跟踪调试，正常的时候是这样的也是比较符合我们预期的，到点了就该触发了。</p>
<p><a href="https://huster.top/wp-content/uploads/2020/02/b1.png"><img class="alignnone size-full wp-image-714" src="https://huster.top/wp-content/uploads/2020/02/b1.png" alt="" width="2432" height="474" /></a></p>
<p>而不正常的时候，多个并发的时候，是这样的</p>
<p><a href="https://huster.top/wp-content/uploads/2020/02/b2.png"><img class="alignnone size-full wp-image-715" src="https://huster.top/wp-content/uploads/2020/02/b2.png" alt="" width="2384" height="982" /></a></p>
<p>可以看到其他的subtask取到的watermark是一个负值，也就是初始值。</p>
<p>&nbsp;</p>
<p>这个时候flink怎么处理的呢？根据刚刚的代码，他会取并发里面最小的一个值作为watermark，也就是那个最小的long型值。</p>
<p>然后一比较，跟默认值等的，不满足触发的条件，也就未能触发事件了。</p>
<p>看到一篇文章是这么写的</p>
<p><a href="https://huster.top/wp-content/uploads/2020/02/a3.jpg"><img class="alignnone size-full wp-image-716" src="https://huster.top/wp-content/uploads/2020/02/a3.jpg" alt="" width="1518" height="1400" /></a></p>
<p>&nbsp;</p>
<p>文章引用： https://www.jianshu.com/p/753e8cf803bb</p>
<p>&nbsp;</p>
<p>我感觉是flink的代码不合理导致的，至此，困扰我多日的一个问题终于有了答案。</p>
]]></content:encoded>
			<wfw:commentRss>https://huster.top/htmls/713.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>flink使用时间戳作为起始offset消费kafka的问题</title>
		<link>https://huster.top/htmls/708.html</link>
		<comments>https://huster.top/htmls/708.html#respond</comments>
		<pubDate>Mon, 21 Oct 2019 15:59:05 +0000</pubDate>
		<dc:creator><![CDATA[龙安_任天兵]]></dc:creator>
				<category><![CDATA[flink]]></category>

		<guid isPermaLink="false">https://huster.top/?p=708</guid>
		<description><![CDATA[代码如下 private static voidtest2()throwsException {     En &#8230; <a href="https://huster.top/htmls/708.html" class="more-link">继续阅读<span class="screen-reader-text">“flink使用时间戳作为起始offset消费kafka的问题”</span></a>]]></description>
				<content:encoded><![CDATA[<div>代码如下</div>
<div></div>
<div></div>
<div>private static voidtest2()throwsException {</div>
<div>    EnvironmentSettings fsSettings = EnvironmentSettings.newInstance().useOldPlanner().inStreamingMode().build();</div>
<div>   StreamExecutionEnvironment fsEnv = StreamExecutionEnvironment.getExecutionEnvironment();</div>
<div>   StreamTableEnvironment tttt = StreamTableEnvironment.create(fsEnv,fsSettings);</div>
<div>   Properties properties =newProperties();</div>
<div>   properties.setProperty("bootstrap.servers","localhost:9092");</div>
<div>    properties.setProperty("<a href="http://group.id/">group.id</a>","test"+ System.currentTimeMillis());</div>
<div>   FlinkKafkaConsumer011&lt;String&gt; kafkaConsumer011 =newFlinkKafkaConsumer011&lt;String&gt;("test", newSimpleStringSchema(),properties);</div>
<div>   kafkaConsumer011.setStartFromTimestamp(System.currentTimeMillis());</div>
<div>   DataStream&lt;String&gt; stream = fsEnv.addSource(kafkaConsumer011);</div>
<div>   stream.print();</div>
<div>   fsEnv.execute("test");</div>
<div>}2019-10-21 23:06:58.970 [Thread-8] INFO  o.a.f.s.connectors.kafka.FlinkKafkaConsumerBase - Consumer subtask 0 creating fetcher with offsets {}.</div>
<div></div>
<div>表现为，无法收到kafka发送过来的消息。这就很奇怪了，因为我使用kafka-consumer-console.sh的方式可以看到实际上是有消息产出的，但是这里死活就收不到数据。</div>
<div></div>
<p><span id="more-708"></span></p>
<div></div>
<div>进一步的测试，我把timestamp改成提前了很长的时间，就能正常工作。</div>
<div></div>
<div>进一步测试，如果刚好设置的timestamp那个点有消息产生，那么也能正常工作。</div>
<div></div>
<div></div>
<div>对比了下，能拿到数据和不能拿到数据的区别。下面是不能拿到数据时候的日志输出，</div>
<div></div>
<div></div>
<div>2019-10-21 23:06:58.970 [Thread-10] INFO  o.a.f.s.connectors.kafka.FlinkKafkaConsumerBase - Consumer subtask 3 creating fetcher with offsets {}.</div>
<div>2019-10-21 23:06:58.970 [Thread-7] INFO  o.a.f.s.connectors.kafka.FlinkKafkaConsumerBase - Consumer subtask 1 creating fetcher with offsets {}.</div>
<div>2019-10-21 23:07:01.100 [Source: Custom Source -&gt; Sink: Print to Std. Out (3/4)] INFO  o.a.f.s.connectors.kafka.FlinkKafkaConsumerBase - Consumer subtask 2 initially has no partitions to read from.</div>
<div>2019-10-21 23:07:01.108 [Thread-9] INFO  o.a.f.s.connectors.kafka.FlinkKafkaConsumerBase - Consumer subtask 2 creating fetcher with offsets {}.</div>
<div></div>
<div></div>
<div>而下面是能拿到数据时候的日志输出, 可以看到有一个task成功拿到了这个partition的offset</div>
<div></div>
<div></div>
<div>2019-10-21 23:14:11.871 [Thread-7] INFO  o.a.f.s.connectors.kafka.FlinkKafkaConsumerBase - Consumer subtask 2 creating fetcher with offsets {KafkaTopicPartition{topic='test', partition=0}=35}.</div>
<div></div>
<div></div>
<div>所以原因是因为，通过kafka的consumer的api，consumer.offsetsForTimes的时候，能否拿到offset，如果拿不到在KafkaConsumerThread的线程的run方法里，有一个这个代码表明这个方法是阻塞的，一直等到有新的partition到来，才会继续。而新的partition不会到来，所以这里就有问题了。。。</div>
<div></div>
<div>try {</div>
<div>   if (hasAssignedPartitions) {</div>
<div>      newPartitions = unassignedPartitionsQueue.pollBatch();</div>
<div>   }</div>
<div>   else {</div>
<div>      // if no assigned partitions block until we get at least one</div>
<div>      // instead of hot spinning this loop. We rely on a fact that</div>
<div>      // unassignedPartitionsQueue will be closed on a shutdown, so</div>
<div>      // we don't block indefinitely</div>
<div>      newPartitions = unassignedPartitionsQueue.getBatchBlocking();</div>
<div>   }</div>
<div>   if (newPartitions != null) {</div>
<div>      reassignPartitions(newPartitions);</div>
<div>   }</div>
<div>} catch (AbortedReassignmentException e) {</div>
<div>   continue;</div>
<div>}</div>
<div></div>
<div></div>
<div></div>
<div></div>
<div></div>
<div>那么kafka的这个offsetsForTimes的接口为何不能返回结果呢 ？</div>
<div></div>
<div>private static void testConsumer() {</div>
<div>    Properties props = new Properties();</div>
<div>    props.put("bootstrap.servers", "localhost:9092");</div>
<div>    props.put("group.id", "test");</div>
<div>    props.put("key.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");</div>
<div>    props.put("value.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");</div>
<div>    KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props);</div>
<div>    consumer.subscribe(Collections.singletonList("test"));</div>
<div>    TopicPartition topicPartition = new TopicPartition("test", 0);</div>
<div>    long current = System.currentTimeMillis();</div>
<div>    for (int i=0; i&lt;10000; i++) {</div>
<div>        Map&lt;TopicPartition, Long&gt; map = new HashMap&lt;&gt;();</div>
<div>        map.put(topicPartition, current - i*1000);</div>
<div>        Map&lt;TopicPartition, OffsetAndTimestamp&gt; result  = consumer.offsetsForTimes(map);</div>
<div>        System.out.println("===================test : " + i + "==================");</div>
<div>        System.out.println(new Gson().toJson(result));</div>
<div>    }</div>
<div>    while (true) {</div>
<div>        ConsumerRecords&lt;String, String&gt; records = consumer.poll(100);</div>
<div>        for (ConsumerRecord&lt;String, String&gt; record : records)</div>
<div>            System.out.printf("offset = %d, key = %s, value = %s%n", record.offset(), record.key(), record.value());</div>
<div>    }</div>
<div>}</div>
<div></div>
<div></div>
<div>通过如上代码我们发现，如果这个timestamp之后有数据产出，那么就能正确的拿到offset，否则就拿不到。</div>
<div></div>
<div>也就是我们最后一条数据如果是18：00产生的，那么如果你的时间戳早于18:00是能正确的拿到offset的，如果比18:00晚，那么就拿不到了。</div>
<div></div>
<div></div>
<div>总结，问题在于flink和kafka的配合。kafka的特征是，时间戳之后如果没有消息，那么就不返回offset(我认为合理的应该是返回last offset + 1) , 那么flink发现没有返回offset是怎么处理的呢？那就不消费数据了，因为他觉得返回的数据并不符合自己的预期，他也不知道从哪里开始取了。如果从offset+1开始取，可能会出错，干脆就不取了。</div>
<div></div>
]]></content:encoded>
			<wfw:commentRss>https://huster.top/htmls/708.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>flink通过jdbc读取postgresql数据库里的数据</title>
		<link>https://huster.top/htmls/706.html</link>
		<comments>https://huster.top/htmls/706.html#respond</comments>
		<pubDate>Thu, 17 Oct 2019 08:49:32 +0000</pubDate>
		<dc:creator><![CDATA[龙安_任天兵]]></dc:creator>
				<category><![CDATA[flink]]></category>

		<guid isPermaLink="false">https://huster.top/?p=706</guid>
		<description><![CDATA[问题1： 从postgresql里使用flink-jdbc读取数据的问题, 数据类型不匹配，不支持jsonb等 &#8230; <a href="https://huster.top/htmls/706.html" class="more-link">继续阅读<span class="screen-reader-text">“flink通过jdbc读取postgresql数据库里的数据”</span></a>]]></description>
				<content:encoded><![CDATA[<div></div>
<div></div>
<div></div>
<div>问题1： 从postgresql里使用flink-jdbc读取数据的问题, 数据类型不匹配，不支持jsonb等其他类型.</div>
<div></div>
<div></div>
<p><span id="more-706"></span></p>
<div></div>
<div>        使用create table 语句来读取，由于postgresql里设置的是jsonb的类型, 他又不让你输入sql语句(语句里需要写CAST函数),所以就抛错了</div>
<div>Caused by: java.lang.ClassCastException: org.postgresql.util.PGobject cannot be cast to java.lang.String</div>
<div>Caused by: java.lang.ClassCastException: org.postgresql.util.PGobject cannot be cast to java.lang.String</div>
<div>    at <a href="http://org.apache.flink.api.common.typeutils.base.stringserializer.copy(stringserializer.java:33/">org.apache.flink.api.common.typeutils.base.StringSerializer.copy(StringSerializer.java:33</a>)</div>
<div>    at org.apache.flink.api.java.typeutils.runtime.RowSerializer.copy(RowSerializer.java:93)</div>
<div>    at org.apache.flink.api.java.typeutils.runtime.RowSerializer.copy(RowSerializer.java:44)</div>
<div>    at org.apache.flink.streaming.runtime.tasks.OperatorChain$CopyingChainingOutput.pushToOperator(OperatorChain.java:635)</div>
<div>    ... 9 more</div>
<div></div>
<div></div>
<div>问题2: partition必须是数字类型的字段</div>
<div></div>
<div></div>
<div> 另外，因为connector.read.partition.column他使用的是between语句，所以只能是数字，时间戳等，否则也会报错</div>
<div>. partition.column must be a numeric,</div>
<div> -- date, or timestamp column from the table in question.</div>
<div></div>
<div></div>
<div></div>
<div></div>
<div></div>
<div></div>
<div>Exception in thread "main" org.apache.flink.runtime.client.JobExecutionException: Job execution failed.</div>
<div>    at org.apache.flink.runtime.jobmaster.JobResult.toJobExecutionResult(JobResult.java:146)</div>
<div>    at org.apache.flink.runtime.minicluster.MiniCluster.executeJobBlocking(MiniCluster.java:627)</div>
<div>    at org.apache.flink.streaming.api.environment.LocalStreamEnvironment.execute(LocalStreamEnvironment.java:117)</div>
<div>    at org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.execute(StreamExecutionEnvironment.java:1507)</div>
<div>    at com.hellobike.search.flink.task.FullIndexBuilderTask.main(FullIndexBuilderTask.java:92)</div>
<div>Caused by: java.lang.Exception: java.lang.IllegalArgumentException: open() failed.ERROR: operator does not exist: character varying &gt;= bigint</div>
<div>  建议：No operator matches the given name and argument type(s). You might need to add explicit type casts.</div>
<div>  位置：514</div>
<div>    at org.apache.flink.streaming.runtime.tasks.SourceStreamTask$LegacySourceFunctionThread.checkThrowSourceExecutionException(SourceStreamTask.java:212)</div>
<div>    at org.apache.flink.streaming.runtime.tasks.SourceStreamTask.performDefaultAction(SourceStreamTask.java:132)</div>
<div>    at org.apache.flink.streaming.runtime.tasks.StreamTask.run(StreamTask.java:298)</div>
<div>    at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:403)</div>
<div>    at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:705)</div>
<div>    at org.apache.flink.runtime.taskmanager.Task.run(Task.java:530)</div>
<div>    at java.lang.Thread.run(Thread.java:748)</div>
<div>Caused by: java.lang.IllegalArgumentException: open() failed.ERROR: operator does not exist: character varying &gt;= bigint</div>
<div>  建议：No operator matches the given name and argument type(s). You might need to add explicit type casts.</div>
<div>  位置：514</div>
<div>    at org.apache.flink.api.java.io.jdbc.JDBCInputFormat.open(JDBCInputFormat.java:250)</div>
<div>    at org.apache.flink.streaming.api.functions.source.InputFormatSourceFunction.run(InputFormatSourceFunction.java:85)</div>
<div>    at org.apache.flink.streaming.api.operators.StreamSource.run(StreamSource.java:100)</div>
<div>    at org.apache.flink.streaming.api.operators.StreamSource.run(StreamSource.java:63)</div>
<div>    at org.apache.flink.streaming.runtime.tasks.SourceStreamTask$LegacySourceFunctionThread.run(SourceStreamTask.java:202)</div>
<div>Caused by: org.postgresql.util.PSQLException: ERROR: operator does not exist: character varying &gt;= bigint</div>
<div>  建议：No operator matches the given name and argument type(s). You might need to add explicit type casts.</div>
<div>  位置：514</div>
<div>    at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2103)</div>
<div>    at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:1836)</div>
<div>    at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:257)</div>
<div>    at org.postgresql.jdbc2.AbstractJdbc2Statement.execute(AbstractJdbc2Statement.java:512)</div>
<div>    at org.postgresql.jdbc2.AbstractJdbc2Statement.executeWithFlags(AbstractJdbc2Statement.java:388)</div>
<div>    at org.postgresql.jdbc2.AbstractJdbc2Statement.executeQuery(AbstractJdbc2Statement.java:273)</div>
<div>    at org.apache.flink.api.java.io.jdbc.JDBCInputFormat.open(JDBCInputFormat.java:247)</div>
<div>    ... 4 more</div>
<div>
<div></div>
</div>
]]></content:encoded>
			<wfw:commentRss>https://huster.top/htmls/706.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>flink相关 &#8211; 通过Table API写入ElasticSearch的部分源码分析</title>
		<link>https://huster.top/htmls/704.html</link>
		<comments>https://huster.top/htmls/704.html#respond</comments>
		<pubDate>Thu, 17 Oct 2019 08:49:06 +0000</pubDate>
		<dc:creator><![CDATA[龙安_任天兵]]></dc:creator>
				<category><![CDATA[flink]]></category>

		<guid isPermaLink="false">https://huster.top/?p=704</guid>
		<description><![CDATA[New ElasticSearch()…xxx...registerTableSink(); ElasticS &#8230; <a href="https://huster.top/htmls/704.html" class="more-link">继续阅读<span class="screen-reader-text">“flink相关 &#8211; 通过Table API写入ElasticSearch的部分源码分析”</span></a>]]></description>
				<content:encoded><![CDATA[<div>New ElasticSearch()…xxx...registerTableSink();</div>
<div></div>
<div>ElasticSearch是一个ConnectorDescriptor: 最关键的就是一个toConnectorProperties就是一个配置的map,传给factory使用，他其实是一个配置收集器.</div>
<div></div>
<div></div>
<p><span id="more-704"></span></p>
<div></div>
<div>TableFactoryUtils :  生成一个TableFactory的工具类，</div>
<div>findAndCreateTableSink( ) 通过一个描述来生成一个工厂类.//描述里有必要的配置.</div>
<div></div>
<div>先找到合适的工厂类，然后创建一个TableSink.</div>
<div></div>
<div>第一步，A先找到合适的工厂类，通过properties里的配置来寻找,</div>
<div>TableFactoryService.find(TableSinkFactory.class, properties)</div>
<div>findSingleInternal()里的两个代码是关键代码</div>
<div></div>
<div>A.1 : List&lt;TableFactory&gt; tableFactories = discoverFactories(classLoader);    通过classLoader(可以传入, 否则使用默认)找到所有的Factory.</div>
<div>A.2:  然后开始过滤， List&lt;T&gt; filtered = filter(tableFactories, factoryClass, properties)</div>
<div>        A.2.1 : 首先检查类型, TableSinkFactory.class   filterByFactoryClass(factoryClass,properties,foundFactories)</div>
<div>        A.2.2 : 然后检查必须的配置是不是设置了, List&lt;T&gt; contextFactories = filterByContext(factoryClass,properties,foundFactories,classFactories);</div>
<div>                    其中必备的配置是在factory里配置和定义的，必须不能为空.这个是有TableFactory的requiredContext()方法定义的.</div>
<div>       A.2.3 : 经过以上两轮的过滤，然后再继续检查，依然是TableFactoryService.java，这里面的</div>
<div>   private static &lt;T extends TableFactory&gt; List&lt;T&gt; filterBySupportedProperties(</div>
<div>            Class&lt;T&gt; factoryClass,</div>
<div>            Map&lt;String, String&gt; properties,</div>
<div>            List&lt;TableFactory&gt; foundFactories,</div>
<div>            List&lt;T&gt; classFactories) 方法</div>
<div></div>
<div>            这里主要是TableFactory里的两个方法定义的属性</div>
<div>                    Map&lt;String, String&gt; requiredContext();</div>
<div>                    List&lt;String&gt; supportedProperties();</div>
<div>            然后和用户Descriptor（如 ElasticSearch）里设置的属性匹配，其中有字符忽略大小写，星号匹配等细节，不再研究.</div>
<div></div>
<div>然后这就找到了工厂类，接下来要生成TableSink了。例如 ElasticSearch找到的就是Elasticsearch6UpsertTableSinkFactory.</div>
<div></div>
<div>第二步，生成TableSink.在ElasticSearch中，他是直接的new了一个Elasticsearch6UpsertTableSink.而这个对象又是一个StreamTableSink，这样就生成了一个StreamTableSink, 这个sink可以交给flink直接使用了。在ElasticSearch这个TableSink里，最关键的是实现了consumeDataStream，这个决定了sink的写逻辑.注意区分的是一个是StreamTableSink是给Table接口使用的，另一个是DataStreamSink是给DataStream使用的。这里是连接Table和Stream接口的地方。所以说，Table的API其实还是基于Stream的API的。</div>
<div></div>
<div></div>
<div>生成了Elasticsearch的TableSink之后，可以看到到这个类的用途是为了向es写入数据，他的作用是生成一个createSinkFunction。</div>
<div>createSinkFunction是具体的连接es，向es写入数据的逻辑，具体的实现是ElasticsearchUpsertSinkFunction的process的方法。是由ElasticsearchSinkBase发起的调用。</div>
<div></div>
<div></div>
<div></div>
<div>在写入ElasticSearch的时候，如何让_id使用数据里的指定的field的值？</div>
<div>在ES2.0之后，mapping里设置_id就被移除了这个特性。目的是为了让业务方不需要关心es的实现细节。在es connector里，他会根据你的table的primary key来生成这个_id的值。一般情况下，在append模式下，因为只是insert，所以他都是随机的。只有在update的时候，才需要根据primary key查找到元素并且进行更新。具体的实现在processUpsert方法。</div>
<div></div>
<div>        private void processUpsert(Row row, RequestIndexer indexer) {</div>
<div>            final byte[] document = serializationSchema.serialize(row);</div>
<div>            if (keyFieldIndices.length == 0) {</div>
<div>                final IndexRequest indexRequest = requestFactory.createIndexRequest(</div>
<div>                    index,</div>
<div>                    docType,</div>
<div>                    contentType,</div>
<div>                    document);</div>
<div>                indexer.add(indexRequest);</div>
<div>            } else {</div>
<div>                final String key = createKey(row);</div>
<div>                final UpdateRequest updateRequest = requestFactory.createUpdateRequest(</div>
<div>                    index,</div>
<div>                    docType,</div>
<div>                    key,</div>
<div>                    contentType,</div>
<div>                    document);</div>
<div>                indexer.add(updateRequest);</div>
<div>            }</div>
<div>        }</div>
<div></div>
<div>这个方法的关键是keyFieldIndices这个属性。如果这个属性没值，那么久不指定key，让他自动生成_id，否则就从元数据里拿到这个字段值，再拼接成_id.而这个值是由方法</div>
<div>public void setKeyFields(String[] keyNames) {} 来设置的。这个就是tablesink接口里定义的方法。这个方法可不是给业务方调用的，这个是flink框架调用的。所以你显示的调用这个方法也没用，他flink最终会覆盖掉你的配置。</div>
<div>/**</div>
<div>* Configures the unique key fields of the {@linkTable} to write.</div>
<div>* The method is called after {@linkTableSink#configure(String[], TypeInformation[])}.</div>
<div>*</div>
<div>*&lt;p&gt;The keys array might be empty, if the table consists of a single (updated) record.</div>
<div>* If the table does not have a key and is append-only, the keys attribute is null.</div>
<div>*</div>
<div>*@paramkeysthe field names of the table's keys, an empty array if the table has a single</div>
<div>*             row, and null if the table is append-only and has no key.</div>
<div>*/</div>
<div>voidsetKeyFields(String[] keys);</div>
<div></div>
<div>说明在这里。说的很清楚了，如果是append-only的模式，传入的keys就为空，否则就用table 的 primary key. 所以你可以定义一个table，指定主键。</div>
<div></div>
<div>找了一圈发现并没有定义table 的 primary的语法，翻看flink的源码发现他是自动判断的，具体的是根据你的sql语句来判断的。</div>
<div></div>
<div>UpdatingPlanChecker.scala是一个scala的不太好看明白，具体的在.private class UniqueKeyExtractor {} 这个类里面。他的寻找方式是，如果你是group by 语句，那么group by 就是你的key.如果你是join，那就看你左边的表和你右边的表来分别递归计算。</div>
<div></div>
<div>// Output of join must have keys if left and right both contain key(s).</div>
<div>// Key groups from both side will be merged by join equi-predicates</div>
<div>val lInNames: Seq[String] = j.getLeft.getRowType.getFieldNames</div>
<div>val rInNames: Seq[String] = j.getRight.getRowType.getFieldNames</div>
<div>val joinNames = j.getRowType.getFieldNames</div>
<div>// if right field names equal to left field names, calcite will rename right</div>
<div>// field names. For example, T1(pk, a) join T2(pk, b), calcite will rename T2(pk, b)</div>
<div></div>
<div></div>
<div>总之就是，只有在聚合计算的时候才会有key, 也就是group by 后面的内容。那这不就扯了吗？ ElasticSearch connector 不就只支持插入操作了吗？</div>
<div></div>
<div></div>
<div>Ps： flink后续会支持在table schema里定义primary key, 已经提交了pr，<a href="https://github.com/apache/flink/pull/8736">https://github.com/apache/flink/pull/8736</a> 可惜现在还没有。pat ~</div>
<div></div>
<div></div>
<div></div>
<div></div>
<div></div>
<div></div>
<div></div>
]]></content:encoded>
			<wfw:commentRss>https://huster.top/htmls/704.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>flink的动态表格</title>
		<link>https://huster.top/htmls/700.html</link>
		<comments>https://huster.top/htmls/700.html#respond</comments>
		<pubDate>Thu, 17 Oct 2019 08:48:28 +0000</pubDate>
		<dc:creator><![CDATA[龙安_任天兵]]></dc:creator>
				<category><![CDATA[flink]]></category>

		<guid isPermaLink="false">https://huster.top/?p=700</guid>
		<description><![CDATA[目的： 订阅kafka的消息(kafka的消息是从postgresql来的)，将kafka的消息作为Table &#8230; <a href="https://huster.top/htmls/700.html" class="more-link">继续阅读<span class="screen-reader-text">“flink的动态表格”</span></a>]]></description>
				<content:encoded><![CDATA[<div>目的： 订阅kafka的消息(kafka的消息是从postgresql来的)，将kafka的消息作为TableSource，执行sql，将结果输出到ElasticSearch中</div>
<div></div>
<div></div>
<p><span id="more-700"></span></p>
<div></div>
<div>动态表格</div>
<div></div>
<div>    flink的概念里，stream的输入是一个insert的模式。类似于点击日志这种，是源源不断的产出的新数据。而postgresql到kafka的消息包含了insert,update和delete的操作。</div>
<div>在点击日志的概率里，如果统计点击次数，比较好理解。一种是表格不断的更新(update mode)。如果unique key第一次出现，则插入，否则做累加，类似下面这种</div>
<div><a href="https://huster.top/wp-content/uploads/2019/10/5.png"><img class="alignnone size-full wp-image-701" src="https://huster.top/wp-content/uploads/2019/10/5.png" alt="" width="850" height="370" /></a></div>
<div></div>
<div>还有一种则是基于窗口的统计，每一个窗口期插入一系列的数据，所以这个是insert模式</div>
<div><a href="https://huster.top/wp-content/uploads/2019/10/6.png"><img class="alignnone size-full wp-image-702" src="https://huster.top/wp-content/uploads/2019/10/6.png" alt="" width="872" height="350" /></a></div>
<div></div>
<div></div>
<div></div>
<div>但是在我们的场景里面，kafka里的消息不仅仅是插入的数据，还有可能是更新的数据。也就是有个维表，里面的数据在不断的更新。</div>
<div></div>
<div>那么现在就是要搞清楚一件事。如果我定义了一个Table，接受Stream data数据不断流入。如果我这个table里不存在这表数据(定义primary key)，那么他就会执行插入。否则他会执行update操作。我们写代码来试验一下这个想法， 看看是不是这样。如果没有group by 语句，你连primary key 都定义不了，也就没办法实现更新了…..所以要区分情况，如果你是上面的例子，通过group by 计算count, 因为有primary key，所以可以形成动态表格，可以自动update.如果你仅仅是接受kafka的消息，scan模式的话，由于表格没有primary key，所以是不支持update,而只支持insert的。</div>
<div></div>
<div></div>
<div>所以针对update 和 delete 还需要单独处理….</div>
<div></div>
<div></div>
<div></div>
<div>在Table convert to DataStream一章里，使用了Tuple2&lt;Boolean, Row&gt;这个数据结构来区分Reactor Mode. 其中那个Boolean//   True is INSERT, false is DELETE.</div>
<div></div>
<div></div>
<div></div>
<div></div>
]]></content:encoded>
			<wfw:commentRss>https://huster.top/htmls/700.html/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
	</channel>
</rss>
