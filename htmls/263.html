<!DOCTYPE html>
<html lang="zh-CN" class="no-js"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script><title>史上最快的消息队列-ZeroMQ的学习研究 – 三两带走</title><link rel="amphtml" href="https://huster.top/htmls/263.html/amp"><link rel="dns-prefetch" href="//rentb.vicp.net"><link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com"><link rel="dns-prefetch" href="//s.w.org"><link rel="stylesheet" id="dashicons-css" href="https://huster.top/wp-includes/css/dashicons.min.css" type="text/css" media="all"><link rel="stylesheet" id="obfx-module-pub-css-menu-icons-0-css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=2.8.4" type="text/css" media="all"><link rel="stylesheet" id="obfx-module-pub-css-menu-icons-1-css" href="https://huster.top/wp-content/plugins/themeisle-companion/obfx_modules/menu-icons/css/public.css" type="text/css" media="all"><style id="md-style-inline-css" type="text/css">
 
</style><link rel="stylesheet" id="genericons-css" href="https://huster.top/wp-content/themes/twentysixteen/genericons/genericons.css" type="text/css" media="all"><link rel="stylesheet" id="twentysixteen-style-css" href="https://huster.top/wp-content/themes/twentysixteen/style.css" type="text/css" media="all"><style id="twentysixteen-style-inline-css" type="text/css">
	    
		body.page-template-builder-fullwidth.elementor-page,
		body.page-template-builder-fullwidth-std.elementor-page {
			background: transparent;
		}
		.page-template-builder-fullwidth-std .site {
			margin: 0;
		}
		.page-template-builder-fullwidth .elementor-page,
        .page-template-builder-fullwidth-std .elementor-page {
	        overflow: hidden;
        }
		.page-template-builder-fullwidth .full-width,
        .page-template-builder-fullwidth-std .full-width {
	        width: 100%;
        }
        .page-template-builder-fullwidth .site-inner,
        .page-template-builder-fullwidth-std .site-inner {
            max-width: 100%;
        }
        .page-template-builder-fullwidth .site-content,
        .page-template-builder-fullwidth-std .site-content {
            padding: 0;
        }
        .page-template-builder-fullwidth header#masthead,
        .page-template-builder-fullwidth footer#colophon,
        .page-template-builder-fullwidth-std header#masthead,
        .page-template-builder-fullwidth-std footer#colophon {
	        margin: 0 auto;
	        max-width: 1320px;
        } 
        .page-template-builder-fullwidth .entry-content,
        .page-template-builder-fullwidth-std .entry-content {
	        margin-right: auto;
	        margin-left: auto;
        }
        @media screen and (min-width: 56.875em) {
	        .admin-bar .anchor-menu {
		        top: 20px;
	        }	
			.admin-bar .anchor-menu-fixed.anchor-menu, .admin-bar .anchor-menu-fixed.elementor-widget-wp-widget-nav_menu {
				top: 54px !important;
			}			
			.page-template-builder-fullwidth .entry-content,
            .page-template-builder-fullwidth-std .entry-content	{
	            margin-right: auto;
	            margin-left: auto;
	        }
        }
        @media screen and (min-width: 44.375em) {	        
			.page-template-builder-fullwidth .entry-content,
            .page-template-builder-fullwidth-std .entry-content {
	            margin-right: auto;;
	        }
        }
	
</style><script type="text/javascript" src="https://huster.top/wp-includes/js/jquery/jquery.js"></script><script type="text/javascript" src="https://huster.top/wp-includes/js/jquery/jquery-migrate.min.js"></script><style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style><link rel="preload" as="style" href="https://huster.top/wp-content/plugins/code-prettify/prettify/prettify.css"><style type="text/css" id="syntaxhighlighteranchor"></style><link rel="icon" href="https://huster.top/wp-content/uploads/2018/09/cropped-fish_112.18181818182px_1208536_easyicon.net_-32x32.png" sizes="32x32"><link rel="icon" href="https://huster.top/wp-content/uploads/2018/09/cropped-fish_112.18181818182px_1208536_easyicon.net_-192x192.png" sizes="192x192"><link rel="apple-touch-icon-precomposed" href="https://huster.top/wp-content/uploads/2018/09/cropped-fish_112.18181818182px_1208536_easyicon.net_-180x180.png"><meta name="msapplication-TileImage" content="https://huster.top/wp-content/uploads/2018/09/cropped-fish_112.18181818182px_1208536_easyicon.net_-270x270.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script></head><body class="post-template-default single single-post postid-263 single-format-standard">
<div id="page" class="site">
	<div class="site-inner">
		<a class="skip-link screen-reader-text" href="#content">跳至内容</a>

		<header id="masthead" class="site-header" role="banner"><div class="site-header-main">
				<div class="site-branding">
					
											<p class="site-title"><a href="https://huster.top/" rel="home">三两带走</a></p>
											<p class="site-description">(任天兵)龙安的博客</p>
									</div>

							</div>

					</header><div id="content" class="site-content">

<div id="primary" class="content-area">
	<main id="main" class="site-main" role="main"><article id="post-263" class="post-263 post type-post status-publish format-standard hentry category-16 tag-zeromq tag-zmq"><header class="entry-header"><h1 class="entry-title">史上最快的消息队列-ZeroMQ的学习研究</h1>	</header><div class="entry-content">
		<p style="text-align: center;">ZeroMQ，史上最快的消息队列</p>
<p style="text-align: center;">----- ZMQ的学习和研究</p>
<p>一、ZeroMQ的背景介绍</p>
<p>引用官方的说法： “ZMQ(以下ZeroMQ简称ZMQ)是一个简单好用的传输层，像框架一样的一个socket library，他使得Socket编程更加简单、简洁和性能更高。是一个消息处理队列库，可在多个线程、内核和主机盒之间弹性伸缩。ZMQ的明确目标是“成为标准网络协议栈的一部分，之后进入Linux内核”。现在还未看到它们的成功。但是，它无疑是极具前景的、并且是人们更加需要的“传统”BSD套接字之上的一 层封装。ZMQ让编写高性能网络应用程序极为简单和有趣。”</p>
<p>近几年有关"Message Queue"的项目层出不穷，知名的就有十几种，这主要是因为后摩尔定律时代，分布式处理逐渐成为主流，业界需要一套标准来解决分布式计算环境中节点之间的消息通信。几年的竞争下来，Apache基金会旗下的符合AMQP/1.0标准的RabbitMQ已经得到了广泛的认可，成为领先的MQ项目。</p>
<p>与RabbitMQ相比，ZMQ并不像是一个传统意义上的消息队列服务器，事实上，它也根本不是一个服务器，它更像是一个底层的网络通讯库，在Socket API之上做了一层封装，将网络通讯、进程通讯和线程通讯抽象为统一的API接口。</p>
<p>二、ZMQ是什么？</p>
<p>阅读了ZMQ的<a href="http://zguide.zeromq.org/page:all">Guide文档</a>后，我的理解是，这是个类似于Socket的一系列接口，他跟Socket的区别是：普通的socket是端到端的（1:1的关系），而ZMQ却是可以N：M 的关系，人们对BSD套接字的了解较多的是点对点的连接，点对点连接需要显式地建立连接、销毁连接、选择协议（TCP/UDP）和处理错误等，而ZMQ屏蔽了这些细节，让你的网络编程更为简单。ZMQ用于node与node间的通信，node可以是主机或者是进程。</p>
<p>三、本文的目的</p>
<p>在集群对外提供服务的过程中，我们有很多的配置，需要根据需要随时更新，那么这个信息如果推动到各个节点？并且保证信息的一致性和可靠性？本文在介绍ZMQ基本理论的基础上，试图使用ZMQ实现一个配置分发中心。从一个节点，将信息无误的分发到各个服务器节点上，并保证信息正确性和一致性。</p>
<p><span id="more-263"></span></p>
<p>四、ZMQ的三个基本模型</p>
<p>ZMQ提供了三个基本的通信模型，分别是“Request-Reply “，”Publisher-Subscriber“，”Parallel Pipeline<strong>”,</strong>我们从这三种模式一窥ZMQ的究竟</p>
<h6>ZMQ的hello world！</h6>
<p>由Client发起请求，并等待Server回应请求。请求端发送一个简单的hello，服务端则回应一个world。请求端和服务端都可以是 1:N 的模型。通常把 1 认为是 Server ，N 认为是Client 。ZMQ 可以很好的支持路由功能（实现路由功能的组件叫作Device），把 1:N 扩展为N:M （只需要加入若干路由节点）。如图1所示：</p>
<p align="center"><img class="alignnone" title="图片1" src="http://www.searchtb.com/wp-content/uploads/2012/08/fig11.png" alt="" width="147" height="259"></p>
<p align="center">图1：ZMQ的Request-Reply 通信</p>
<p>服务端的php程序如下：</p>
<pre class="brush:php"><?php
/*
* Hello World server
* Binds REP socket to tcp://*:5555
* Expects "Hello" from client, replies with "World"
* @author Ian Barber <ian(dot)barber(at)gmail(dot)com>
*/
$context = new ZMQContext(1);
// Socket to talk to clients
$responder = new ZMQSocket($context, ZMQ::SOCKET_REP);
$responder->bind("tcp://*:5555");
while(true) {
// Wait for next request from client
$request = $responder->recv();
printf ("Received request: [%s]\n", $request);

// Do some 'work'
sleep (1);

// Send reply back to client
$responder->send("World");
}</pre>
<p>Client程序如下：</p>
<pre class="brush:php"><?php

/*

 *  Hello World client

 *  Connects REQ socket to tcp://localhost:5555

 *  Sends "Hello" to server, expects "World" back

 * @author Ian Barber <ian(dot)barber(at)gmail(dot)com>

 */
$context = new ZMQContext();

//  Socket to talk to server

echo "Connecting to hello world server...\n";

$requester = new ZMQSocket($context, ZMQ::SOCKET_REQ);

$requester->connect("tcp://localhost:5555");

for($request_nbr = 0; $request_nbr != 10; $request_nbr++) {

    printf ("Sending request %d...\n", $request_nbr);

    $requester->send("Hello");

    $reply = $requester->recv();

    printf ("Received reply %d: [%s]\n", $request_nbr, $reply);

}</pre>
<p>从以上的过程，我们可以了解到使用ZMQ写基本的程序的方法，需要注意的是：</p>
<p>a)     服务端和客户端无论谁先启动，效果是相同的，这点不同于Socket。</p>
<p>b)     在服务端收到信息以前，程序是阻塞的，会一直等待客户端连接上来。</p>
<p>c)      服务端收到信息以后，会send一个“World”给客户端。值得注意的是一定是client连接上来以后，send消息给Server，然后Server再rev然后响应client，这种一问一答式的。如果Server先send，client先rev是会报错的。</p>
<p>d)     ZMQ通信通信单元是消息，他除了知道Bytes的大小，他并不关心的消息格式。因此，你可以使用任何你觉得好用的数据格式。Xml、Protocol Buffers、Thrift、json等等。</p>
<p>e)     虽然可以使用ZMQ实现HTTP协议，但是，这绝不是他所擅长的。</p>
<h6>2.ZMQ的Publish-subscribe模式</h6>
<p>我们可以想象一下天气预报的订阅模式，由一个节点提供信息源，由其他的节点，接受信息源的信息，如图2所示：</p>
<p align="center"><img class="alignnone" title="图2" src="http://www.searchtb.com/wp-content/uploads/2012/08/fig40.png" alt="" width="366" height="306"></p>
<p align="center">图2：ZMQ的Publish-subscribe</p>
<p>示例代码如下 ：</p>
<p>Publisher：</p>
<pre class="brush:php"><?php
/*
* Weather update server
* Binds PUB socket to tcp://*:5556
* Publishes random weather updates
* @author Ian Barber <ian(dot)barber(at)gmail(dot)com>
*/

// Prepare our context and publisher
$context = new ZMQContext();
$publisher = $context->getSocket(ZMQ::SOCKET_PUB);
$publisher->bind("tcp://*:5556");

while (true) {
// Get values that will fool the boss
$zipcode = mt_rand(0, 100000);
$temperature = mt_rand(-80, 135);
$relhumidity = mt_rand(10, 60);

// Send message to all subscribers
$update = sprintf ("%05d %d %d", $zipcode, $temperature, $relhumidity);
$publisher->send($update);
}</pre>
<p> </p>
<p>Subscriber</p>
<pre class="brush:php"><?php
/*
* Weather update client
* Connects SUB socket to tcp://localhost:5556
* Collects weather updates and finds avg temp in zipcode
* @author Ian Barber <ian(dot)barber(at)gmail(dot)com>
*/

$context = new ZMQContext();

// Socket to talk to server
echo "Collecting updates from weather server…", PHP_EOL;
$subscriber = new ZMQSocket($context, ZMQ::SOCKET_SUB);
$subscriber->connect("tcp://localhost:5556");

// Subscribe to zipcode, default is NYC, 10001
$filter = $_SERVER['argc'] > 1 ? $_SERVER['argv'][1] : "10001";
$subscriber->setSockOpt(ZMQ::SOCKOPT_SUBSCRIBE, $filter);

// Process 100 updates
$total_temp = 0;
for ($update_nbr = 0; $update_nbr < 100; $update_nbr++) {
$string = $subscriber->recv();
sscanf ($string, "%d %d %d", $zipcode, $temperature, $relhumidity);
$total_temp += $temperature;
}
printf ("Average temperature for zipcode '%s' was %dF\n",
$filter, (int) ($total_temp / $update_nbr));</pre>
<p>这段代码讲的是，服务器端生成随机数zipcode、temperature、relhumidity分别代表城市代码、温度值和湿度值。然后不断的广播信息，而客户端通过设置过滤参数，接受特定城市代码的信息，收集完了以后，做一个平均值。</p>
<p>a)     与Hello World不同的是，Socket的类型变成SOCKET_PUB和SOCKET_SUB类型。</p>
<p>b)     客户端需要$subscriber->setSockOpt(ZMQ::SOCKOPT_SUBSCRIBE, $filter);设置一个过滤值，相当于设定一个订阅频道，否则什么信息也收不到。</p>
<p>c)      服务器端一直不断的广播中，如果中途有Subscriber端退出，并不影响他继续的广播，当Subscriber再连接上来的时候，收到的就是后来发送的新的信息了。这对比较晚加入的，或者是中途离开的订阅者，必然会丢失掉一部分信息，这是这个模式的一个问题，所谓的Slow joiner。稍后，会解决这个问题。</p>
<p>d)     但是，如果Publisher中途离开，所有的Subscriber会hold住，等待Publisher再上线的时候，会继续接受信息。</p>
<h6>3.ZMQ的PipeLine模型</h6>
<p>想象一下这样的场景，如果需要统计各个机器的日志，我们需要将统计任务分发到各个节点机器上，最后收集统计结果，做一个汇总。PipeLine比较适合于这种场景，他的结构图，如图3所示。</p>
<p align="center"><img class="alignnone" title="图3" src="http://www.searchtb.com/wp-content/uploads/2012/08/fig50.png" alt="" width="366" height="462"></p>
<p align="center">图3：ZMQ的PipeLine模型</p>
<p>Parallel task ventilator in PHP</p>
<pre class="brush:php"><?php
/*
* Task ventilator
* Binds PUSH socket to tcp://localhost:5557
* Sends batch of tasks to workers via that socket
* @author Ian Barber <ian(dot)barber(at)gmail(dot)com>
*/

$context = new ZMQContext();

// Socket to send messages on
$sender = new ZMQSocket($context, ZMQ::SOCKET_PUSH);
$sender->bind("tcp://*:5557");

echo "Press Enter when the workers are ready: ";
$fp = fopen('php://stdin', 'r');
$line = fgets($fp, 512);
fclose($fp);
echo "Sending tasks to workers…", PHP_EOL;

// The first message is "0" and signals start of batch
$sender->send(0);

// Send 100 tasks
$total_msec = 0; // Total expected cost in msecs
for ($task_nbr = 0; $task_nbr < 100; $task_nbr++) {
// Random workload from 1 to 100msecs
$workload = mt_rand(1, 100);
$total_msec += $workload;
$sender->send($workload);

}
printf ("Total expected cost: %d msec\n", $total_msec);
sleep (1); // Give 0MQ time to deliver</pre>
<p> </p>
<p>Parallel task worker in PHP</p>
<pre class="brush:php"><?php
/*
* Task worker
* Connects PULL socket to tcp://localhost:5557
* Collects workloads from ventilator via that socket
* Connects PUSH socket to tcp://localhost:5558
* Sends results to sink via that socket
* @author Ian Barber <ian(dot)barber(at)gmail(dot)com>
*/

$context = new ZMQContext();

// Socket to receive messages on
$receiver = new ZMQSocket($context, ZMQ::SOCKET_PULL);
$receiver->connect("tcp://localhost:5557");

// Socket to send messages to
$sender = new ZMQSocket($context, ZMQ::SOCKET_PUSH);
$sender->connect("tcp://localhost:5558");

// Process tasks forever
while (true) {
$string = $receiver->recv();

// Simple progress indicator for the viewer
echo $string, PHP_EOL;

// Do the work
usleep($string * 1000);

// Send results to sink
$sender->send("");
}</pre>
<p>Parallel task sink in PHP</p>
<pre class="brush:php"><?php
/*
* Task sink
* Binds PULL socket to tcp://localhost:5558
* Collects results from workers via that socket
* @author Ian Barber <ian(dot)barber(at)gmail(dot)com>
*/

// Prepare our context and socket
$context = new ZMQContext();
$receiver = new ZMQSocket($context, ZMQ::SOCKET_PULL);
$receiver->bind("tcp://*:5558");

// Wait for start of batch
$string = $receiver->recv();

// Start our clock now
$tstart = microtime(true);

// Process 100 confirmations
$total_msec = 0; // Total calculated cost in msecs
for ($task_nbr = 0; $task_nbr < 100; $task_nbr++) {
$string = $receiver->recv();
if($task_nbr % 10 == 0) {
echo ":";
} else {
echo ".";
}
}

$tend = microtime(true);

$total_msec = ($tend - $tstart) * 1000;
echo PHP_EOL;
printf ("Total elapsed time: %d msec", $total_msec);
echo PHP_EOL;</pre>
<p> </p>
<p>从程序中，我们可以看到，task ventilator使用的是SOCKET_PUSH，将任务分发到Worker节点上。而Worker节点上，使用SOCKET_PULL从上游接受任务，并使用SOCKET_PUSH将结果汇集到Slink。值得注意的是，任务的分发的时候也同样有一个负载均衡的路由功能，worker可以随时自由加入，task ventilator可以均衡将任务分发出去。</p>
<p>五、其他扩展模式</p>
<p>通常，一个节点，即可以作为Server，同时也能作为Client，通过PipeLine模型中的Worker，他向上连接着任务分发，向下连接着结果搜集的Sink机器。因此，我们可以借助这种特性，丰富的扩展原有的三种模式。例如，一个代理Publisher，作为一个内网的Subscriber接受信息，同时将信息，转发到外网，其结构图如图4所示。</p>
<p align="center"><img class="alignnone" title="图片4" src="http://www.searchtb.com/wp-content/uploads/2012/08/fig170.png" alt="" width="397" height="357"></p>
<p align="center">图4：ZMQ的扩展模式</p>
<p>六、多个服务器</p>
<p>ZMQ和Socket的区别在于，前者支持N：M的连接，而后者则只是1：1的连接，那么一个Client连接多个Server的情况是怎样的呢，我们通过图5来说明。</p>
<p align="center"> <img class="alignnone" title="图5" src="http://www.searchtb.com/wp-content/uploads/2012/08/fig180.png" alt="" width="386" height="315"></p>
<p align="center">图5：ZMQ的N:1的连接情况</p>
<p>我们假设Client有R1,R2,R3,R4四个任务，我们只需要一个ZMQ的Socket，就可以连接四个服务，他能够自动均衡的分配任务。如图5所示，R1，R4自动分配到了节点A，R2到了B，R3到了C。如果我们是N:M的情况呢？这个扩展起来，也不难，如图6所示。</p>
<p align="center"><img class="alignnone" title="图5" src="http://www.searchtb.com/wp-content/uploads/2012/08/fig200.png" alt="" width="386" height="623"></p>
<p align="center">图6：N:M的连接</p>
<p align="left">我们通过一个中间结点（Broker）来进行负载均衡的功能。我们通过代码了解，其中的Client和我们的Hello World的Client端是一样的，而Server端的不同是，他不需要监听端口，而是需要连接Broker的端口，接受需要处理的信息。所以，我们重点阅读Broker的代码：</p>
<pre class="brush:php"><?php
/*
* Simple request-reply broker
* @author Ian Barber <ian(dot)barber(at)gmail(dot)com>
*/

// Prepare our context and sockets
$context = new ZMQContext();
$frontend = new ZMQSocket($context, ZMQ::SOCKET_ROUTER);
$backend = new ZMQSocket($context, ZMQ::SOCKET_DEALER);
$frontend->bind("tcp://*:5559");
$backend->bind("tcp://*:5560");

// Initialize poll set
$poll = new ZMQPoll();
$poll->add($frontend, ZMQ::POLL_IN);
$poll->add($backend, ZMQ::POLL_IN);
$readable = $writeable = array();

// Switch messages between sockets
while(true) {
$events = $poll->poll($readable, $writeable);

foreach($readable as $socket) {
if($socket === $frontend) {
// Process all parts of the message
while(true) {
$message = $socket->recv();
// Multipart detection
$more = $socket->getSockOpt(ZMQ::SOCKOPT_RCVMORE);
$backend->send($message, $more ? ZMQ::MODE_SNDMORE : null);
if(!$more) {
break; // Last message part
}
}
}
else if($socket === $backend) {
$message = $socket->recv();
// Multipart detection
$more = $socket->getSockOpt(ZMQ::SOCKOPT_RCVMORE);
$frontend->send($message, $more ? ZMQ::MODE_SNDMORE : null);
if(!$more) {
break; // Last message part
}
}
}
}</pre>
<p align="left">Broker监听了两个端口，接受从多个Client端发送过来的数据，并将数据，转发给Server。在Broker中，我们监听了两个端口，使用了两个Socket，那么对于多个Socket的情况，我们是不需要通过轮询的方式去处理数据的，在之前，我们可以使用libevent实现，异步的信息处理和传输。而现在，我们只需要使用ZMQ的$poll->poll以实现多个Socket的异步处理。</p>
<p>七、进程间的通信</p>
<p align="left">ZMQ不仅能通过TCP完成节点间的通信，也可以通过Socket文件完成进程间的通信。如图7所示，我们fork三个PHP进程，将进程1的数据，通过Socket文件发送到进程3。</p>
<p align="center"><img class="alignnone" title="图6" src="http://www.searchtb.com/wp-content/uploads/2012/08/fig220.png" alt="" width="136" height="455"></p>
<p align="center">图7：进程间的通信</p>
<pre class="brush:php"><?php

function step1() {

        $context = new ZMQContext();

        // Signal downstream to step 2

        $sender = new ZMQSocket($context, ZMQ::SOCKET_PAIR);

        $sender->connect("ipc://step2.ipc");

        $sender->send("hello ,i am step1");

}

function step2() {

        $pid = pcntl_fork();

        if($pid == 0) {

                step1();

                exit();

        }

        $context = new ZMQContext();

        //  Bind to ipc: endpoint, then start upstream thread

        $receiver = new ZMQSocket($context, ZMQ::SOCKET_PAIR);

        $receiver->bind("ipc://step2.ipc");

        // Wait for signal   

        sleep(10);

        $strings = $receiver->recv();

        echo "step2 receiver is $strings". PHP_EOL;

        sleep(10);

        // Signal downstream to step 3

        $sender = new ZMQSocket($context, ZMQ::SOCKET_PAIR);

        $sender->connect("ipc://step3.ipc");

        $sender->send($strings);

}

// Start upstream thread then bind to icp: endpoint

$pid = pcntl_fork();

if($pid == 0) {

        step2();

        exit();

}

$context = new ZMQContext();

$receiver = new ZMQSocket($context, ZMQ::SOCKET_PAIR);

$receiver->bind("ipc://step3.ipc");

// Wait for signal

$sr = $receiver->recv();

echo "the result is {$sr}".PHP_EOL;</pre>
<p> </p>
<p align="left">在运行中，我们可以看到多了两个文件，如图8所示。</p>
<p align="left"><img class="aligncenter" title="图8" src="http://www.searchtb.com/wp-content/uploads/2012/08/270.jpg" alt="" width="583" height="76"></p>
<p align="center">图8：运行过程中生成的文件</p>
<p>八、利用ZeroMQ实现一个配置推送中心</p>
<p>当我们将WEB代码部署到集群上的时候，如果需要实时的将最新的配置信息，主动的推送到各个机器节点。在此过程中，我们一定要保证，各个节点收到的信息的一致性和正确性，如果使用HTTP，由于他的无状态性，我们无法保证信息的一致性，当然，你可以使用HTTP来实现，只是更复杂，为什么不用ZMQ？他能让你更简单的实现这些功能。</p>
<p>我们使用ZMQ的信息订阅模式。在那个模式中，我们注意到，对于后来的加入节点，始终会丢失在他加入之前，已经发送的信息（Slow joiner）。我们可以开启另外一个ZMQ的通信通道，用于报告当前节点的情况（节点的身份、准备状态等），其结构如图9所示。</p>
<p align="center"> <img class="alignnone" title="图9" src="http://www.searchtb.com/wp-content/uploads/2012/08/fig230.png" alt="" width="176" height="287"></p>
<p align="center">图9：扩展ZMQ的订阅者模式</p>
<p>我们通过$context->getSocket(ZMQ::SOCKET_REQ);设置一个新的Request-Reply连接，来用于Subscriber向Publisher报告自己的身份信息，而Publisher则等待所有的Subscriber都连接上的时候，再选择Publish自己的信息。</p>
<p>Subscriber端的程序如下：</p>
<pre class="brush:php"><?php

$hostname = $_SERVER['argc'] > 1 ? $_SERVER['argv'][1] : "s1";

$context = new ZMQContext(2);

$sub = new ZMQSocket($context,ZMQ::SOCKET_SUB);

$sub->connect("tcp://localhost:5561");

//$subscriber->setSockOpt(ZMQ::SOCKOPT_IDENTITY, $hostname);

$sub->setSockOpt(ZMQ::SOCKOPT_SUBSCRIBE,"");

$client = $context->getSocket(ZMQ::SOCKET_REQ);

$client->connect("tcp://localhost:5562");

while(1) {

//$client->connect("tcp://localhost:5562");

$client->send($hostname);

$version = $client->recv();

echo $version."\r\n";

if (!empty($version)) {

$recive = $sub->recv();

$vars = json_decode($recive);

var_dump($vars);

}

}</pre>
<p> </p>
<p>Publisher端的程序如下：</p>
<pre class="brush:php"><?php

$CONFIG["TAOKE_BTS"]["ENABLE"] = true;

$CONFIG["QP_BTS"]["ENABLE"] = true;

$CONFIG["QP_BTS"]["TK_TEST"] = 13;

$string = json_encode($CONFIG);

$clients = array("s2","s1","s3");

$context = new ZMQContext(10);

//Socket talk to clients

$publisher = new ZMQSocket($context,ZMQ::SOCKET_PUB);

$publisher->bind("tcp://*:5561");

//Socket to publish message

$server = new ZMQSocket($context,ZMQ::SOCKET_REP);

$server->bind("tcp://*:5562");

while(count($clients)!=0) {

      $client_name = $server->recv();

        echo "{$client_name} is connect!\r\n";

if (in_array($client_name, $clients)) { //coming one client

        $key = array_search($client_name, $clients);

        unset($clients[$key]);

        echo "$client_name has come in!\r\n";

        $server->send("Version is 2.0");

} else {

        $server->send("You are a stranger!");

}

}

$publisher->send($string);

?></pre>
<p> </p>
<p>每个节点通过5562端口，使用Rep模式和Publisher连接，通过这个连接告之Publisher自己的机器名，而Publisher端通过白名单的方式，维护一个机器列表，当机器列表中所有的机器连接上来以后，通过5561端口，将最新的配置信息发送出去。</p>
<p>后续的处理，Subscriber可以选择将配置信息写入到APC缓存，程序将始终从缓存中读取部分配置信息，Subscriber并将更新后的状态信息，实时的通过5562报告给Publisher。</p>
<p>虽然，在本示例中不会出现，但是，如果需要发布的信息量过大，在接受信息的过程中，Subscriber端突然中断网络（或者是程序崩溃），那么当他在连接上来的时候，有部分信息就会丢失？ZMQ考虑到这个问题，通过$subscriber->setSockOpt(ZMQ::SOCKOPT_IDENTITY, $hostname);设置一个id，当这个id的Subscriber重新连接上来的时候，他可以从上次中断的地方，继续接受信息，当然，节点的中断，不会影响其他的节点继续的接受信息。</p>
<p>那么ZMQ是怎么实现断线重连后，继续发送信息呢 ？他会将断开的Subscriber应该接受到的信息发到内存中，等待他重新上线后，将缓存的信息，继续发送给他。当然，内存必然是有限的，过多就会出现内存溢出。ZMQ通过</p>
<p>SetSockOpt(ZMQ::SOCKOPT_SWAP, 250000)设置Swap空间的大小，来防止out of memory and crash。最终，我们的程序运行结果，如图10所示。</p>
<p align="center"><img class="alignnone" title="图23" src="http://www.searchtb.com/wp-content/uploads/2012/08/fg230.jpg" alt="" width="625" height="407"></p>
<p align="center">图10：配置中心的运行结果</p>
<p>当然，这只是一个大体的思路，如果应用到实际的成产环境中，还需要考虑更多的问题，包含稳定性，容错等等。然而，ZMQ由于高并发，以及稳定性和易用性，前景不错，他的目标是进入Linux内核，我们期待那一天的到来。</p>
<p>参考资料 ：</p>
<p><a href="http://www.infoq.com/cn/news/2010/09/introduction-zero-mq">http://www.infoq.com/cn/news/2010/09/introduction-zero-mq</a> Infoq对zeromq的简介</p>
<p><a href="http://zguide.zeromq.org/page:all">http://zguide.zeromq.org/page:all</a>                              ZeroMQ的guide文档</p>
<p> </p>

<div class="author-info">
	<div class="author-avatar">
			</div>

	<div class="author-description">
		<h2 class="author-title"><span class="author-heading">作者：</span> 龙安_任天兵</h2>

		<p class="author-bio">
			不忘初心，方得始终!			<a class="author-link" href="https://huster.top/htmls/author/admin" rel="author">
				查看龙安_任天兵的所有文章			</a>
		</p>
	</div>
</div>
	</div>

	<footer class="entry-footer"><span class="byline"><span class="author vcard"><span class="screen-reader-text">作者 </span> <a class="url fn n" href="https://huster.top/htmls/author/admin">龙安_任天兵</a></span></span><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="https://huster.top/htmls/263.html" rel="bookmark"><time class="entry-date published" datetime="2012-08-03T14:07:31+00:00">2012 年 8 月 3 日</time><time class="updated" datetime="2013-08-12T16:05:38+00:00">2013 年 8 月 12 日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="https://huster.top/htmls/category/%e7%b3%bb%e7%bb%9f%e6%9e%b6%e6%9e%84" rel="category tag">系统架构学习</a></span><span class="tags-links"><span class="screen-reader-text">标签 </span><a href="https://huster.top/htmls/tag/zeromq" rel="tag">ZeroMQ</a>、<a href="https://huster.top/htmls/tag/zmq" rel="tag">zmq</a>、<a href="https://huster.top/htmls/tag/zmq%e7%9a%84%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0" rel="tag">ZMQ的学习笔记</a></span>			</footer></article><div id="gitalk-container"></div>
  <script type="text/javascript">
	 
    var gitalk = new Gitalk({

    // gitalk的主要参数
		clientID: '95e38b5678bc02f9e4c9',
		clientSecret: '90b5173014cd44667e88ec922467e46ba456b53f',
		repo: 'myblog',
		owner: 'hust419',
		admin: ['hust419'],
		id: location.hash.match(/#(.*?)([?]|$)/)[1]
    
    });
	 window.onhashchange = function(event){
      if(event.newURL.split('?')[0] !== event.oldURL .split('?')[0]) {
        location.reload()
      }
    }
    gitalk.render('gitalk-container');
</script><nav class="navigation post-navigation" role="navigation"><h2 class="screen-reader-text">文章导航</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://huster.top/htmls/256.html" rel="prev"><span class="meta-nav" aria-hidden="true">上一</span> <span class="screen-reader-text">上篇文章：</span> <span class="post-title">ZMQ的异步和进程间通信</span></a></div><div class="nav-next"><a href="https://huster.top/htmls/278.html" rel="next"><span class="meta-nav" aria-hidden="true">下一</span> <span class="screen-reader-text">下篇文章：</span> <span class="post-title">VPS下LNMP(Linux+Nginx+php-fpm+mysql)的安装</span></a></div></div>
	</nav></main><aside id="content-bottom-widgets" class="content-bottom-widgets" role="complementary"><div class="widget-area">
			<section id="custom_html-3" class="widget_text widget widget_custom_html"><div class="textwidget custom-html-widget"><script src="https://s22.cnzz.com/z_stat.php?id=3943131&web_id=3943131" language="JavaScript"></script></div></section></div>
	
	</aside></div>


	<aside id="secondary" class="sidebar widget-area" role="complementary"><section id="recent-posts-2" class="widget widget_recent_entries"><h2 class="widget-title">近期文章</h2>		<ul><li>
					<a href="https://huster.top/htmls/790.html">Java的Jar包冲突的总结和实践</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/780.html">如何用java.io.*写一个服务器</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/748.html">CPU异常问题排查</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/745.html">又一起GC问题排查过程</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/720.html">生产FullGC问题排查</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/713.html">flink读取kafka数据未能触发watermark</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/708.html">flink使用时间戳作为起始offset消费kafka的问题</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/706.html">flink通过jdbc读取postgresql数据库里的数据</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/704.html">flink相关 – 通过Table API写入ElasticSearch的部分源码分析</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/700.html">flink的动态表格</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/696.html">flink相关 – 读入kafka数据源</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/691.html">flink学习笔记(一)</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/686.html">Java字节码增强应用</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/662.html">JVM Sandbox 源码分析（一）基础篇: Instrumentation和ClassFileTransformer作用</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/657.html">Java类库设计之日志框架选择</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/649.html">Java多线程知识点（下）</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/645.html">如何写代码来解决生产者消费者问题？</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/642.html">Java多线程总结(上部分)面试题解答</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/637.html">细说Java的内存模型</a>
									</li>
											<li>
					<a href="https://huster.top/htmls/633.html">Java面试题之Java语法的基础知识</a>
									</li>
					</ul></section><section id="archives-2" class="widget widget_archive"><h2 class="widget-title">文章归档</h2>		<ul><li><a href="https://huster.top/htmls/date/2022/05">2022年五月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2022/04">2022年四月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2021/02">2021年二月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2020/09">2020年九月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2020/06">2020年六月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2020/02">2020年二月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2019/10">2019年十月</a> (6)</li>
	<li><a href="https://huster.top/htmls/date/2019/07">2019年七月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2019/06">2019年六月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2019/05">2019年五月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2018/12">2018年十二月</a> (2)</li>
	<li><a href="https://huster.top/htmls/date/2018/11">2018年十一月</a> (5)</li>
	<li><a href="https://huster.top/htmls/date/2018/10">2018年十月</a> (2)</li>
	<li><a href="https://huster.top/htmls/date/2018/08">2018年八月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2018/07">2018年七月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2018/06">2018年六月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2018/04">2018年四月</a> (3)</li>
	<li><a href="https://huster.top/htmls/date/2018/01">2018年一月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2017/10">2017年十月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2017/08">2017年八月</a> (2)</li>
	<li><a href="https://huster.top/htmls/date/2017/07">2017年七月</a> (6)</li>
	<li><a href="https://huster.top/htmls/date/2017/06">2017年六月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2017/04">2017年四月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2016/12">2016年十二月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2016/11">2016年十一月</a> (2)</li>
	<li><a href="https://huster.top/htmls/date/2016/10">2016年十月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2016/06">2016年六月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2016/03">2016年三月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2015/11">2015年十一月</a> (4)</li>
	<li><a href="https://huster.top/htmls/date/2015/01">2015年一月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2014/10">2014年十月</a> (2)</li>
	<li><a href="https://huster.top/htmls/date/2013/08">2013年八月</a> (4)</li>
	<li><a href="https://huster.top/htmls/date/2013/06">2013年六月</a> (4)</li>
	<li><a href="https://huster.top/htmls/date/2013/05">2013年五月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2013/03">2013年三月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2012/12">2012年十二月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2012/09">2012年九月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2012/08">2012年八月</a> (2)</li>
	<li><a href="https://huster.top/htmls/date/2012/07">2012年七月</a> (2)</li>
	<li><a href="https://huster.top/htmls/date/2012/06">2012年六月</a> (2)</li>
	<li><a href="https://huster.top/htmls/date/2012/05">2012年五月</a> (1)</li>
	<li><a href="https://huster.top/htmls/date/2012/04">2012年四月</a> (10)</li>
	<li><a href="https://huster.top/htmls/date/2012/03">2012年三月</a> (8)</li>
	<li><a href="https://huster.top/htmls/date/2010/12">2010年十二月</a> (1)</li>
		</ul></section><section id="categories-2" class="widget widget_categories"><h2 class="widget-title">分类目录</h2>		<ul><li class="cat-item cat-item-57"><a href="https://huster.top/htmls/category/nas-%e7%be%a4%e6%99%96">nas-群晖</a> (2)
</li>
	<li class="cat-item cat-item-11"><a href="https://huster.top/htmls/category/php%e5%b7%a5%e5%85%b7">PHP高效编程</a> (6)
<ul class="children"><li class="cat-item cat-item-53"><a href="https://huster.top/htmls/category/php%e5%b7%a5%e5%85%b7/php-tools">PHP的开发工具</a> (3)
</li>
	<li class="cat-item cat-item-6"><a href="https://huster.top/htmls/category/php%e5%b7%a5%e5%85%b7/php%e9%82%a3%e4%ba%9b%e6%9c%89%e8%b6%a3%e7%9a%84%e4%ba%8b%e5%84%bf" title="php那些以前没注意到的，或者很少注意到事情">PHP编程</a> (3)
</li>
</ul></li>
	<li class="cat-item cat-item-74"><a href="https://huster.top/htmls/category/tensortflow">TensortFlow</a> (2)
</li>
	<li class="cat-item cat-item-33"><a href="https://huster.top/htmls/category/web%e5%ae%89%e5%85%a8">WEB安全</a> (3)
</li>
	<li class="cat-item cat-item-28"><a href="https://huster.top/htmls/category/%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0">学习笔记</a> (70)
<ul class="children"><li class="cat-item cat-item-83"><a href="https://huster.top/htmls/category/%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0/flink">flink</a> (7)
</li>
	<li class="cat-item cat-item-19"><a href="https://huster.top/htmls/category/%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0/http1-1%e9%98%85%e8%af%bb%e7%ac%94%e8%ae%b0">HTTP/1.1阅读笔记</a> (11)
</li>
	<li class="cat-item cat-item-54"><a href="https://huster.top/htmls/category/%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0/java%e5%ad%a6%e4%b9%a0">Java学习</a> (40)
</li>
	<li class="cat-item cat-item-44"><a href="https://huster.top/htmls/category/%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0/linux%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0">Linux学习笔记</a> (1)
</li>
	<li class="cat-item cat-item-23"><a href="https://huster.top/htmls/category/%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0/%e6%9c%8d%e5%8a%a1">PHP编写服务的研究</a> (1)
</li>
	<li class="cat-item cat-item-40"><a href="https://huster.top/htmls/category/%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0/rfc793-tcp%e6%8e%a7%e5%88%b6%e5%8d%8f%e8%ae%ae">RFC793-TCP控制协议</a> (1)
</li>
	<li class="cat-item cat-item-56"><a href="https://huster.top/htmls/category/%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0/spring%e6%96%87%e6%a1%a3">Spring文档</a> (3)
</li>
	<li class="cat-item cat-item-1"><a href="https://huster.top/htmls/category/%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0/uncategorized">其他</a> (5)
</li>
</ul></li>
	<li class="cat-item cat-item-16"><a href="https://huster.top/htmls/category/%e7%b3%bb%e7%bb%9f%e6%9e%b6%e6%9e%84">系统架构学习</a> (13)
</li>
	<li class="cat-item cat-item-75"><a href="https://huster.top/htmls/category/%e8%bd%ac%e8%bd%bd">转载</a> (2)
</li>
		</ul></section><section id="tag_cloud-2" class="widget widget_tag_cloud"><h2 class="widget-title">标签</h2><div class="tagcloud"><a href="https://huster.top/htmls/tag/apache" class="tag-cloud-link tag-link-31 tag-link-position-1" style="font-size: 1em;">Apache</a>
<a href="https://huster.top/htmls/tag/codesniffer" class="tag-cloud-link tag-link-12 tag-link-position-2" style="font-size: 1em;">CodeSniffer</a>
<a href="https://huster.top/htmls/tag/ecache" class="tag-cloud-link tag-link-67 tag-link-position-3" style="font-size: 1em;">Ecache</a>
<a href="https://huster.top/htmls/tag/globals" class="tag-cloud-link tag-link-10 tag-link-position-4" style="font-size: 1em;">GLOBALS</a>
<a href="https://huster.top/htmls/tag/hessian" class="tag-cloud-link tag-link-73 tag-link-position-5" style="font-size: 1em;">Hessian</a>
<a href="https://huster.top/htmls/tag/http1-1" class="tag-cloud-link tag-link-22 tag-link-position-6" style="font-size: 1em;">HTTP/1.1</a>
<a href="https://huster.top/htmls/tag/httpurlconnection" class="tag-cloud-link tag-link-71 tag-link-position-7" style="font-size: 1em;">HttpURLConnection</a>
<a href="https://huster.top/htmls/tag/http%e8%af%b7%e6%b1%82" class="tag-cloud-link tag-link-70 tag-link-position-8" style="font-size: 1em;">Http请求</a>
<a href="https://huster.top/htmls/tag/ioc" class="tag-cloud-link tag-link-17 tag-link-position-9" style="font-size: 1em;">IoC</a>
<a href="https://huster.top/htmls/tag/java" class="tag-cloud-link tag-link-58 tag-link-position-10" style="font-size: 1em;">Java</a>
<a href="https://huster.top/htmls/tag/java-spring-petclinic" class="tag-cloud-link tag-link-55 tag-link-position-11" style="font-size: 1em;">Java spring-petclinic</a>
<a href="https://huster.top/htmls/tag/log4j" class="tag-cloud-link tag-link-68 tag-link-position-12" style="font-size: 1em;">log4j</a>
<a href="https://huster.top/htmls/tag/logback" class="tag-cloud-link tag-link-69 tag-link-position-13" style="font-size: 1em;">logback</a>
<a href="https://huster.top/htmls/tag/maven" class="tag-cloud-link tag-link-64 tag-link-position-14" style="font-size: 1em;">Maven</a>
<a href="https://huster.top/htmls/tag/maven-shade-plugin" class="tag-cloud-link tag-link-66 tag-link-position-15" style="font-size: 1em;">maven-shade-plugin</a>
<a href="https://huster.top/htmls/tag/mybatis" class="tag-cloud-link tag-link-72 tag-link-position-16" style="font-size: 1em;">mybatis</a>
<a href="https://huster.top/htmls/tag/php" class="tag-cloud-link tag-link-7 tag-link-position-17" style="font-size: 1em;">PHP</a>
<a href="https://huster.top/htmls/tag/plugin" class="tag-cloud-link tag-link-65 tag-link-position-18" style="font-size: 1em;">Plugin</a>
<a href="https://huster.top/htmls/tag/register_globals" class="tag-cloud-link tag-link-9 tag-link-position-19" style="font-size: 1em;">register_globals</a>
<a href="https://huster.top/htmls/tag/rfc" class="tag-cloud-link tag-link-20 tag-link-position-20" style="font-size: 1em;">RFC</a>
<a href="https://huster.top/htmls/tag/rfc2616" class="tag-cloud-link tag-link-21 tag-link-position-21" style="font-size: 1em;">RFC2616</a>
<a href="https://huster.top/htmls/tag/serializable" class="tag-cloud-link tag-link-59 tag-link-position-22" style="font-size: 1em;">Serializable</a>
<a href="https://huster.top/htmls/tag/spring" class="tag-cloud-link tag-link-63 tag-link-position-23" style="font-size: 1em;">Spring</a>
<a href="https://huster.top/htmls/tag/spring-boot" class="tag-cloud-link tag-link-62 tag-link-position-24" style="font-size: 1em;">Spring boot</a>
<a href="https://huster.top/htmls/tag/thinkphp" class="tag-cloud-link tag-link-34 tag-link-position-25" style="font-size: 1em;">ThinkPHP</a>
<a href="https://huster.top/htmls/tag/vsftp" class="tag-cloud-link tag-link-43 tag-link-position-26" style="font-size: 1em;">VSFTP</a>
<a href="https://huster.top/htmls/tag/wordpress%e6%ba%90%e7%a0%81" class="tag-cloud-link tag-link-8 tag-link-position-27" style="font-size: 1em;">wordpress源码</a>
<a href="https://huster.top/htmls/tag/zeromq" class="tag-cloud-link tag-link-29 tag-link-position-28" style="font-size: 1em;">ZeroMQ</a>
<a href="https://huster.top/htmls/tag/zmq" class="tag-cloud-link tag-link-41 tag-link-position-29" style="font-size: 1em;">zmq</a>
<a href="https://huster.top/htmls/tag/zmq%e7%9a%84%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0" class="tag-cloud-link tag-link-42 tag-link-position-30" style="font-size: 1em;">ZMQ的学习笔记</a>
<a href="https://huster.top/htmls/tag/%e4%ba%92%e8%81%94%e7%bd%91" class="tag-cloud-link tag-link-14 tag-link-position-31" style="font-size: 1em;">互联网</a>
<a href="https://huster.top/htmls/tag/%e5%8a%a8%e6%80%81%e4%bb%a3%e7%90%86" class="tag-cloud-link tag-link-61 tag-link-position-32" style="font-size: 1em;">动态代理</a>
<a href="https://huster.top/htmls/tag/%e5%8f%8c%e5%bc%95%e5%8f%b7" class="tag-cloud-link tag-link-36 tag-link-position-33" style="font-size: 1em;">双引号</a>
<a href="https://huster.top/htmls/tag/%e5%a4%9a%e7%ba%bf%e7%a8%8b" class="tag-cloud-link tag-link-78 tag-link-position-34" style="font-size: 1em;">多线程</a>
<a href="https://huster.top/htmls/tag/%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0" class="tag-cloud-link tag-link-28 tag-link-position-35" style="font-size: 1em;">学习笔记</a>
<a href="https://huster.top/htmls/tag/%e5%ae%89%e5%85%a8" class="tag-cloud-link tag-link-35 tag-link-position-36" style="font-size: 1em;">安全</a>
<a href="https://huster.top/htmls/tag/%e6%8a%80%e6%9c%af%e5%80%ba%e5%8a%a1" class="tag-cloud-link tag-link-30 tag-link-position-37" style="font-size: 1em;">技术债务</a>
<a href="https://huster.top/htmls/tag/%e6%97%a5%e5%bf%97" class="tag-cloud-link tag-link-32 tag-link-position-38" style="font-size: 1em;">日志</a>
<a href="https://huster.top/htmls/tag/%e6%9d%83%e5%88%a9" class="tag-cloud-link tag-link-49 tag-link-position-39" style="font-size: 1em;">权利</a>
<a href="https://huster.top/htmls/tag/%e6%9f%b4%e9%9d%99" class="tag-cloud-link tag-link-48 tag-link-position-40" style="font-size: 1em;">柴静</a>
<a href="https://huster.top/htmls/tag/%e6%b3%9b%e5%9e%8b" class="tag-cloud-link tag-link-60 tag-link-position-41" style="font-size: 1em;">泛型</a>
<a href="https://huster.top/htmls/tag/%e6%b5%8f%e8%a7%88%e5%99%a8" class="tag-cloud-link tag-link-15 tag-link-position-42" style="font-size: 1em;">浏览器</a>
<a href="https://huster.top/htmls/tag/%e7%b3%bb%e7%bb%9f%e8%ae%be%e8%ae%a1" class="tag-cloud-link tag-link-13 tag-link-position-43" style="font-size: 1em;">系统设计</a>
<a href="https://huster.top/htmls/tag/%e8%af%bb%e4%b9%a6%e7%ac%94%e8%ae%b0" class="tag-cloud-link tag-link-47 tag-link-position-44" style="font-size: 1em;">读书笔记</a>
<a href="https://huster.top/htmls/tag/%e8%bd%af%e4%bb%b6%e8%ae%be%e8%ae%a1" class="tag-cloud-link tag-link-18 tag-link-position-45" style="font-size: 1em;">软件设计</a></div>
</section><section id="linkcat-2" class="widget widget_links"><h2 class="widget-title">链接表</h2>
	<ul class="xoxo blogroll"><li><a href="http://blog.sina.com.cn/rentb" rel="me" title="原来的博客地址" target="_blank">博客老地址</a></li>
<li><a href="http://blog.csdn.net/heiyeshuwu" rel="colleague" target="_blank">黑夜路人</a></li>

	</ul></section><section id="recent-comments-2" class="widget widget_recent_comments"><h2 class="widget-title">近期评论</h2><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link"><a href="https://huster.top/htmls/645.html" rel="external nofollow" class="url">如何写代码来解决生产者消费者问题？ – 三两带走</a></span>发表在《<a href="https://huster.top/htmls/615.html/comment-page-1#comment-24314">理解Java线程间的通信</a>》</li><li class="recentcomments"><span class="comment-author-link">龙安_任天兵</span>发表在《<a href="https://huster.top/htmls/557.html/comment-page-1#comment-24313">并发编程模型(转载)</a>》</li><li class="recentcomments"><span class="comment-author-link"><a href="https://huster.top/htmls/642.html" rel="external nofollow" class="url">Java多线程总结(上部分)面试题解答 – 三两带走</a></span>发表在《<a href="https://huster.top/htmls/637.html/comment-page-1#comment-24312">细说Java的内存模型</a>》</li><li class="recentcomments"><span class="comment-author-link"><a href="https://huster.top/htmls/642.html" rel="external nofollow" class="url">Java多线程总结(上部分)面试题解答 – 三两带走</a></span>发表在《<a href="https://huster.top/htmls/557.html/comment-page-1#comment-24311">并发编程模型(转载)</a>》</li><li class="recentcomments"><span class="comment-author-link">shanchao</span>发表在《<a href="https://huster.top/htmls/573.html/comment-page-1#comment-24309">spring boot应用在 POST请求的Invalid CORS request的问题</a>》</li><li class="recentcomments"><span class="comment-author-link">adimin</span>发表在《<a href="https://huster.top/htmls/462.html/comment-page-1#comment-24307">介绍spring的两个接口ApplicationContextAware和ApplicationListener</a>》</li><li class="recentcomments"><span class="comment-author-link">匿名</span>发表在《<a href="https://huster.top/htmls/462.html/comment-page-1#comment-24306">介绍spring的两个接口ApplicationContextAware和ApplicationListener</a>》</li><li class="recentcomments"><span class="comment-author-link">匿名</span>发表在《<a href="https://huster.top/htmls/472.html/comment-page-1#comment-24276">Spring boot访问js、css、图片(img)访问404无法访问的问题</a>》</li><li class="recentcomments"><span class="comment-author-link"><a href="http://kailin.li" rel="external nofollow" class="url">kailin</a></span>发表在《<a href="https://huster.top/htmls/472.html/comment-page-1#comment-24275">Spring boot访问js、css、图片(img)访问404无法访问的问题</a>》</li><li class="recentcomments"><span class="comment-author-link">基地华科男</span>发表在《<a href="https://huster.top/about-me/comment-page-2#comment-24271">关于我</a>》</li></ul></section></aside></div>

		<footer id="colophon" class="site-footer" role="contentinfo"><div class="site-info">
								<span class="site-title"><a href="https://huster.top/" rel="home">三两带走</a></span>
				<a href="https://cn.wordpress.org/">自豪地采用WordPress</a>
			</div>
		</footer></div>
</div>

<script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shCore.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushAS3.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushBash.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushColdFusion.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushClojure.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushCpp.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushCSharp.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushCss.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushDelphi.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushDiff.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushErlang.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushGroovy.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushJava.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushJavaFX.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushJScript.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushLatex.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushMatlabKey.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushObjC.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushPerl.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushPhp.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushPlain.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushPowerShell.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushPython.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushR.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushRuby.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushScala.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushSql.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushVb.js"></script><script type="text/javascript" src="https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/shBrushXml.js"></script><script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shCore.css?ver=2.1.364";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shThemeRDark.css?ver=2.1.364";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.clipboardSwf = 'https://huster.top/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf';
	SyntaxHighlighter.config.strings.expandSource = 'show source';
	SyntaxHighlighter.config.strings.viewSource = 'view source';
	SyntaxHighlighter.config.strings.copyToClipboard = 'copy to clipboard';
	SyntaxHighlighter.config.strings.copyToClipboardConfirmation = 'The code is in your clipboard now';
	SyntaxHighlighter.config.strings.print = 'print';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['auto-links'] = false;
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();

	// Infinite scroll support
	if ( typeof( jQuery ) !== 'undefined' ) {
		jQuery( function( $ ) {
			$( document.body ).on( 'post-load', function() {
				SyntaxHighlighter.highlight();
			} );
		} );
	}
</script><script type="text/javascript">
var codePrettifyLoaderBaseUrl = "https:\/\/huster.top\/wp-content\/plugins\/code-prettify\/prettify";
</script><script type="text/javascript" src="https://huster.top/wp-content/plugins/code-prettify/prettify/run_prettify.js"></script><script type="text/javascript" src="https://huster.top/wp-content/themes/twentysixteen/js/skip-link-focus-fix.js"></script><script type="text/javascript">
/* <![CDATA[ */
var screenReaderText = {"expand":"\u5c55\u5f00\u5b50\u83dc\u5355","collapse":"\u6298\u53e0\u5b50\u83dc\u5355"};
/* ]]> */
</script><script type="text/javascript" src="https://huster.top/wp-content/themes/twentysixteen/js/functions.js"></script></body></html>
